import{u as k,F as y,G as S,H as w,r as c,j as e,L as M,T as A,M as D,I as T,J as _,K as G,N as H,A as o,D as n}from"./index-BpxMBPca.js";function F(){var d;const x=k(),g=y(),{accounts:f,loading:p}=S(),{categories:h,loading:v}=w(),a=((d=g.state)==null?void 0:d.prefill)||null,[b,m]=c.useState(!1),[r,i]=c.useState(null),[N,E]=c.useState(0),C=async({type:l,data:t})=>{m(!0);try{let s;switch(l){case"income":s=await H(t);break;case"expense":s=await G(t);break;case"expense_installments":s=await _(t);break;case"transfer":s=await T(t);break;default:throw new Error("Tipo de movimiento no vÃ¡lido")}let u=s.message||"Movimiento registrado correctamente";switch(l==="expense_installments"&&s.filasCreadas&&(u=`Gasto en ${s.filasCreadas} cuotas registrado correctamente`),i({message:u,type:"success"}),o(n.ACCOUNTS_CHANGED),l){case"income":o(n.INCOMES_CHANGED);break;case"expense":case"expense_installments":o(n.EXPENSES_CHANGED);break;case"transfer":o(n.TRANSFERS_CHANGED);break}a?setTimeout(()=>{x("/")},1500):E(j=>j+1)}catch(s){i({message:s.message||"Error al registrar el movimiento",type:"error"})}finally{m(!1)}};return p||v?e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsx(M,{size:"lg"})}):e.jsxs("div",{className:"lg:max-w-2xl lg:mx-auto",children:[r&&e.jsx(A,{message:r.message,type:r.type,onClose:()=>i(null)}),e.jsx("h2",{className:"text-xl font-bold mb-6 lg:text-2xl lg:mb-8",style:{color:"var(--text-primary)"},children:a?"Duplicar Movimiento":"Nuevo Movimiento"}),a&&e.jsxs("div",{className:"mb-4 p-3 rounded-xl text-sm flex items-center gap-2",style:{backgroundColor:"var(--accent-blue-dim)",color:"var(--accent-blue)"},children:[e.jsx("svg",{className:"w-4 h-4 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Duplicando movimiento con fecha de hoy. Modifica los datos si es necesario."]}),e.jsx("div",{className:"lg:rounded-2xl lg:p-6",style:{backgroundColor:"transparent"},children:e.jsx(D,{accounts:f,categories:h,onSubmit:C,loading:b,prefillData:a},N)})]})}export{F as default};
