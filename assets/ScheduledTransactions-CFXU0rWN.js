import{j as e,f as F,y as te,z as ae,r as c,ab as se,L as _,a7 as ne,a6 as R,T as J,aR as oe,aS as ce,aT as le,g as ie,aU as de,H as X,aV as me,aW as ue,aX as xe}from"./index-k7BheE9E.js";import{P as pe}from"./PullToRefresh-UYnO5keD.js";const ge=t=>t?new Date(t+"T12:00:00").toLocaleDateString("es-AR",{day:"numeric",month:"short",year:"numeric"}):"-",he=t=>{if(!t)return!1;const l=new Date().toISOString().split("T")[0];return t===l},ve=t=>{if(!t)return!1;const l=new Date().toISOString().split("T")[0];return t<l},fe=(t,l)=>{const f=ve(l),a=he(l);switch(t){case"pending":return a?{label:"Hoy",color:"var(--accent-orange)",bgColor:"var(--accent-orange-dim)"}:f?{label:"Vencida",color:"var(--accent-red)",bgColor:"var(--accent-red-dim)"}:{label:"Pendiente",color:"var(--text-muted)",bgColor:"var(--bg-tertiary)"};case"approved":return{label:"Aprobada",color:"var(--accent-green)",bgColor:"var(--accent-green-dim)"};case"rejected":return{label:"Rechazada",color:"var(--accent-red)",bgColor:"var(--accent-red-dim)"};case"executed":return{label:"Ejecutada",color:"var(--accent-primary)",bgColor:"var(--accent-primary-dim)"};default:return{label:t,color:"var(--text-muted)",bgColor:"var(--bg-tertiary)"}}};function ye({scheduled:t,onClick:l,onApprove:f,onReject:a,onEdit:b,onDelete:d}){const C=t.type==="expense",p=t.type==="income",E=t.type==="transfer",M=t.status==="pending",j=C?"var(--accent-red)":p?"var(--accent-green)":"var(--accent-blue)",h=C?"Gasto":p?"Ingreso":"Transferencia",y=fe(t.status,t.fecha);return e.jsxs("div",{onClick:l,className:`
        relative p-4 rounded-2xl cursor-pointer transition-all duration-200
        hover:scale-[1.01] active:scale-[0.99]
        ${t.status==="rejected"?"opacity-60":""}
      `,style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-subtle)"},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium",style:{backgroundColor:`color-mix(in srgb, ${j} 15%, transparent)`,color:j},children:h}),e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium",style:{backgroundColor:y.bgColor,color:y.color},children:y.label})]}),e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",style:{color:"var(--text-muted)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.75,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("span",{className:"font-semibold text-base",style:{color:"var(--text-primary)"},children:ge(t.fecha)})]}),e.jsxs("span",{className:"font-bold text-lg whitespace-nowrap",style:{color:j},children:[C?"-":p?"+":"",F(t.monto,t.cuentaMoneda==="USD"?"D√≥lar":"Peso")]})]}),e.jsxs("div",{className:"space-y-1.5",children:[t.nota&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",style:{color:"var(--text-primary)"},children:[e.jsx("svg",{className:"w-4 h-4 flex-shrink-0",style:{color:"var(--text-muted)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.75,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),e.jsx("span",{className:"truncate",children:t.nota})]}),E?e.jsxs("div",{className:"flex items-center gap-2 text-sm",style:{color:"var(--text-secondary)"},children:[t.cuentaIcon?e.jsx("span",{className:"text-sm",children:t.cuentaIcon}):e.jsx("svg",{className:"w-4 h-4 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.75,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),e.jsxs("span",{className:"truncate",children:[t.cuenta," ‚Üí ",t.cuentaDestino]})]}):e.jsxs(e.Fragment,{children:[t.cuenta&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",style:{color:"var(--text-secondary)"},children:[t.cuentaIcon?e.jsx("span",{className:"text-sm",children:t.cuentaIcon}):e.jsx("svg",{className:"w-4 h-4 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.75,d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})}),e.jsx("span",{className:"truncate",children:t.cuenta})]}),t.categoria&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",style:{color:"var(--text-secondary)"},children:[t.categoriaIcon?e.jsx("span",{className:"text-sm",children:t.categoriaIcon}):e.jsx("svg",{className:"w-4 h-4 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.75,d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})}),e.jsx("span",{className:"truncate",children:t.categoria})]})]})]}),M&&(f||a||b)&&e.jsxs("div",{className:"mt-3 pt-3 flex items-center justify-between gap-2",style:{borderTop:"1px solid var(--border-subtle)"},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[f&&e.jsxs("button",{onClick:i=>{i.stopPropagation(),i.preventDefault(),f(t)},onTouchEnd:i=>{i.stopPropagation()},className:"flex items-center gap-1.5 px-3 py-2 rounded-lg text-sm font-medium transition-colors hover:opacity-80 active:scale-95",style:{backgroundColor:"var(--accent-green-dim)",color:"var(--accent-green)"},title:"Aprobar y ejecutar",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Aprobar"]}),a&&e.jsx("button",{onClick:i=>{i.stopPropagation(),i.preventDefault(),a(t)},onTouchEnd:i=>{i.stopPropagation()},className:"flex items-center gap-1.5 px-3 py-2 rounded-lg text-sm font-medium transition-colors hover:opacity-80 active:scale-95",style:{backgroundColor:"var(--accent-red-dim)",color:"var(--accent-red)"},title:"Rechazar",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[b&&e.jsx("button",{onClick:i=>{i.stopPropagation(),i.preventDefault(),b(t)},onTouchEnd:i=>{i.stopPropagation()},className:"p-2 rounded-lg transition-colors hover:bg-[var(--bg-tertiary)]",style:{color:"var(--text-muted)"},title:"Editar",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),d&&e.jsx("button",{onClick:i=>{i.stopPropagation(),i.preventDefault(),d(t)},onTouchEnd:i=>{i.stopPropagation()},className:"p-2 rounded-lg transition-colors hover:bg-[var(--bg-tertiary)] active:bg-[var(--accent-red-dim)]",style:{color:"var(--accent-red)"},title:"Eliminar",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})]})}const be=[{id:"income",label:"Ingreso",color:"var(--accent-green)",bgDim:"var(--accent-green-dim)"},{id:"expense",label:"Gasto",color:"var(--accent-red)",bgDim:"var(--accent-red-dim)"},{id:"transfer",label:"Transferir",color:"var(--accent-blue)",bgDim:"var(--accent-blue-dim)"}];function je({isOpen:t,onClose:l,onSuccess:f,editData:a=null}){var O,U;const{accounts:b,loading:d,refetch:C}=te(),{categories:p,loading:E,refetch:M}=ae(),j=c.useMemo(()=>(b||[]).filter(s=>!s.esTarjetaCredito),[b]),[h,y]=c.useState(!1),[i,x]=c.useState(null),[P,w]=c.useState(!1),[u,S]=c.useState((a==null?void 0:a.type)||"expense"),v=c.useMemo(()=>{const s=new Date;return s.setDate(s.getDate()+1),s.toISOString().split("T")[0]},[]),[n,g]=c.useState({fecha:(a==null?void 0:a.fecha)||v,monto:((O=a==null?void 0:a.monto)==null?void 0:O.toString())||"",cuenta:(a==null?void 0:a.cuenta)||"",cuentaDestino:(a==null?void 0:a.cuentaDestino)||"",montoDestino:((U=a==null?void 0:a.montoDestino)==null?void 0:U.toString())||"",categoria:(a==null?void 0:a.categoria)||"",nota:(a==null?void 0:a.nota)||""}),[L,N]=c.useState(0),[T,I]=c.useState(!1),A=c.useRef(0);c.useEffect(()=>{var s,m;t&&(N(0),I(!1),a?(g({fecha:a.fecha||v,monto:((s=a.monto)==null?void 0:s.toString())||"",cuenta:a.cuenta||"",cuentaDestino:a.cuentaDestino||"",montoDestino:((m=a.montoDestino)==null?void 0:m.toString())||"",categoria:a.categoria||"",nota:a.nota||""}),S(a.type||"expense")):(g({fecha:v,monto:"",cuenta:"",cuentaDestino:"",montoDestino:"",categoria:"",nota:""}),S("expense")),x(null))},[t,a,v]),c.useEffect(()=>{const s=m=>{m.key==="Escape"&&t&&!h&&l()};return t&&(document.addEventListener("keydown",s),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",s),document.body.style.overflow=""}},[t,h,l]);const V=s=>{s.target.closest("[data-drag-handle]")&&(A.current=s.touches[0].clientY,I(!0))},W=s=>{if(!T)return;const m=s.touches[0].clientY-A.current;m>0&&N(m)},H=()=>{T&&(L>100&&!h&&l(),N(0),I(!1))},k=s=>{const{name:m,value:ee}=s.target;g(re=>({...re,[m]:ee}))},r=async s=>{if(s.preventDefault(),!n.monto||!n.cuenta||!n.fecha){x({message:"Completa los campos obligatorios",type:"error"});return}if(u!=="transfer"&&!n.categoria){x({message:"Selecciona una categor√≠a",type:"error"});return}if(u==="transfer"&&!n.cuentaDestino){x({message:"Selecciona la cuenta destino",type:"error"});return}if(n.fecha<v){x({message:"La fecha debe ser futura",type:"error"});return}y(!0);try{const m={type:u,scheduledDate:n.fecha,amount:parseFloat(n.monto),accountName:n.cuenta,categoryName:u!=="transfer"?n.categoria:null,note:n.nota||null};u==="transfer"&&(m.toAccountName=n.cuentaDestino,m.toAmount=n.montoDestino?parseFloat(n.montoDestino):parseFloat(n.monto)),a!=null&&a.id?await ce(a.id,m):await le(m),x({message:a?"Programada actualizada":"Transacci√≥n programada",type:"success"}),C(),setTimeout(()=>{l(),f&&f()},1e3)}catch(m){x({message:m.message||"Error al guardar",type:"error"})}finally{y(!1)}};if(!t)return null;const o=d||E,z=Math.max(.6-L/300,0),Y=L>100,K=n.monto&&n.cuenta&&n.fecha>=v&&(u==="transfer"?n.cuentaDestino:n.categoria),$=()=>{switch(u){case"income":return"var(--accent-green)";case"expense":return"var(--accent-red)";case"transfer":return"var(--accent-blue)";default:return"var(--accent-primary)"}},Q=u==="income"?p.ingresos||[]:p.gastos||[],Z=e.jsx("svg",{className:"w-3.5 h-3.5 sm:w-4 sm:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),G=e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),B=e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})}),q=e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})}),D=e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})});return se.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-start sm:items-center justify-center overflow-y-auto sm:py-6",children:[e.jsx("div",{className:"absolute inset-0 backdrop-blur-sm transition-opacity animate-fade-in",style:{backgroundColor:`rgba(0, 0, 0, ${z})`},onClick:h?void 0:l}),e.jsxs("div",{className:"relative z-10 w-full max-w-md sm:max-w-lg sm:mx-4 mt-0 sm:mt-0 rounded-b-xl sm:rounded-xl animate-slide-down max-h-[85dvh] sm:max-h-[calc(100vh-48px)]",style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-subtle)",display:"flex",flexDirection:"column",transform:`translateY(${L}px)`,transition:T?"none":"transform 0.3s ease-out",opacity:Y?.5:1},onTouchStart:V,onTouchMove:W,onTouchEnd:H,children:[e.jsx("div",{className:"sm:hidden flex justify-center pt-2 pb-1","data-drag-handle":!0,children:e.jsx("div",{className:"w-10 h-1 rounded-full transition-colors",style:{backgroundColor:Y?"var(--accent-red)":"var(--border-medium)"}})}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b flex-shrink-0 cursor-grab active:cursor-grabbing sm:cursor-default",style:{borderColor:"var(--border-subtle)"},"data-drag-handle":!0,children:[e.jsx("h2",{className:"text-base font-medium",style:{color:"var(--text-primary)"},children:a?"Editar Programada":"Programar Transacci√≥n"}),e.jsx("button",{onClick:l,disabled:h,className:"p-1.5 rounded-md transition-colors duration-150 hover:bg-[var(--bg-tertiary)] disabled:opacity-50",style:{color:"var(--text-muted)"},children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.75,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"p-3 sm:p-4 overflow-y-auto flex-1",children:o?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(_,{size:"md"})}):e.jsxs("form",{onSubmit:r,className:"space-y-3 sm:space-y-5",children:[!a&&e.jsx("div",{className:"inline-flex p-0.5 sm:p-1 rounded-lg mb-1",style:{backgroundColor:"var(--bg-tertiary)"},children:be.map(s=>{const m=u===s.id;return e.jsx("button",{type:"button",onClick:()=>S(s.id),className:"px-3 sm:px-4 py-1.5 sm:py-2 rounded-md text-xs sm:text-sm font-medium transition-all duration-150",style:{backgroundColor:m?s.bgDim:"transparent",color:m?s.color:"var(--text-muted)"},children:s.label},s.id)})}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs sm:text-sm font-medium mb-1.5 sm:mb-2",style:{color:"var(--text-secondary)"},children:[Z,"Fecha programada"]}),e.jsx(ne,{name:"fecha",value:n.fecha,onChange:k,minDate:v})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs sm:text-sm font-medium mb-1.5 sm:mb-2",style:{color:"var(--text-secondary)"},children:[G,u==="transfer"?"Monto a transferir":"Monto"]}),e.jsx("div",{className:"relative rounded-xl sm:rounded-2xl p-3 sm:p-4 transition-all duration-200",style:{backgroundColor:"var(--bg-tertiary)",border:"2px solid transparent"},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl sm:text-3xl font-bold",style:{color:$()},children:"$"}),e.jsx("input",{type:"number",name:"monto",value:n.monto,onChange:k,placeholder:"0",min:"0",step:"0.01",className:"flex-1 text-2xl sm:text-3xl font-bold bg-transparent outline-none",style:{color:"var(--text-primary)"}})]})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs sm:text-sm font-medium mb-1.5 sm:mb-2",style:{color:"var(--text-secondary)"},children:[B,u==="transfer"?"Cuenta origen":"Cuenta"]}),e.jsx(R,{name:"cuenta",value:n.cuenta,onChange:k,options:j.map(s=>({value:s.nombre,label:s.nombre,icon:s.icon||null})),placeholder:"Seleccionar cuenta",icon:B,emptyMessage:"No hay cuentas",defaultOptionIcon:"üí≥"})]}),u==="transfer"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs sm:text-sm font-medium mb-1.5 sm:mb-2",style:{color:"var(--text-secondary)"},children:[B,"Cuenta destino"]}),e.jsx(R,{name:"cuentaDestino",value:n.cuentaDestino,onChange:k,options:j.filter(s=>s.nombre!==n.cuenta).map(s=>({value:s.nombre,label:s.nombre,icon:s.icon||null})),placeholder:"Seleccionar cuenta destino",icon:B,emptyMessage:"No hay otras cuentas",defaultOptionIcon:"üí≥"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs sm:text-sm font-medium mb-1.5 sm:mb-2",style:{color:"var(--text-secondary)"},children:[G,"Monto en destino (si difiere)"]}),e.jsx("input",{type:"number",name:"montoDestino",value:n.montoDestino,onChange:k,placeholder:n.monto||"0",min:"0",step:"0.01",className:"w-full px-3 sm:px-4 py-2.5 sm:py-3 rounded-xl text-sm sm:text-base transition-all duration-200 border-2 border-transparent focus:border-[var(--accent-primary)]",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-primary)"}})]})]}),u!=="transfer"&&e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs sm:text-sm font-medium mb-1.5 sm:mb-2",style:{color:"var(--text-secondary)"},children:[q,"Categor√≠a"]}),e.jsx(R,{name:"categoria",value:n.categoria,onChange:k,options:Q,placeholder:"Seleccionar categor√≠a",icon:q,emptyMessage:"No hay categor√≠as",onCreateNew:()=>w(!0),createNewLabel:"Crear categor√≠a"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs sm:text-sm font-medium mb-1.5 sm:mb-2",style:{color:"var(--text-secondary)"},children:[D,"Nota (opcional)"]}),e.jsx("textarea",{name:"nota",value:n.nota,onChange:k,placeholder:"Agregar una nota...",rows:1,className:"w-full px-3 sm:px-4 py-2.5 sm:py-3 rounded-xl resize-none transition-all duration-200 border-2 border-transparent focus:border-[var(--accent-primary)] text-sm sm:text-base",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-primary)"}})]}),e.jsx("button",{type:"submit",disabled:!K||h,className:"w-full py-3 sm:py-4 rounded-xl font-semibold text-white text-sm sm:text-base transition-all duration-300 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:$()},children:h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),a?"Actualizar":"Programar"]})})]})}),i&&e.jsx("div",{className:"absolute bottom-3 left-3 right-3",children:e.jsx(J,{message:i.message,type:i.type,onClose:()=>x(null)})})]}),e.jsx(oe,{isOpen:P,onClose:()=>w(!1),type:u==="income"?"ingreso":"gasto",onCategoryCreated:s=>{g(m=>({...m,categoria:s})),M()}})]}),document.body)}function Ce(){const{showError:t}=ie(),[l,f]=c.useState([]),[a,b]=c.useState(!0),[d,C]=c.useState("pending"),[p,E]=c.useState("all"),[M,j]=c.useState(null),[h,y]=c.useState(!1),[i,x]=c.useState(!1),[P,w]=c.useState(null),[u,S]=c.useState(null),[v,n]=c.useState(null),g=c.useCallback(async(r=!0)=>{try{r&&b(!0);const o=await de();f(o.scheduled||[])}catch(o){console.error("Error fetching scheduled:",o),t("Error","No se pudieron cargar las transacciones programadas")}finally{r&&b(!1)}},[t]);c.useEffect(()=>{g()},[g]);const L=c.useMemo(()=>{let r=l;return d!=="all"&&(r=r.filter(o=>o.status===d)),p!=="all"&&(r=r.filter(o=>o.type===p)),r},[d,p,l]),N=c.useMemo(()=>({pending:l.filter(r=>r.status==="pending").length,executed:l.filter(r=>r.status==="executed").length,rejected:l.filter(r=>r.status==="rejected").length,all:l.length}),[l]),T=c.useMemo(()=>{const r=l.filter(o=>o.status==="pending");return{expenses:r.filter(o=>o.type==="expense").reduce((o,z)=>o+parseFloat(z.monto),0),incomes:r.filter(o=>o.type==="income").reduce((o,z)=>o+parseFloat(z.monto),0),count:r.length}},[l]),I=async r=>{try{x(!0),await ue(r.id),w({message:"Transacci√≥n ejecutada",type:"success"}),n(null),await g(!1)}catch(o){console.error("Error approving:",o),t("Error",o.message||"No se pudo aprobar la transacci√≥n")}finally{x(!1)}},A=async r=>{try{x(!0),await me(r.id),w({message:"Transacci√≥n rechazada",type:"success"}),await g(!1)}catch(o){console.error("Error rejecting:",o),t("Error",o.message||"No se pudo rechazar")}finally{x(!1)}},V=async()=>{if(u)try{x(!0),await xe(u.id),w({message:"Transacci√≥n eliminada",type:"success"}),S(null),await g(!1)}catch(r){console.error("Error deleting:",r),t("Error",r.message||"No se pudo eliminar")}finally{x(!1)}},W=r=>{j(r)},H=[{id:"pending",label:"Pendientes",count:N.pending},{id:"executed",label:"Ejecutadas",count:N.executed},{id:"rejected",label:"Rechazadas",count:N.rejected},{id:"all",label:"Todas",count:N.all}],k=[{id:"all",label:"Todos"},{id:"expense",label:"Gastos",color:"var(--accent-red)"},{id:"income",label:"Ingresos",color:"var(--accent-green)"},{id:"transfer",label:"Transferencias",color:"var(--accent-blue)"}];return a?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx(_,{})}):e.jsx(pe,{onRefresh:g,disabled:a,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",style:{color:"var(--text-primary)"},children:"Programadas"}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:"Transacciones futuras pendientes de aprobaci√≥n"})]}),e.jsxs("button",{onClick:()=>y(!0),className:"flex items-center gap-2 px-4 py-2.5 rounded-xl text-sm font-medium transition-colors",style:{backgroundColor:"var(--accent-primary)",color:"white"},children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{className:"hidden sm:inline",children:"Nueva programada"}),e.jsx("span",{className:"sm:hidden",children:"Nueva"})]})]}),N.pending>0&&e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"p-4 rounded-2xl",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("p",{className:"text-xs mb-1",style:{color:"var(--text-muted)"},children:"Gastos pendientes"}),e.jsx("p",{className:"text-lg font-bold",style:{color:"var(--accent-red)"},children:F(T.expenses,"Peso")})]}),e.jsxs("div",{className:"p-4 rounded-2xl",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("p",{className:"text-xs mb-1",style:{color:"var(--text-muted)"},children:"Ingresos pendientes"}),e.jsx("p",{className:"text-lg font-bold",style:{color:"var(--accent-green)"},children:F(T.incomes,"Peso")})]}),e.jsxs("div",{className:"p-4 rounded-2xl",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("p",{className:"text-xs mb-1",style:{color:"var(--text-muted)"},children:"Por aprobar"}),e.jsx("p",{className:"text-lg font-bold",style:{color:"var(--text-primary)"},children:T.count})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx("div",{className:"flex gap-1 p-1 rounded-xl flex-1 overflow-x-auto",style:{backgroundColor:"var(--bg-secondary)"},children:H.map(r=>e.jsxs("button",{onClick:()=>C(r.id),className:`
                  flex items-center gap-1.5 px-4 py-2 rounded-lg text-sm font-medium transition-colors flex-1 whitespace-nowrap
                  ${d===r.id?"shadow-sm":"hover:opacity-80"}
                `,style:{backgroundColor:d===r.id?"var(--bg-primary)":"transparent",color:d===r.id?"var(--text-primary)":"var(--text-muted)"},children:[r.label,r.count>0&&e.jsx("span",{className:"px-1.5 py-0.5 rounded-full text-xs",style:{backgroundColor:d===r.id?"var(--accent-primary-dim)":"var(--bg-tertiary)",color:d===r.id?"var(--accent-primary)":"var(--text-muted)"},children:r.count})]},r.id))}),e.jsx("div",{className:"flex gap-1 p-1 rounded-xl",style:{backgroundColor:"var(--bg-secondary)"},children:k.map(r=>e.jsx("button",{onClick:()=>E(r.id),className:"px-3 py-2 rounded-lg text-sm font-medium transition-colors",style:{backgroundColor:p===r.id?"var(--bg-primary)":"transparent",color:p===r.id?r.color||"var(--text-primary)":"var(--text-muted)"},children:r.label},r.id))})]}),L.length===0?e.jsxs("div",{className:"rounded-2xl p-8 text-center",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("div",{className:"w-16 h-16 rounded-full mx-auto mb-4 flex items-center justify-center",style:{backgroundColor:"var(--bg-tertiary)"},children:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",style:{color:"var(--text-muted)"},children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("p",{className:"font-medium mb-1",style:{color:"var(--text-primary)"},children:[d==="pending"&&"No hay transacciones pendientes",d==="executed"&&"No hay transacciones ejecutadas",d==="rejected"&&"No hay transacciones rechazadas",d==="all"&&"No hay transacciones programadas"]}),e.jsx("p",{className:"text-sm mb-4",style:{color:"var(--text-muted)"},children:d==="pending"||d==="all"?"Programa una transacci√≥n para una fecha futura":d==="executed"?"Las transacciones aprobadas aparecer√°n aqu√≠":"Las transacciones rechazadas aparecer√°n aqu√≠"}),(d==="all"||d==="pending")&&e.jsx("button",{onClick:()=>y(!0),className:"px-4 py-2 rounded-xl text-sm font-medium transition-colors",style:{backgroundColor:"var(--accent-primary)",color:"white"},children:"+ Programar transacci√≥n"})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:L.map(r=>e.jsx(ye,{scheduled:r,onClick:()=>r.status==="pending"?W(r):null,onApprove:r.status==="pending"?o=>n(o):void 0,onReject:r.status==="pending"?A:void 0,onEdit:r.status==="pending"?W:void 0,onDelete:r.status==="pending"?o=>S(o):void 0},r.id))}),e.jsx(je,{isOpen:h||!!M,onClose:()=>{y(!1),j(null)},onSuccess:()=>g(!1),editData:M}),v&&e.jsx(X,{title:"Aprobar transacci√≥n",message:`¬øAprobar y ejecutar esta transacci√≥n de ${F(v.monto,"Peso")}?`,confirmText:"Aprobar",confirmColor:"var(--accent-green)",onConfirm:()=>I(v),onCancel:()=>n(null),loading:i}),u&&e.jsx(X,{title:"Eliminar transacci√≥n",message:"¬øEst√°s seguro de que quieres eliminar esta transacci√≥n programada?",confirmText:"Eliminar",confirmColor:"var(--accent-red)",onConfirm:V,onCancel:()=>S(null),loading:i}),P&&e.jsx(J,{message:P.message,type:P.type,onClose:()=>w(null)})]})})}export{Ce as default};
