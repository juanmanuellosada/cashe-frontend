import{r as o,an as d,ao as T,j as e,ap as f,b as w,c as k,L as q,a6 as N,a7 as A}from"./index-CKWgcbuo.js";function z({variant:n="compact",className:i=""}){const[s,c]=o.useState({used:0,quota:0,percentage:0}),[r,x]=o.useState(!0);o.useEffect(()=>{l()},[]);const l=async()=>{try{const{data:{user:m}}=await d.auth.getUser();if(m){const y=await T(m.id);c(y)}}catch(m){console.error("Error loading storage usage:",m)}finally{x(!1)}};if(r)return null;const p=()=>s.percentage>=90?"var(--accent-red)":s.percentage>=70?"var(--accent-yellow, #eab308)":"var(--accent-primary)";return n==="compact"?e.jsxs("div",{className:`flex items-center gap-2 ${i}`,children:[e.jsx("div",{className:"flex-1 h-2 rounded-full overflow-hidden",style:{backgroundColor:"var(--bg-tertiary)"},children:e.jsx("div",{className:"h-full rounded-full transition-all",style:{width:`${Math.min(s.percentage,100)}%`,backgroundColor:p()}})}),e.jsxs("span",{className:"text-xs whitespace-nowrap",style:{color:"var(--text-secondary)"},children:[f(s.used)," / ",f(s.quota)]})]}):e.jsxs("div",{className:`p-4 rounded-xl ${i}`,style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:"Almacenamiento"}),e.jsxs("span",{className:"text-sm",style:{color:"var(--text-secondary)"},children:[s.percentage,"% usado"]})]}),e.jsx("div",{className:"h-3 rounded-full overflow-hidden mb-2",style:{backgroundColor:"var(--bg-tertiary)"},children:e.jsx("div",{className:"h-full rounded-full transition-all",style:{width:`${Math.min(s.percentage,100)}%`,backgroundColor:p()}})}),e.jsxs("p",{className:"text-xs",style:{color:"var(--text-secondary)"},children:[f(s.used)," de ",f(s.quota)," utilizados"]}),s.percentage>=90&&e.jsx("p",{className:"text-xs mt-2",style:{color:"var(--accent-red)"},children:"Almacenamiento casi lleno. Elimina adjuntos para liberar espacio."})]})}function B({isOpen:n,imageUrl:i,imageName:s,onClose:c}){return o.useEffect(()=>{const r=x=>{x.key==="Escape"&&c()};return n&&(document.addEventListener("keydown",r),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",r),document.body.style.overflow=""}},[n,c]),!n||!i?null:e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",onClick:c,children:[e.jsx("div",{className:"absolute inset-0 bg-black/90"}),e.jsxs("div",{className:"absolute top-4 right-4 flex items-center gap-2 z-10",children:[e.jsx("a",{href:i,target:"_blank",rel:"noopener noreferrer",onClick:r=>r.stopPropagation(),className:"w-10 h-10 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center transition-colors",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})}),e.jsx("button",{onClick:c,className:"w-10 h-10 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center transition-colors",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s&&e.jsx("div",{className:"absolute bottom-4 left-4 right-4 text-center z-10",children:e.jsx("p",{className:"text-white/80 text-sm truncate",children:s})}),e.jsx("img",{src:i,alt:s||"Preview",className:"relative max-w-full max-h-[85vh] object-contain rounded-lg shadow-2xl",onClick:r=>r.stopPropagation()})]})}function W(){const[n,i]=o.useState([]),[s,c]=o.useState(!0),[r,x]=o.useState("all"),[l,p]=o.useState(null);o.useEffect(()=>{m()},[]);const m=async()=>{try{c(!0);const{data:{user:a}}=await d.auth.getUser();if(!a)return;const{data:L}=await d.from("movements").select("id, type, date, amount, note, attachment_url, attachment_name, category_id, account_id").eq("user_id",a.id).not("attachment_url","is",null).order("date",{ascending:!1}),{data:M}=await d.from("transfers").select("id, date, from_amount, note, attachment_url, attachment_name, from_account_id, to_account_id").eq("user_id",a.id).not("attachment_url","is",null).order("date",{ascending:!1}),{data:E}=await d.from("card_statement_attachments").select("id, period, statement_url, statement_name, receipt_url, receipt_name, account_id").eq("user_id",a.id).order("period",{ascending:!1}),[{data:$},{data:S}]=await Promise.all([d.from("accounts").select("id, name").eq("user_id",a.id),d.from("categories").select("id, name").eq("user_id",a.id)]),u={};($||[]).forEach(t=>{u[t.id]=t.name});const j={};(S||[]).forEach(t=>{j[t.id]=t.name});const h=[];(L||[]).forEach(t=>{h.push({id:t.id,type:t.type==="income"?"incomes":"expenses",typeLabel:t.type==="income"?"Ingreso":"Gasto",date:t.date,description:j[t.category_id]||t.note||"Sin descripcion",account:u[t.account_id],attachmentUrl:t.attachment_url,attachmentName:t.attachment_name})}),(M||[]).forEach(t=>{h.push({id:t.id,type:"transfers",typeLabel:"Transferencia",date:t.date,description:`${u[t.from_account_id]||"?"} â†’ ${u[t.to_account_id]||"?"}`,attachmentUrl:t.attachment_url,attachmentName:t.attachment_name})}),(E||[]).forEach(t=>{const[v,U]=t.period.split("-"),b=w(new Date(v,U-1),"MMMM yyyy",{locale:k});t.statement_url&&h.push({id:`${t.id}-statement`,type:"statements",typeLabel:"Resumen TC",date:`${t.period}-01`,description:`${u[t.account_id]||"Tarjeta"} - ${b}`,attachmentUrl:t.statement_url,attachmentName:t.statement_name}),t.receipt_url&&h.push({id:`${t.id}-receipt`,type:"statements",typeLabel:"Comprobante TC",date:`${t.period}-01`,description:`${u[t.account_id]||"Tarjeta"} - ${b}`,attachmentUrl:t.receipt_url,attachmentName:t.receipt_name})}),h.sort((t,v)=>new Date(v.date)-new Date(t.date)),i(h)}catch(a){console.error("Error loading attachments:",a)}finally{c(!1)}},y=o.useMemo(()=>r==="all"?n:n.filter(a=>a.type===r),[n,r]),_=[{key:"all",label:"Todos"},{key:"expenses",label:"Gastos"},{key:"incomes",label:"Ingresos"},{key:"transfers",label:"Transferencias"},{key:"statements",label:"Tarjetas"}],g=a=>{switch(a){case"expenses":return"var(--accent-red)";case"incomes":return"var(--accent-green)";case"transfers":return"var(--accent-blue, #3b82f6)";case"statements":return"var(--accent-primary)";default:return"var(--text-secondary)"}},C=a=>{N(a.attachmentName)?p(a):A(a.attachmentUrl,a.attachmentName)};return s?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(q,{})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",style:{color:"var(--text-primary)"},children:"Adjuntos"}),e.jsxs("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:[n.length," archivo",n.length!==1?"s":""]})]}),e.jsx(z,{variant:"full"}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:_.map(a=>e.jsx("button",{onClick:()=>x(a.key),className:`px-4 py-2 rounded-xl text-sm font-medium whitespace-nowrap transition-colors ${r===a.key?"text-white":""}`,style:{backgroundColor:r===a.key?"var(--accent-primary)":"var(--bg-secondary)",color:r===a.key?"white":"var(--text-secondary)"},children:a.label},a.key))}),e.jsx("div",{className:"space-y-2",children:y.length===0?e.jsxs("div",{className:"text-center py-12 rounded-xl",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("svg",{className:"w-16 h-16 mx-auto mb-4",style:{color:"var(--text-muted)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})}),e.jsx("p",{style:{color:"var(--text-secondary)"},children:r==="all"?"No hay adjuntos":"No hay adjuntos en esta categoria"})]}):y.map(a=>e.jsxs("div",{onClick:()=>C(a),className:"flex items-center gap-3 p-3 rounded-xl cursor-pointer transition-all hover:scale-[1.01] active:scale-[0.99]",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("div",{className:"w-14 h-14 rounded-xl flex items-center justify-center flex-shrink-0 overflow-hidden",style:{backgroundColor:"var(--bg-tertiary)"},children:N(a.attachmentName)?e.jsx("img",{src:a.attachmentUrl,alt:"",className:"w-full h-full object-cover"}):e.jsx("svg",{className:"w-6 h-6",style:{color:"var(--text-muted)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",style:{color:"var(--text-primary)"},children:a.attachmentName}),e.jsx("p",{className:"text-xs truncate",style:{color:"var(--text-secondary)"},children:a.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full",style:{backgroundColor:`color-mix(in srgb, ${g(a.type)} 20%, transparent)`,color:g(a.type)},children:a.typeLabel}),e.jsx("span",{className:"text-xs",style:{color:"var(--text-muted)"},children:w(new Date(a.date),"d MMM yyyy",{locale:k})})]})]}),e.jsx("svg",{className:"w-5 h-5 flex-shrink-0",style:{color:"var(--text-muted)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})]},a.id))}),e.jsx(B,{isOpen:!!l,imageUrl:l==null?void 0:l.attachmentUrl,imageName:l==null?void 0:l.attachmentName,onClose:()=>p(null)})]})}export{W as default};
