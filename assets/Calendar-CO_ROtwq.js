import{ah as A,ae as Z,t as j,bf as D,bg as F,n as ee,r as x,b as c,s as H,o as P,v as S,ai as V,av as T,bh as z,j as e,L as se,e as g,f as p,bi as re,ao as te,bj as ae}from"./index-XMNSLHhk.js";function oe(u){return A(u,Date.now())}function ne(u,o,d){const[b,k]=Z(d==null?void 0:d.in,u,o);return+j(b,d)==+j(k,d)}function R(u,o){return D(A(u,u),oe(u))}function le(u,o,d){return F(u,-1,d)}function ie(){const{showError:u}=ee(),[o,d]=x.useState(new Date),[b,k]=x.useState(new Date),[L,I]=x.useState([]),[W,B]=x.useState(!0),[f,G]=x.useState("all"),[i,O]=x.useState("month");x.useEffect(()=>{(async()=>{try{B(!0);let r,n;if(i==="month"){const v=H(o),l=P(o);r=j(v,{weekStartsOn:1}),n=S(l,{weekStartsOn:1})}else r=j(o,{weekStartsOn:1}),n=S(o,{weekStartsOn:1});const t=c(r,"yyyy-MM-dd"),a=c(n,"yyyy-MM-dd"),h=await re(t,a);I(h||[])}catch(r){console.error("Error fetching calendar events:",r),u("Error","No se pudieron cargar los eventos del calendario")}finally{B(!1)}})()},[o,i]);const N=x.useMemo(()=>{const s=Array.isArray(L)?L:[];return f==="all"?s:s.filter(r=>r.type===f)},[L,f]),w=x.useMemo(()=>{const s={};return N.forEach(r=>{s[r.date]||(s[r.date]=[]),s[r.date].push(r)}),s},[N]),C=x.useMemo(()=>{const s=c(b,"yyyy-MM-dd");return w[s]||[]},[b,w]),$=s=>{const r=w[s]||[];let n=0,t=0;return r.forEach(a=>{a.type==="income"?n+=a.amount:a.type==="expense"&&(t+=a.amount)}),{income:n,expense:t}},_=x.useMemo(()=>{const s=H(o),r=P(o),n=j(s,{weekStartsOn:1}),t=S(r,{weekStartsOn:1}),a=[];let h=n;for(;h<=t;)a.push(h),h=V(h,1);return a},[o]),J=x.useMemo(()=>{const s=j(o,{weekStartsOn:1}),r=[];for(let n=0;n<7;n++)r.push(V(s,n));return r},[o]),q=()=>{d(i==="month"?te(o,1):le(o))},K=()=>{d(i==="month"?ae(o,1):F(o,1))},Q=()=>{d(new Date),k(new Date)},y=s=>{switch(s){case"income":return"var(--accent-green)";case"expense":return"var(--accent-red)";case"transfer":return"var(--accent-blue)";default:return"var(--text-muted)"}},E=(s,r=!1)=>{if(r)switch(s){case"income":return"color-mix(in srgb, var(--accent-green) 10%, transparent)";case"expense":return"color-mix(in srgb, var(--accent-red) 10%, transparent)";case"transfer":return"color-mix(in srgb, var(--accent-blue) 10%, transparent)";default:return"var(--bg-tertiary)"}switch(s){case"income":return"var(--accent-green-dim)";case"expense":return"var(--accent-red-dim)";case"transfer":return"var(--accent-blue-dim)";default:return"var(--bg-tertiary)"}},U=[{id:"all",label:"Todos"},{id:"expense",label:"Gastos",color:"var(--accent-red)"},{id:"income",label:"Ingresos",color:"var(--accent-green)"},{id:"transfer",label:"Transferencias",color:"var(--accent-blue)"}],X=["Lun","Mar","Mié","Jue","Vie","Sáb","Dom"],Y=()=>{if(i==="month")return c(o,"MMMM yyyy",{locale:g});{const s=j(o,{weekStartsOn:1}),r=S(o,{weekStartsOn:1}),n=c(s,"MMM",{locale:g}),t=c(r,"MMM",{locale:g});return n===t?`${c(s,"d")} - ${c(r,"d")} ${c(r,"MMMM yyyy",{locale:g})}`:`${c(s,"d MMM",{locale:g})} - ${c(r,"d MMM yyyy",{locale:g})}`}},M=x.useMemo(()=>{let s;if(i==="month")s=N.filter(t=>T(z(t.date),o));else{const t=j(o,{weekStartsOn:1});s=N.filter(a=>ne(z(a.date),t,{weekStartsOn:1}))}const r=s.filter(t=>t.type==="income").reduce((t,a)=>t+a.amount,0),n=s.filter(t=>t.type==="expense").reduce((t,a)=>t+a.amount,0);return{income:r,expense:n,balance:r-n}},[N,o,i]);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",style:{color:"var(--text-primary)"},children:"Calendario"}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:"Visualiza todos tus movimientos"})]}),e.jsxs("div",{className:"flex items-center gap-2 self-start",children:[e.jsxs("div",{className:"flex p-1 rounded-xl",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("button",{onClick:()=>O("month"),className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors ${i==="month"?"shadow-sm":""}`,style:{backgroundColor:i==="month"?"var(--bg-primary)":"transparent",color:i==="month"?"var(--text-primary)":"var(--text-muted)"},children:"Mes"}),e.jsx("button",{onClick:()=>O("week"),className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors ${i==="week"?"shadow-sm":""}`,style:{backgroundColor:i==="week"?"var(--bg-primary)":"transparent",color:i==="week"?"var(--text-primary)":"var(--text-muted)"},children:"Semana"})]}),e.jsx("button",{onClick:Q,className:"px-4 py-2 rounded-xl text-sm font-medium transition-colors",style:{backgroundColor:"var(--accent-primary)",color:"white"},children:"Hoy"})]})]}),e.jsx("div",{className:"flex gap-1 p-1 rounded-xl overflow-x-auto",style:{backgroundColor:"var(--bg-secondary)"},children:U.map(s=>e.jsx("button",{onClick:()=>G(s.id),className:`
              px-4 py-2 rounded-lg text-sm font-medium transition-colors whitespace-nowrap flex-shrink-0
              ${f===s.id?"shadow-sm":"hover:opacity-80"}
            `,style:{backgroundColor:f===s.id?"var(--bg-primary)":"transparent",color:f===s.id?s.color||"var(--text-primary)":"var(--text-muted)"},children:s.label},s.id))}),e.jsxs("div",{className:"rounded-2xl overflow-hidden",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",style:{borderBottom:"1px solid var(--border-subtle)"},children:[e.jsx("button",{onClick:q,className:"p-2 rounded-lg transition-colors hover:bg-[var(--bg-tertiary)]",style:{color:"var(--text-secondary)"},children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("h2",{className:"text-lg font-semibold capitalize",style:{color:"var(--text-primary)"},children:Y()}),e.jsx("button",{onClick:K,className:"p-2 rounded-lg transition-colors hover:bg-[var(--bg-tertiary)]",style:{color:"var(--text-secondary)"},children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-px",style:{backgroundColor:"var(--border-subtle)"},children:X.map(s=>e.jsx("div",{className:"px-2 py-2 text-center text-xs font-medium",style:{backgroundColor:"var(--bg-secondary)",color:"var(--text-muted)"},children:s},s))}),W?e.jsx("div",{className:"flex items-center justify-center py-20",style:{backgroundColor:"var(--bg-secondary)"},children:e.jsx(se,{})}):i==="month"?e.jsx("div",{className:"grid grid-cols-7 gap-px",style:{backgroundColor:"var(--border-subtle)"},children:_.map((s,r)=>{const n=c(s,"yyyy-MM-dd"),t=w[n]||[],a=$(n),h=T(s,o),v=D(s,b),l=R(s);return e.jsxs("button",{onClick:()=>k(s),className:`
                    relative min-h-[80px] p-1.5 text-left transition-all
                    ${h?"":"opacity-40"}
                    ${v?"ring-2 ring-inset":""}
                  `,style:{backgroundColor:v?"var(--bg-tertiary)":"var(--bg-secondary)",ringColor:"var(--accent-primary)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:`
                        w-6 h-6 flex items-center justify-center text-xs font-medium rounded-full
                        ${l?"text-white":""}
                      `,style:{backgroundColor:l?"var(--accent-primary)":"transparent",color:l?"white":"var(--text-primary)"},children:c(s,"d")}),t.length>0&&e.jsx("span",{className:"text-[10px] px-1 rounded",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-muted)"},children:t.length})]}),e.jsxs("div",{className:"space-y-0.5",children:[t.slice(0,3).map(m=>e.jsxs("div",{className:`flex items-center gap-1 px-1 py-0.5 rounded text-[10px] truncate ${m.isScheduled?"border border-dashed":""}`,style:{backgroundColor:E(m.type,m.isScheduled),color:y(m.type),borderColor:m.isScheduled?y(m.type):"transparent",opacity:m.isScheduled?.8:1},children:[m.isRecurring&&e.jsx("svg",{className:"w-2 h-2 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),m.isFuture&&e.jsx("svg",{className:"w-2 h-2 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),m.isScheduled&&e.jsx("svg",{className:"w-2 h-2 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("span",{className:"truncate",children:m.name})]},m.id)),t.length>3&&e.jsxs("div",{className:"text-[10px] px-1",style:{color:"var(--text-muted)"},children:["+",t.length-3," más"]})]}),(a.income>0||a.expense>0)&&e.jsxs("div",{className:"hidden sm:flex absolute bottom-1 right-1 gap-1 text-[9px]",children:[a.income>0&&e.jsxs("span",{style:{color:"var(--accent-green)"},children:["+",p(a.income,"Peso")]}),a.expense>0&&e.jsxs("span",{style:{color:"var(--accent-red)"},children:["-",p(a.expense,"Peso")]})]})]},r)})}):e.jsx("div",{className:"grid grid-cols-7 gap-px",style:{backgroundColor:"var(--border-subtle)"},children:J.map((s,r)=>{const n=c(s,"yyyy-MM-dd"),t=w[n]||[],a=$(n),h=D(s,b),v=R(s);return e.jsxs("button",{onClick:()=>k(s),className:`
                    relative min-h-[200px] p-2 text-left transition-all flex flex-col
                    ${h?"ring-2 ring-inset":""}
                  `,style:{backgroundColor:h?"var(--bg-tertiary)":"var(--bg-secondary)",ringColor:"var(--accent-primary)"},children:[e.jsxs("div",{className:"flex flex-col items-center mb-2 pb-2 border-b",style:{borderColor:"var(--border-subtle)"},children:[e.jsx("span",{className:`
                        w-8 h-8 flex items-center justify-center text-sm font-bold rounded-full mb-1
                        ${v?"text-white":""}
                      `,style:{backgroundColor:v?"var(--accent-primary)":"transparent",color:v?"white":"var(--text-primary)"},children:c(s,"d")}),e.jsx("span",{className:"text-[10px] capitalize",style:{color:"var(--text-muted)"},children:c(s,"EEE",{locale:g})})]}),e.jsxs("div",{className:"flex-1 space-y-1 overflow-y-auto",children:[t.map(l=>e.jsx("div",{className:`flex items-center gap-1 px-1.5 py-1 rounded text-[11px] ${l.isScheduled?"border border-dashed":""}`,style:{backgroundColor:E(l.type,l.isScheduled),color:y(l.type),borderColor:l.isScheduled?y(l.type):"transparent",opacity:l.isScheduled?.8:1},children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[l.isRecurring&&e.jsx("svg",{className:"w-2.5 h-2.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),l.isFuture&&e.jsx("svg",{className:"w-2.5 h-2.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),l.isScheduled&&e.jsx("svg",{className:"w-2.5 h-2.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("span",{className:"truncate font-medium",children:l.name})]}),e.jsxs("div",{className:"text-[10px] opacity-80",children:[l.type==="expense"?"-":l.type==="income"?"+":"",p(l.amount,"Peso")]})]})},l.id)),t.length===0&&e.jsx("div",{className:"text-[10px] text-center py-2",style:{color:"var(--text-muted)"},children:"Sin eventos"})]}),(a.income>0||a.expense>0)&&e.jsxs("div",{className:"mt-2 pt-2 border-t text-[10px] space-y-0.5",style:{borderColor:"var(--border-subtle)"},children:[a.income>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:"var(--text-muted)"},children:"Ingresos"}),e.jsxs("span",{style:{color:"var(--accent-green)"},children:["+",p(a.income,"Peso")]})]}),a.expense>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:"var(--text-muted)"},children:"Gastos"}),e.jsxs("span",{style:{color:"var(--accent-red)"},children:["-",p(a.expense,"Peso")]})]})]})]},r)})})]}),e.jsxs("div",{className:"rounded-2xl p-4",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold capitalize",style:{color:"var(--text-primary)"},children:c(b,"EEEE d 'de' MMMM",{locale:g})}),C.length>0&&e.jsxs("span",{className:"text-sm",style:{color:"var(--text-muted)"},children:[C.length," evento",C.length!==1?"s":""]})]}),C.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-12 h-12 rounded-full mx-auto mb-3 flex items-center justify-center",style:{backgroundColor:"var(--bg-tertiary)"},children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",style:{color:"var(--text-muted)"},children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:"No hay movimientos para este día"})]}):e.jsx("div",{className:"space-y-2",children:C.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl transition-colors",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsxs("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0",style:{backgroundColor:E(s.type)},children:[s.type==="income"&&e.jsx("svg",{className:"w-5 h-5",style:{color:y(s.type)},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),s.type==="expense"&&e.jsx("svg",{className:"w-5 h-5",style:{color:y(s.type)},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})}),s.type==="transfer"&&e.jsx("svg",{className:"w-5 h-5",style:{color:y(s.type)},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium text-sm truncate",style:{color:"var(--text-primary)"},children:s.name}),s.isRecurring&&e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] flex-shrink-0",style:{backgroundColor:"var(--accent-purple-dim)",color:"var(--accent-purple)"},children:"Recurrente"}),s.isFuture&&e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] flex-shrink-0",style:{backgroundColor:"var(--accent-yellow-dim)",color:"var(--accent-yellow)"},children:"Futuro"}),s.eventType==="recurring_scheduled"&&e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] flex-shrink-0",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-muted)"},children:"Próximo"}),s.isScheduled&&e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] flex-shrink-0 border border-dashed",style:{backgroundColor:"var(--accent-orange-dim)",color:"var(--accent-orange)",borderColor:"var(--accent-orange)"},children:"Por aprobar"})]}),s.account&&e.jsx("p",{className:"text-xs truncate",style:{color:"var(--text-muted)"},children:s.account})]})]}),e.jsxs("span",{className:"font-semibold text-sm whitespace-nowrap ml-3",style:{color:y(s.type)},children:[s.type==="expense"?"-":s.type==="income"?"+":"",p(s.amount,"Peso")]})]},s.id))})]}),e.jsxs("div",{className:"rounded-2xl p-4",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("h4",{className:"text-sm font-medium mb-3",style:{color:"var(--text-primary)"},children:"Leyenda"}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:"var(--accent-green)"}}),e.jsx("span",{className:"text-xs",style:{color:"var(--text-secondary)"},children:"Ingreso"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:"var(--accent-red)"}}),e.jsx("span",{className:"text-xs",style:{color:"var(--text-secondary)"},children:"Gasto"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:"var(--accent-blue)"}}),e.jsx("span",{className:"text-xs",style:{color:"var(--text-secondary)"},children:"Transferencia"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-3 h-3",style:{color:"var(--accent-purple)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),e.jsx("span",{className:"text-xs",style:{color:"var(--text-secondary)"},children:"Recurrente"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded border border-dashed",style:{borderColor:"var(--accent-orange)",backgroundColor:"var(--accent-orange-dim)"}}),e.jsx("span",{className:"text-xs",style:{color:"var(--text-secondary)"},children:"Por aprobar"})]})]})]}),!W&&e.jsxs("div",{className:"rounded-2xl p-4",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsxs("h4",{className:"text-sm font-medium mb-3",style:{color:"var(--text-primary)"},children:["Resumen ",i==="month"?"del mes":"de la semana"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs mb-1",style:{color:"var(--text-muted)"},children:"Ingresos"}),e.jsx("p",{className:"font-bold",style:{color:"var(--accent-green)"},children:p(M.income,"Peso")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs mb-1",style:{color:"var(--text-muted)"},children:"Gastos"}),e.jsx("p",{className:"font-bold",style:{color:"var(--accent-red)"},children:p(M.expense,"Peso")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs mb-1",style:{color:"var(--text-muted)"},children:"Balance"}),e.jsx("p",{className:"font-bold",style:{color:M.balance>=0?"var(--accent-green)":"var(--accent-red)"},children:p(M.balance,"Peso")})]})]})]})]})}export{ie as default};
