import{g as j,r as a,Y as A,n as b,o as B,j as i,E as R,U,V as N,W as P,p as T,q}from"./index-Dv-ULL4h.js";import{M as L}from"./MovementsList-KA6S6MJr.js";import{P as O}from"./PullToRefresh-CumY_n-8.js";import"./DateRangePicker-CBPnoqCm.js";import"./subMonths-C5ug4mPQ.js";import"./SortDropdown-BRfzETxI.js";function H(){const{showError:u}=j(),[v,l]=a.useState([]),[m,S]=a.useState([]),[g,y]=a.useState({ingresos:[],gastos:[]}),[f,p]=a.useState(!0),[w,c]=a.useState(null),[I,h]=a.useState(!1),[E,x]=a.useState(!1),o=a.useCallback(async(t=!1,e=!0)=>{try{e&&p(!0);const[s,n,r]=await Promise.all([A(t),b(),B()]);l(s.incomes||[]),S(n.accounts||[]),y(r.categorias||{ingresos:[],gastos:[]})}catch(s){console.error("Error fetching data:",s)}finally{e&&p(!1)}},[]);a.useEffect(()=>{o()},[o]);const D=async t=>{try{h(!0),await q(t),c(null),await o(!0,!1)}catch(e){console.error("Error updating:",e),u("No se pudo guardar el ingreso",e.message)}finally{h(!1)}},M=async t=>{c(null),l(e=>e.filter(s=>s.rowIndex!==t.rowIndex));try{await T(t)}catch(e){console.error("Error deleting:",e),u("No se pudo eliminar el ingreso",e.message),o()}},k=async t=>{const e=new Set(t.map(s=>s.rowIndex));l(s=>s.filter(n=>!e.has(n.rowIndex))),await P(t),await o()},C=async(t,e,s)=>{const n=new Set(t.map(r=>r.rowIndex));l(r=>r.map(d=>n.has(d.rowIndex)?{...d,[e]:s}:d)),await N(t,e,s),await o()};return i.jsxs(O,{onRefresh:o,disabled:f,children:[i.jsx(L,{title:"Ingresos",movements:v,accounts:m,categories:g.ingresos||[],loading:f,onMovementClick:c,onMovementDelete:M,onBulkDelete:k,onBulkUpdate:C,onAddClick:()=>x(!0),type:"ingreso"}),w&&i.jsx(R,{movement:w,accounts:m,categories:g,onSave:D,onDelete:M,onClose:()=>c(null),onConvertedToRecurring:()=>o(!0,!1),loading:I}),i.jsx(U,{isOpen:E,onClose:()=>{x(!1),o()},defaultType:"income"})]})}export{H as default};
