import{g as k,r as o,$ as G,o as H,p as _,n as T,j as d,E as U,X as j,Y as b,v as r,Z as B,q as R,D as n,w as P}from"./index-k7BheE9E.js";import{M as q}from"./MovementsList-D6ykBfNP.js";import{P as L}from"./PullToRefresh-UYnO5keD.js";import"./DateRangePicker-B1Gin6QR.js";import"./subMonths-iIdC1yWY.js";import"./SortDropdown-CK6cdXia.js";function J(){const{showError:g}=k(),[N,i]=o.useState([]),[C,A]=o.useState([]),[E,v]=o.useState({ingresos:[],gastos:[]}),[f,p]=o.useState(!0),[w,u]=o.useState(null),[I,D]=o.useState(!1),[h,S]=o.useState(!1),a=o.useCallback(async(t=!1,e=!0)=>{try{e&&p(!0);const[s,l,c]=await Promise.all([G(t),H(),_()]);i(s.incomes||[]),A(l.accounts||[]),v(c.categorias||{ingresos:[],gastos:[]})}catch(s){console.error("Error fetching data:",s)}finally{e&&p(!1)}},[]);o.useEffect(()=>{a()},[a]),T(n.INCOMES_CHANGED,()=>a(!0,!1));const x=async t=>{try{D(!0),await P(t),u(null),r(n.INCOMES_CHANGED),r(n.ACCOUNTS_CHANGED),await a(!0,!1)}catch(e){console.error("Error updating:",e),g("No se pudo guardar el ingreso",e.message)}finally{D(!1)}},M=async t=>{u(null),i(e=>e.filter(s=>s.rowIndex!==t.rowIndex));try{await R(t),r(n.INCOMES_CHANGED),r(n.ACCOUNTS_CHANGED)}catch(e){console.error("Error deleting:",e),g("No se pudo eliminar el ingreso",e.message),a()}},y=async t=>{const e=new Set(t.map(s=>s.rowIndex));i(s=>s.filter(l=>!e.has(l.rowIndex))),await B(t),r(n.INCOMES_CHANGED),r(n.ACCOUNTS_CHANGED),await a()},O=async(t,e,s)=>{const l=new Set(t.map(c=>c.rowIndex));i(c=>c.map(m=>l.has(m.rowIndex)?{...m,[e]:s}:m)),await b(t,e,s),r(n.INCOMES_CHANGED),r(n.ACCOUNTS_CHANGED),await a()};return d.jsxs(L,{onRefresh:a,disabled:f,children:[d.jsx(q,{title:"Ingresos",movements:N,accounts:C,categories:E.ingresos||[],loading:f,onMovementClick:u,onMovementDelete:M,onBulkDelete:y,onBulkUpdate:O,onAddClick:()=>S(!0),type:"ingreso"}),w&&d.jsx(U,{movement:w,accounts:C,categories:E,onSave:x,onDelete:M,onClose:()=>u(null),onConvertedToRecurring:()=>a(!0,!1),loading:I}),d.jsx(j,{isOpen:h,onClose:()=>{S(!1),a()},defaultType:"income"})]})}export{J as default};
