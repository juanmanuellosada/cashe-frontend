import{j as e,am as U,f as $,r as i,i as q,a4 as G,D as O,g as H,an as Y,w as V,x as J,L as K,T as Q,ao as X,ap as Z,aq as _,ar as ee,as as se}from"./index-CBBw_BsA.js";import{P as re,M as F}from"./MultiSelectDropdown-DGqB0ZEa.js";import{I as te}from"./IconPicker-B72NQrxI.js";function ae({budget:a,onClick:C,onPause:S,onDelete:P,categories:u=[],accounts:I=[]}){const{name:g,amount:f,currency:y,spent:s=0,remaining:E=0,percentageUsed:j=0,period_type:b,daysRemaining:B=0,is_paused:x,is_global:p,category_ids:d=[],account_ids:k=[],icon:h,projectedRecurring:v=0,projectedTotal:D=0,projectedRemaining:n=0,projectedPercentageUsed:N=0}=a,z=d.map(m=>{const l=u.find(T=>T.id===m);return(l==null?void 0:l.nombre)||(l==null?void 0:l.name)}).filter(Boolean).slice(0,2),L=k.map(m=>{const l=I.find(T=>T.id===m);return(l==null?void 0:l.nombre)||(l==null?void 0:l.name)}).filter(Boolean).slice(0,2),o={weekly:"Semanal",monthly:"Mensual",yearly:"Anual",custom:"Personalizado"},w=j>100,R=v>0,M=!w&&N>100,A=B>0?E/B:0;return e.jsxs("div",{onClick:C,className:`
        relative rounded-2xl p-4 cursor-pointer transition-all
        hover:scale-[1.02] hover:shadow-lg
        ${x?"opacity-60":""}
      `,style:{backgroundColor:"var(--bg-secondary)",border:w?"2px solid var(--accent-red)":"1px solid var(--border-subtle)"},children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[h&&e.jsx("span",{className:"text-xl",children:h}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm",style:{color:"var(--text-primary)"},children:g}),e.jsx("span",{className:"text-xs",style:{color:"var(--text-muted)"},children:o[b]})]})]}),x?e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-muted)"},children:"Pausado"}):w?e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium",style:{backgroundColor:"var(--accent-red-dim)",color:"var(--accent-red)"},children:"Excedido"}):M?e.jsxs("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium flex items-center gap-1",style:{backgroundColor:"var(--accent-yellow-dim)",color:"var(--accent-yellow)"},children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01"})}),"Atenci칩n"]}):null]}),e.jsx(U,{value:s,max:f,variant:"budget",size:"md",showLabel:!1,className:"mb-3"}),e.jsxs("div",{className:"flex items-baseline justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-lg font-bold",style:{color:w?"var(--accent-red)":"var(--text-primary)"},children:$(s,y)}),e.jsxs("span",{className:"text-sm ml-1",style:{color:"var(--text-muted)"},children:["/ ",$(f,y)]})]}),e.jsxs("span",{className:"text-sm font-medium",style:{color:w?"var(--accent-red)":"var(--text-secondary)"},children:[j.toFixed(0),"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",style:{color:"var(--text-muted)"},children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("span",{children:[B," d칤as restantes"]})]}),E>0&&!x&&e.jsxs("span",{children:["~",$(A,y),"/d칤a disponible"]})]}),R&&!x&&e.jsxs("div",{className:"mt-3 pt-3 border-t",style:{borderColor:"var(--border-subtle)"},children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",style:{color:"var(--accent-purple)"},children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),e.jsx("span",{className:"text-xs font-medium",style:{color:"var(--accent-purple)"},children:"Recurrentes pendientes"})]}),e.jsxs("div",{className:"relative h-1.5 rounded-full overflow-hidden mb-2",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsx("div",{className:"absolute left-0 top-0 h-full rounded-full transition-all",style:{width:`${Math.min(j,100)}%`,backgroundColor:w?"var(--accent-red)":"var(--accent-primary)"}}),e.jsx("div",{className:"absolute top-0 h-full rounded-full transition-all",style:{left:`${Math.min(j,100)}%`,width:`${Math.min(N-j,100-j)}%`,background:M?"repeating-linear-gradient(45deg, var(--accent-red), var(--accent-red) 2px, var(--accent-red-dim) 2px, var(--accent-red-dim) 4px)":"repeating-linear-gradient(45deg, var(--accent-purple), var(--accent-purple) 2px, var(--accent-purple-dim) 2px, var(--accent-purple-dim) 4px)"}})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{style:{color:"var(--text-muted)"},children:["+",$(v,y)," programados"]}),e.jsxs("span",{className:"font-medium",style:{color:M?"var(--accent-red)":"var(--text-secondary)"},children:["Proyectado: ",N.toFixed(0),"%"]})]}),M&&e.jsxs("div",{className:"flex items-center gap-1.5 mt-2 px-2 py-1.5 rounded-lg text-xs",style:{backgroundColor:"var(--accent-red-dim)",color:"var(--accent-red)"},children:[e.jsx("svg",{className:"w-3.5 h-3.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("span",{children:"Exceder치 el presupuesto con recurrentes"})]})]}),!p&&(d.length>0||k.length>0)&&e.jsxs("div",{className:"flex flex-wrap gap-1 mt-3 pt-3 border-t",style:{borderColor:"var(--border-subtle)"},children:[z.map((m,l)=>e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs",style:{backgroundColor:"var(--accent-primary-dim)",color:"var(--accent-primary)"},children:m},`cat-${l}`)),d.length>2&&e.jsxs("span",{className:"px-2 py-0.5 rounded-full text-xs",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-muted)"},children:["+",d.length-2]}),L.map((m,l)=>e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs",style:{backgroundColor:"var(--accent-blue-dim, rgba(59, 130, 246, 0.15))",color:"var(--accent-blue)"},children:m},`acc-${l}`))]}),p&&e.jsx("div",{className:"mt-3 pt-3 border-t",style:{borderColor:"var(--border-subtle)"},children:e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-secondary)"},children:"Todos los gastos"})}),e.jsx("div",{className:"absolute top-3 right-3 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",onClick:m=>m.stopPropagation(),children:S&&e.jsx("button",{onClick:m=>{m.stopPropagation(),S(a)},className:"p-1.5 rounded-lg transition-colors hover:bg-black/10",title:x?"Reanudar":"Pausar",children:x?e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]}):e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"})})})})]})}function oe({budget:a=null,categories:C=[],accounts:S=[],onSave:P,onDelete:u,onDuplicate:I,onClose:g,loading:f=!1}){const y=!!a,[s,E]=i.useState({name:"",amount:"",currency:"ARS",periodType:"monthly",startDate:new Date().toISOString().split("T")[0],endDate:"",isRecurring:!0,categoryIds:[],accountIds:[],isGlobal:!1,icon:""}),[j,b]=i.useState(!1),[B,x]=i.useState(!1),[p,d]=i.useState({}),[k,h]=i.useState(0),[v,D]=i.useState(!1),n=i.useRef(0);i.useEffect(()=>{h(0),D(!1)},[a]),i.useEffect(()=>{var r;a&&E({name:a.name||"",amount:((r=a.amount)==null?void 0:r.toString())||"",currency:a.currency||"ARS",periodType:a.period_type||"monthly",startDate:a.start_date||new Date().toISOString().split("T")[0],endDate:a.end_date||"",isRecurring:a.is_recurring??!0,categoryIds:a.category_ids||[],accountIds:a.account_ids||[],isGlobal:a.is_global||!1,icon:a.icon||""})},[a]);const N=r=>{r.target.closest("[data-drag-handle]")&&(n.current=r.touches[0].clientY,D(!0))},z=r=>{if(!v)return;const t=r.touches[0].clientY-n.current;t>0&&h(t)},L=()=>{v&&(k>100&&!f&&g(),h(0),D(!1))},o=(r,t)=>{E(c=>({...c,[r]:t})),p[r]&&d(c=>({...c,[r]:null}))},w=()=>{const r={};s.name.trim()||(r.name="El nombre es requerido");const t=parseFloat(s.amount);return(!s.amount||isNaN(t)||t<=0)&&(r.amount="Ingresa un monto v치lido mayor a 0"),s.periodType==="custom"&&!s.endDate&&(r.endDate="Selecciona una fecha de fin"),d(r),Object.keys(r).length===0},R=r=>{r.preventDefault(),w()&&P({...a&&{id:a.id},name:s.name.trim(),amount:parseFloat(s.amount),currency:s.currency,periodType:s.periodType,startDate:s.startDate,endDate:s.periodType==="custom"?s.endDate:null,isRecurring:s.isRecurring,categoryIds:s.isGlobal?[]:s.categoryIds,accountIds:s.isGlobal?[]:s.accountIds,isGlobal:s.isGlobal,icon:s.icon||null,isActive:(a==null?void 0:a.is_active)??!0,isPaused:(a==null?void 0:a.is_paused)??!1})},M=()=>{b(!0)},A=()=>{b(!1),u==null||u(a)},m=C.filter(r=>r.tipo==="Gasto"||r.type==="expense").map((r,t)=>({id:r.id||r.rowIndex||`cat-${t}`,name:r.nombre||r.name||r.label,icon:r.icon})),l=S.map((r,t)=>({id:r.id||r.rowIndex||`acc-${t}`,name:r.nombre||r.name,icon:r.icon})),T=Math.max(.6-k/300,0),W=k>100;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"fixed inset-0 z-50 flex items-start sm:items-center justify-center overflow-y-auto sm:py-6",children:[e.jsx("div",{className:"absolute inset-0 backdrop-blur-sm transition-opacity animate-fade-in",style:{backgroundColor:`rgba(0, 0, 0, ${T})`},onClick:g}),e.jsxs("div",{className:"relative w-full sm:max-w-lg max-h-[90vh] sm:max-h-[calc(100vh-48px)] overflow-y-auto sm:mx-4 mt-0 rounded-b-2xl sm:rounded-2xl p-4 sm:p-5 animate-slide-down",style:{backgroundColor:"var(--bg-secondary)",transform:`translateY(${k}px)`,transition:v?"none":"transform 0.3s ease-out",opacity:W?.5:1},onTouchStart:N,onTouchMove:z,onTouchEnd:L,children:[e.jsx("div",{className:"sm:hidden flex justify-center -mt-2 mb-1","data-drag-handle":!0,children:e.jsx("div",{className:"w-10 h-1 rounded-full transition-colors",style:{backgroundColor:W?"var(--accent-red)":"var(--border-medium)"}})}),e.jsxs("div",{className:"flex items-center justify-between py-2 sm:py-3 mb-3 border-b",style:{borderColor:"var(--border-subtle)"},"data-drag-handle":!0,children:[e.jsx("h2",{className:"text-base sm:text-lg font-semibold",style:{color:"var(--text-primary)"},children:y?"Editar presupuesto":"Nuevo presupuesto"}),e.jsx("button",{onClick:g,className:"p-1.5 rounded-lg transition-colors hover:bg-black/10",style:{color:"var(--text-muted)"},children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:R,className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium mb-1.5",style:{color:"var(--text-secondary)"},children:"Nombre"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>x(!0),className:"w-10 h-10 sm:w-12 sm:h-12 rounded-lg sm:rounded-xl flex items-center justify-center text-lg sm:text-xl transition-colors hover:opacity-80",style:{backgroundColor:"var(--bg-tertiary)"},children:s.icon?q(s.icon)?s.icon:e.jsx("img",{src:s.icon,alt:"",className:"w-6 h-6 sm:w-8 sm:h-8 rounded-lg object-contain"}):"游눯"}),e.jsx("input",{type:"text",value:s.name,onChange:r=>o("name",r.target.value),placeholder:"Ej: Gastos mensuales",className:"flex-1 px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg sm:rounded-xl text-sm outline-none transition-all focus:ring-2",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-primary)","--tw-ring-color":"var(--accent-primary)"}})]}),p.name&&e.jsx("p",{className:"text-xs mt-1",style:{color:"var(--accent-red)"},children:p.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium mb-1.5",style:{color:"var(--text-secondary)"},children:"Monto l칤mite"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",value:s.amount,onChange:r=>o("amount",r.target.value),placeholder:"0",min:"0",step:"0.01",className:"flex-1 px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg sm:rounded-xl text-sm outline-none transition-all focus:ring-2",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-primary)","--tw-ring-color":"var(--accent-primary)"}}),e.jsxs("div",{className:"flex rounded-lg sm:rounded-xl p-0.5 sm:p-1",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsxs("button",{type:"button",onClick:()=>o("currency","ARS"),className:"px-2 sm:px-3 py-2 rounded-md sm:rounded-lg text-xs font-medium transition-colors flex items-center gap-1",style:{backgroundColor:s.currency==="ARS"?"var(--bg-elevated)":"transparent",color:s.currency==="ARS"?"var(--text-primary)":"var(--text-muted)"},children:[e.jsx("img",{src:"/icons/catalog/ARS.svg",alt:"ARS",className:"w-4 h-4 rounded-sm"}),e.jsx("span",{className:"hidden sm:inline",children:"ARS"})]}),e.jsxs("button",{type:"button",onClick:()=>o("currency","USD"),className:"px-2 sm:px-3 py-2 rounded-md sm:rounded-lg text-xs font-medium transition-colors flex items-center gap-1",style:{backgroundColor:s.currency==="USD"?"var(--bg-elevated)":"transparent",color:s.currency==="USD"?"var(--text-primary)":"var(--text-muted)"},children:[e.jsx("img",{src:"/icons/catalog/USD.svg",alt:"USD",className:"w-4 h-4 rounded-sm"}),e.jsx("span",{className:"hidden sm:inline",children:"USD"})]})]})]}),p.amount&&e.jsx("p",{className:"text-xs mt-1",style:{color:"var(--accent-red)"},children:p.amount})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium mb-1.5",style:{color:"var(--text-secondary)"},children:"Per칤odo"}),e.jsx(re,{value:s.periodType,onChange:r=>o("periodType",r)})]}),e.jsxs("div",{className:`grid gap-2 ${s.periodType==="custom"?"grid-cols-2":"grid-cols-1"}`,children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] sm:text-xs font-medium mb-1",style:{color:"var(--text-muted)"},children:s.periodType==="custom"?"Inicio":"Fecha de inicio"}),e.jsx(G,{value:s.startDate,onChange:r=>o("startDate",r.target.value),compact:s.periodType==="custom"})]}),s.periodType==="custom"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] sm:text-xs font-medium mb-1",style:{color:"var(--text-muted)"},children:"Fin"}),e.jsx(G,{value:s.endDate,onChange:r=>o("endDate",r.target.value),compact:!0}),p.endDate&&e.jsx("p",{className:"text-[10px] mt-0.5",style:{color:"var(--accent-red)"},children:p.endDate})]})]}),e.jsxs("button",{type:"button",onClick:()=>o("isGlobal",!s.isGlobal),className:"flex items-center gap-2 w-full p-2 rounded-lg transition-colors",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsx("div",{className:`w-4 h-4 rounded flex items-center justify-center transition-all duration-200 flex-shrink-0 ${s.isGlobal?"":"border-2"}`,style:{backgroundColor:s.isGlobal?"var(--accent-primary)":"transparent",borderColor:"var(--text-secondary)"},children:s.isGlobal&&e.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),e.jsxs("div",{className:"flex-1 text-left min-w-0",children:[e.jsx("p",{className:"text-xs font-medium",style:{color:"var(--text-primary)"},children:"Global"}),e.jsx("p",{className:"text-[10px]",style:{color:"var(--text-muted)"},children:"Todos los gastos"})]})]}),!s.isGlobal&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(F,{items:m,selectedIds:s.categoryIds,onChange:r=>o("categoryIds",r),label:"Categor칤as",placeholder:"Todas",emptyMessage:"Sin categor칤as"}),e.jsx(F,{items:l,selectedIds:s.accountIds,onChange:r=>o("accountIds",r),label:"Cuentas",placeholder:"Todas",emptyMessage:"Sin cuentas"})]}),e.jsxs("button",{type:"button",onClick:()=>o("isRecurring",!s.isRecurring),className:"flex items-center gap-2 w-full p-2 rounded-lg transition-colors",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsx("div",{className:`w-4 h-4 rounded flex items-center justify-center transition-all duration-200 flex-shrink-0 ${s.isRecurring?"":"border-2"}`,style:{backgroundColor:s.isRecurring?"var(--accent-primary)":"transparent",borderColor:"var(--text-secondary)"},children:s.isRecurring&&e.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),e.jsxs("div",{className:"flex-1 text-left min-w-0",children:[e.jsx("p",{className:"text-xs font-medium",style:{color:"var(--text-primary)"},children:"Recurrente"}),e.jsx("p",{className:"text-[10px]",style:{color:"var(--text-muted)"},children:"Se reinicia cada per칤odo"})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[y&&u&&e.jsx("button",{type:"button",onClick:M,disabled:f,className:"px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg sm:rounded-xl text-xs sm:text-sm font-medium transition-colors",style:{backgroundColor:"var(--accent-red-dim)",color:"var(--accent-red)"},children:"Eliminar"}),y&&I&&e.jsx("button",{type:"button",onClick:()=>I(a),disabled:f,className:"px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg sm:rounded-xl text-xs sm:text-sm font-medium transition-colors",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-secondary)"},children:"Duplicar"}),e.jsx("button",{type:"submit",disabled:f,className:"flex-1 px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg sm:rounded-xl text-xs sm:text-sm font-medium transition-colors disabled:opacity-50",style:{backgroundColor:"var(--accent-primary)",color:"white"},children:f?"Guardando...":y?"Guardar":"Crear"})]})]})]})]}),e.jsx(O,{isOpen:j,onClose:()=>b(!1),onConfirm:A,title:"Eliminar presupuesto",message:`쮼st치s seguro de que quieres eliminar "${a==null?void 0:a.name}"? Esta acci칩n no se puede deshacer.`,confirmText:"Eliminar",cancelText:"Cancelar",variant:"danger"}),e.jsx(te,{isOpen:B,onClose:()=>x(!1),onSelect:r=>o("icon",r),currentValue:s.icon,showPredefined:!1,title:"Seleccionar 칤cono"})]})}function ie(){const{showError:a}=H(),{budgets:C,activeBudgets:S,pausedBudgets:P,exceededBudgets:u,loading:I,refetch:g}=Y(),{accounts:f}=V(),{categoriesWithId:y}=J(),[s,E]=i.useState("active"),[j,b]=i.useState(null),[B,x]=i.useState(!1),[p,d]=i.useState(!1),[k,h]=i.useState(null),[v,D]=i.useState(!1),[n,N]=i.useState(new Set),[z,L]=i.useState(!1),o=i.useMemo(()=>{switch(s){case"active":return S;case"paused":return P;case"exceeded":return u;case"all":default:return C}},[s,C,S,P,u]),w=async t=>{try{d(!0),t.id?(await ee(t),h({message:"Presupuesto actualizado",type:"success"})):(await se(t),h({message:"Presupuesto creado",type:"success"})),x(!1),b(null),await g()}catch(c){console.error("Error saving budget:",c),a("Error",c.message||"No se pudo guardar el presupuesto")}finally{d(!1)}},R=async t=>{try{d(!0),await _(t.id),h({message:"Presupuesto eliminado",type:"success"}),b(null),await g()}catch(c){console.error("Error deleting budget:",c),a("Error",c.message||"No se pudo eliminar el presupuesto")}finally{d(!1)}},M=async t=>{try{d(!0),await Z(t.id),h({message:"Presupuesto duplicado",type:"success"}),b(null),await g()}catch(c){console.error("Error duplicating budget:",c),a("Error",c.message||"No se pudo duplicar el presupuesto")}finally{d(!1)}},A=async t=>{try{await X(t.id),h({message:t.is_paused?"Presupuesto reanudado":"Presupuesto pausado",type:"success"}),await g()}catch(c){console.error("Error toggling pause:",c),a("Error",c.message||"No se pudo cambiar el estado")}},m=()=>{D(!v),N(new Set)},l=t=>{const c=new Set(n);c.has(t)?c.delete(t):c.add(t),N(c)},T=()=>{n.size===o.length?N(new Set):N(new Set(o.map(t=>t.id)))},W=async()=>{try{d(!0);const t=Array.from(n).map(c=>_(c));await Promise.all(t),h({message:`${n.size} presupuesto${n.size!==1?"s":""} eliminado${n.size!==1?"s":""}`,type:"success"}),N(new Set),D(!1),L(!1),await g()}catch(t){console.error("Error deleting budgets:",t),a("Error",t.message||"No se pudieron eliminar los presupuestos")}finally{d(!1)}},r=[{id:"active",label:"Activos",count:S.length},{id:"paused",label:"Pausados",count:P.length},{id:"exceeded",label:"Excedidos",count:u.length},{id:"all",label:"Todos",count:C.length}];return I?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx(K,{})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",style:{color:"var(--text-primary)"},children:"Presupuestos"}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:"Controla tus l칤mites de gasto"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[C.length>0&&!v&&e.jsx("button",{onClick:m,className:"p-2 rounded-xl transition-colors",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-secondary)"},title:"Selecci칩n m칰ltiple",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 5h7M4 12h7m-7 7h7m5-14v14m0-14l3 3m-3-3l-3 3m3 11l3-3m-3 3l-3-3"})})}),!v&&e.jsxs("button",{onClick:()=>x(!0),className:"flex items-center gap-2 px-4 py-2.5 rounded-xl text-sm font-medium transition-colors",style:{backgroundColor:"var(--accent-primary)",color:"white"},children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{className:"hidden sm:inline",children:"Nuevo presupuesto"}),e.jsx("span",{className:"sm:hidden",children:"Nuevo"})]})]})]}),v&&e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl",style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--accent-primary)"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:m,className:"p-2 rounded-lg transition-colors hover:bg-[var(--bg-tertiary)]",style:{color:"var(--text-secondary)"},title:"Cancelar selecci칩n",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("button",{onClick:T,className:"flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm font-medium transition-colors hover:bg-[var(--bg-tertiary)]",style:{color:"var(--text-secondary)"},children:[e.jsx("div",{className:"w-5 h-5 rounded border-2 flex items-center justify-center transition-colors",style:{borderColor:n.size===o.length&&o.length>0?"var(--accent-primary)":"var(--border-subtle)",backgroundColor:n.size===o.length&&o.length>0?"var(--accent-primary)":"transparent"},children:n.size===o.length&&o.length>0&&e.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),"Todos"]}),e.jsxs("span",{className:"text-sm",style:{color:"var(--text-muted)"},children:[n.size," seleccionado",n.size!==1?"s":""]})]}),n.size>0&&e.jsxs("button",{onClick:()=>L(!0),className:"flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-medium transition-colors",style:{backgroundColor:"var(--accent-red-dim)",color:"var(--accent-red)"},children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Eliminar (",n.size,")"]})]}),e.jsx("div",{className:"flex gap-1 p-1 rounded-xl overflow-x-auto",style:{backgroundColor:"var(--bg-secondary)"},children:r.map(t=>e.jsxs("button",{onClick:()=>E(t.id),className:`
              flex items-center gap-1.5 px-4 py-2 rounded-lg text-sm font-medium transition-colors whitespace-nowrap
              ${s===t.id?"shadow-sm":"hover:opacity-80"}
            `,style:{backgroundColor:s===t.id?"var(--bg-primary)":"transparent",color:s===t.id?"var(--text-primary)":"var(--text-muted)"},children:[t.label,t.count>0&&e.jsx("span",{className:"px-1.5 py-0.5 rounded-full text-xs",style:{backgroundColor:s===t.id?"var(--accent-primary-dim)":"var(--bg-tertiary)",color:s===t.id?"var(--accent-primary)":"var(--text-muted)"},children:t.count})]},t.id))}),u.length>0&&s!=="exceeded"&&e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl",style:{backgroundColor:"var(--accent-red-dim)",border:"1px solid var(--accent-red)"},children:[e.jsx("svg",{className:"w-5 h-5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",style:{color:"var(--accent-red)"},children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsxs("p",{className:"text-sm",style:{color:"var(--accent-red)"},children:["Tienes ",u.length," presupuesto",u.length!==1?"s":""," excedido",u.length!==1?"s":""," este per칤odo"]})]}),o.length===0?e.jsxs("div",{className:"rounded-2xl p-8 text-center",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("div",{className:"w-16 h-16 rounded-full mx-auto mb-4 flex items-center justify-center",style:{backgroundColor:"var(--bg-tertiary)"},children:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",style:{color:"var(--text-muted)"},children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"})})}),e.jsxs("p",{className:"font-medium mb-1",style:{color:"var(--text-primary)"},children:[s==="active"&&"No hay presupuestos activos",s==="paused"&&"No hay presupuestos pausados",s==="exceeded"&&"No hay presupuestos excedidos",s==="all"&&"No hay presupuestos"]}),e.jsx("p",{className:"text-sm mb-4",style:{color:"var(--text-muted)"},children:s==="all"||s==="active"?"Crea tu primer presupuesto para controlar tus gastos":"Los presupuestos aparecer치n aqu칤"}),(s==="all"||s==="active")&&e.jsx("button",{onClick:()=>x(!0),className:"px-4 py-2 rounded-xl text-sm font-medium transition-colors",style:{backgroundColor:"var(--accent-primary)",color:"white"},children:"+ Crear presupuesto"})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:o.map(t=>e.jsxs("div",{className:"relative",children:[v&&e.jsx("button",{onClick:()=>l(t.id),className:"absolute top-3 left-3 z-10 w-6 h-6 rounded-lg border-2 flex items-center justify-center transition-all",style:{borderColor:n.has(t.id)?"var(--accent-primary)":"var(--border-subtle)",backgroundColor:n.has(t.id)?"var(--accent-primary)":"var(--bg-secondary)"},children:n.has(t.id)&&e.jsx("svg",{className:"w-3.5 h-3.5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),e.jsx(ae,{budget:t,categories:y,accounts:f,onClick:()=>v?l(t.id):b(t),onPause:v?void 0:A})]},t.id))}),(B||j)&&e.jsx(oe,{budget:j,categories:y,accounts:f,onSave:w,onDelete:R,onDuplicate:M,onClose:()=>{x(!1),b(null)},loading:p}),k&&e.jsx(Q,{message:k.message,type:k.type,onClose:()=>h(null)}),z&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-md animate-fade-in",onClick:()=>L(!1)}),e.jsx("div",{className:"relative w-full max-w-sm rounded-2xl p-6 animate-scale-in",style:{backgroundColor:"var(--bg-secondary)"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-2xl flex items-center justify-center",style:{backgroundColor:"rgba(255, 92, 114, 0.12)",boxShadow:"0 0 30px rgba(255, 92, 114, 0.2)"},children:e.jsx("svg",{className:"w-8 h-8",style:{color:"var(--accent-red)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.75,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),e.jsx("h3",{className:"text-lg font-bold mb-2",style:{color:"var(--text-primary)"},children:"Eliminar presupuestos"}),e.jsxs("p",{className:"text-sm mb-5",style:{color:"var(--text-secondary)"},children:["쮼st치s seguro de que quieres eliminar ",n.size," presupuesto",n.size!==1?"s":"","?",e.jsx("br",{}),e.jsx("span",{className:"text-xs mt-1 inline-block",style:{color:"var(--text-muted)"},children:"Esta acci칩n no se puede deshacer"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>L(!1),className:"flex-1 py-3.5 rounded-xl font-semibold transition-all duration-200 hover:bg-[var(--bg-tertiary)] active:scale-[0.98]",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-primary)"},children:"Cancelar"}),e.jsx("button",{onClick:W,disabled:p,className:"flex-1 py-3.5 rounded-xl font-semibold text-white transition-all duration-200 hover:opacity-90 active:scale-[0.98] disabled:opacity-50",style:{backgroundColor:"var(--accent-red)",boxShadow:"0 4px 20px rgba(255, 92, 114, 0.3)"},children:p?"Eliminando...":"Eliminar"})]})]})})]})]})}export{ie as default};
