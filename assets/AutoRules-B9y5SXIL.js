import{an as k,r as d,bm as se,x as re,D as oe,j as e,ad as z,bn as H,o as le,G as ne,y as ce,z as ie,bo as L,Q as F,bp as de,bq as me,br as ue,bs as P,bt as xe}from"./index-MY64-eYD.js";import{C as pe}from"./check-ByHpKmcW.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]],ve=k("bot",ye);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],he=k("chevron-down",ge);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],fe=k("chevron-up",be);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],Ne=k("ellipsis-vertical",je);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],we=k("loader-circle",Ce);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],_e=k("pencil",ke);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],D=k("plus",Ee);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]],Ae=k("power",Se);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Re=k("square-check-big",Oe);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],M=k("trash-2",Me);function De(){const[a,x]=d.useState([]),[m,j]=d.useState(!0),[v,N]=d.useState(null),p=d.useCallback(async(i=!0)=>{try{i&&j(!0),N(null);const s=await se();x(s.rules||[])}catch(s){N(s.message),console.error("Error fetching auto rules:",s)}finally{i&&j(!1)}},[]);d.useEffect(()=>{p()},[p]),re(oe.RULES_CHANGED,()=>p(!1));const h=d.useCallback(async()=>{await p(!0)},[p]),u=a.filter(i=>i.is_active),g=a.filter(i=>!i.is_active);return{rules:a,activeRules:u,inactiveRules:g,loading:m,error:v,refetch:h}}const Ie=[{value:"note",label:"Nota"},{value:"amount",label:"Monto"},{value:"account_id",label:"Cuenta"},{value:"type",label:"Tipo"}],q={note:[{value:"contains",label:"contiene"},{value:"equals",label:"es igual a"},{value:"starts_with",label:"empieza con"},{value:"ends_with",label:"termina con"}],amount:[{value:"equals",label:"es igual a"},{value:"greater_than",label:"mayor que"},{value:"less_than",label:"menor que"},{value:"between",label:"entre"}],account_id:[{value:"equals",label:"es"}],type:[{value:"equals",label:"es"}]},Te=[{value:"expense",label:"Gasto"},{value:"income",label:"Ingreso"}];function $e({condition:a,index:x,onChange:m,onRemove:j,canRemove:v,accounts:N=[]}){const p=q[a.field]||[],h=s=>{var y;const n=s.target.value,r=q[n]||[];m(x,{...a,field:n,operator:((y=r[0])==null?void 0:y.value)||"equals",value:""})},u=s=>{m(x,{...a,operator:s.target.value})},g=s=>{m(x,{...a,value:s.target.value})},i=()=>{if(a.field==="type")return e.jsxs("select",{value:a.value,onChange:g,className:"px-3 py-2 rounded-lg text-sm min-w-[100px]",style:{backgroundColor:"var(--bg-secondary)",color:"var(--text-primary)",border:"1px solid var(--border-medium)"},children:[e.jsx("option",{value:"",children:"Seleccionar..."}),Te.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]});if(a.field==="account_id"){const s=N.map(n=>({value:n.id,label:n.name||n.nombre,icon:n.icon||null}));return e.jsx("div",{className:"min-w-[140px] max-w-[200px]",children:e.jsx(z,{name:`condition-account-${x}`,value:a.value,onChange:g,options:s,placeholder:"Seleccionar...",emptyMessage:"No hay cuentas",defaultOptionIcon:"ðŸ’³"})})}if(a.field==="amount"&&a.operator==="between"){const[s,n]=(a.value||"|").split("|");return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",value:s||"",onChange:r=>m(x,{...a,value:`${r.target.value}|${n||""}`}),placeholder:"MÃ­n",className:"w-20 px-3 py-2 rounded-lg text-sm",style:{backgroundColor:"var(--bg-secondary)",color:"var(--text-primary)",border:"1px solid var(--border-medium)"}}),e.jsx("span",{className:"text-sm",style:{color:"var(--text-secondary)"},children:"y"}),e.jsx("input",{type:"number",value:n||"",onChange:r=>m(x,{...a,value:`${s||""}|${r.target.value}`}),placeholder:"MÃ¡x",className:"w-20 px-3 py-2 rounded-lg text-sm",style:{backgroundColor:"var(--bg-secondary)",color:"var(--text-primary)",border:"1px solid var(--border-medium)"}})]})}return a.field==="amount"?e.jsx("input",{type:"number",value:a.value,onChange:g,placeholder:"Ej: 5000",className:"w-28 px-3 py-2 rounded-lg text-sm",style:{backgroundColor:"var(--bg-secondary)",color:"var(--text-primary)",border:"1px solid var(--border-medium)"}}):e.jsx("input",{type:"text",value:a.value,onChange:g,placeholder:"Ej: mercadopago, spotify...",className:"min-w-[140px] max-w-[220px] px-3 py-2 rounded-lg text-sm",style:{backgroundColor:"var(--bg-secondary)",color:"var(--text-primary)",border:"1px solid var(--border-medium)"}})};return e.jsxs("div",{className:"flex flex-wrap items-center gap-2 p-3 rounded-xl",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--text-secondary)"},children:"Si"}),e.jsx("select",{value:a.field,onChange:h,className:"px-3 py-2 rounded-lg text-sm",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-medium)"},children:Ie.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),e.jsx("select",{value:a.operator,onChange:u,className:"px-3 py-2 rounded-lg text-sm",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-medium)"},children:p.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),i(),v&&e.jsx("button",{type:"button",onClick:()=>j(x),className:"p-2 rounded-lg transition-colors",style:{color:"var(--accent-red)"},onMouseEnter:s=>s.target.style.backgroundColor="rgba(239, 68, 68, 0.1)",onMouseLeave:s=>s.target.style.backgroundColor="transparent",children:e.jsx(M,{className:"w-4 h-4"})})]})}const ze=[{value:"category_id",label:"CategorÃ­a"},{value:"account_id",label:"Cuenta"}];function Le({action:a,index:x,onChange:m,onRemove:j,canRemove:v,categories:N=[],accounts:p=[]}){const h=r=>{m(x,{...a,field:r.target.value,value:""})},u=r=>{m(x,{...a,value:r.target.value})},g=r=>{if(!r)return"";const y=/^[\u{1F300}-\u{1F9FF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}]\s*/u;return r.replace(y,"").trim()},i=N.map(r=>{const y=r.label||r.value||r.name||r.nombre,C=!!r.icon;return{value:r.id,label:C?g(y):y,icon:r.icon||null}}),s=p.map(r=>({value:r.id,label:r.name||r.nombre,icon:r.icon||null})),n=()=>a.field==="category_id"?e.jsx("div",{className:"min-w-[160px] max-w-[220px]",children:e.jsx(z,{name:`action-category-${x}`,value:a.value,onChange:u,options:i,placeholder:"Seleccionar...",emptyMessage:"No hay categorÃ­as",defaultOptionIcon:"ðŸ“"})}):a.field==="account_id"?e.jsx("div",{className:"min-w-[160px] max-w-[220px]",children:e.jsx(z,{name:`action-account-${x}`,value:a.value,onChange:u,options:s,placeholder:"Seleccionar...",emptyMessage:"No hay cuentas",defaultOptionIcon:"ðŸ’³"})}):null;return e.jsxs("div",{className:"flex flex-wrap items-center gap-2 p-3 rounded-xl",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--text-secondary)"},children:"Asignar"}),e.jsx("select",{value:a.field,onChange:h,className:"px-3 py-2 rounded-lg text-sm",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-medium)"},children:ze.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))}),e.jsx("span",{className:"text-sm",style:{color:"var(--text-secondary)"},children:"â†’"}),n(),v&&e.jsx("button",{type:"button",onClick:()=>j(x),className:"p-2 rounded-lg transition-colors",style:{color:"var(--accent-red)"},onMouseEnter:r=>r.target.style.backgroundColor="rgba(239, 68, 68, 0.1)",onMouseLeave:r=>r.target.style.backgroundColor="transparent",children:e.jsx(M,{className:"w-4 h-4"})})]})}const V={field:"note",operator:"contains",value:""},G={field:"category_id",value:""};function Fe({rule:a,onSave:x,onClose:m,onDelete:j,loading:v,categories:N=[],accounts:p=[]}){const h=!!a,[u,g]=d.useState({name:"",logicOperator:"AND",priority:0,isActive:!0}),[i,s]=d.useState([{...V}]),[n,r]=d.useState([{...G}]),[y,C]=d.useState({});d.useEffect(()=>{var t,c;a&&(g({name:a.name||"",logicOperator:a.logic_operator||"AND",priority:a.priority||0,isActive:a.is_active!==!1}),((t=a.conditions)==null?void 0:t.length)>0&&s(a.conditions.map(l=>({field:l.field,operator:l.operator,value:l.value}))),((c=a.actions)==null?void 0:c.length)>0&&r(a.actions.map(l=>({field:l.field,value:l.value}))))},[a]);const S=()=>{const t={};return u.name.trim()||(t.name="El nombre es requerido"),i.length===0?t.conditions="Debe tener al menos una condiciÃ³n":i.find(l=>!l.value&&l.field!=="type")&&(t.conditions="Todas las condiciones deben tener un valor"),n.length===0?t.actions="Debe tener al menos una acciÃ³n":n.find(l=>!l.value)&&(t.actions="Todas las acciones deben tener un valor"),C(t),Object.keys(t).length===0},w=async t=>{t.preventDefault(),S()&&await x({id:a==null?void 0:a.id,name:u.name.trim(),logicOperator:u.logicOperator,priority:u.priority,isActive:u.isActive,conditions:i,actions:n})},_=(t,c)=>{const l=[...i];l[t]=c,s(l)},b=t=>{s(i.filter((c,l)=>l!==t))},A=(t,c)=>{const l=[...n];l[t]=c,r(l)},f=t=>{r(n.filter((c,l)=>l!==t))};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:m}),e.jsxs("div",{className:"relative w-full max-w-2xl max-h-[90vh] overflow-auto rounded-2xl shadow-2xl",style:{backgroundColor:"var(--bg-primary)"},children:[e.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between px-6 py-4 border-b",style:{backgroundColor:"var(--bg-primary)",borderColor:"var(--border-medium)"},children:[e.jsx("h2",{className:"text-lg font-semibold",style:{color:"var(--text-primary)"},children:h?"Editar regla":"Nueva regla"}),e.jsx("button",{onClick:m,className:"p-2 rounded-lg transition-colors",style:{color:"var(--text-secondary)"},children:e.jsx(H,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:w,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:"Nombre de la regla"}),e.jsx("input",{type:"text",value:u.name,onChange:t=>g({...u,name:t.target.value}),placeholder:"Ej: Netflix mensual, Supermercado...",className:"w-full px-4 py-3 rounded-xl text-sm",style:{backgroundColor:"var(--bg-secondary)",color:"var(--text-primary)",border:y.name?"1px solid var(--accent-red)":"1px solid var(--border-medium)"}}),y.name&&e.jsx("p",{className:"mt-1 text-xs",style:{color:"var(--accent-red)"},children:y.name})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:"Condiciones"}),i.length>1&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs",style:{color:"var(--text-secondary)"},children:"Combinar con:"}),e.jsxs("select",{value:u.logicOperator,onChange:t=>g({...u,logicOperator:t.target.value}),className:"px-2 py-1 rounded-lg text-xs font-medium",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-medium)"},children:[e.jsx("option",{value:"AND",children:"Y (todas)"}),e.jsx("option",{value:"OR",children:"O (alguna)"})]})]})]}),e.jsx("div",{className:"space-y-2",children:i.map((t,c)=>e.jsx($e,{condition:t,index:c,onChange:_,onRemove:b,canRemove:i.length>1,accounts:p},c))}),y.conditions&&e.jsx("p",{className:"mt-2 text-xs",style:{color:"var(--accent-red)"},children:y.conditions}),e.jsxs("button",{type:"button",onClick:()=>s([...i,{...V}]),className:"mt-3 flex items-center gap-2 px-3 py-2 rounded-lg text-sm transition-colors",style:{color:"var(--accent-primary)",backgroundColor:"rgba(20, 184, 166, 0.1)"},children:[e.jsx(D,{className:"w-4 h-4"}),"Agregar condiciÃ³n"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-3",style:{color:"var(--text-primary)"},children:"Acciones"}),e.jsx("div",{className:"space-y-2",children:n.map((t,c)=>e.jsx(Le,{action:t,index:c,onChange:A,onRemove:f,canRemove:n.length>1,categories:N,accounts:p},c))}),y.actions&&e.jsx("p",{className:"mt-2 text-xs",style:{color:"var(--accent-red)"},children:y.actions}),e.jsxs("button",{type:"button",onClick:()=>r([...n,{...G}]),className:"mt-3 flex items-center gap-2 px-3 py-2 rounded-lg text-sm transition-colors",style:{color:"var(--accent-primary)",backgroundColor:"rgba(20, 184, 166, 0.1)"},children:[e.jsx(D,{className:"w-4 h-4"}),"Agregar acciÃ³n"]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3 pt-4 border-t",style:{borderColor:"var(--border-medium)"},children:[h&&j?e.jsxs("button",{type:"button",onClick:()=>j(a),className:"px-4 py-2 rounded-xl text-sm font-medium transition-colors flex items-center gap-2",style:{color:"var(--accent-red)",backgroundColor:"rgba(239, 68, 68, 0.1)"},children:[e.jsx(M,{className:"w-4 h-4"}),"Eliminar"]}):e.jsx("div",{}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:m,className:"px-4 py-2 rounded-xl text-sm font-medium transition-colors",style:{color:"var(--text-secondary)",backgroundColor:"var(--bg-secondary)"},children:"Cancelar"}),e.jsxs("button",{type:"submit",disabled:v,className:"px-4 py-2 rounded-xl text-sm font-medium text-white transition-colors flex items-center gap-2",style:{backgroundColor:v?"var(--text-secondary)":"var(--accent-primary)"},children:[v&&e.jsx(we,{className:"w-4 h-4 animate-spin"}),h?"Guardar cambios":"Crear regla"]})]})]})]})]})]})}const B={note:"Nota",amount:"Monto",account_id:"Cuenta",type:"Tipo",category_id:"CategorÃ­a"},Pe={contains:"contiene",equals:"es igual a",starts_with:"empieza con",ends_with:"termina con",greater_than:"mayor que",less_than:"menor que",between:"entre"};function qe({rule:a,categories:x=[],accounts:m=[],onEdit:j,onDelete:v,onToggle:N,selectionMode:p=!1,selected:h=!1,onSelect:u}){var S,w,_,b,A,f;const[g,i]=d.useState(!1),[s,n]=d.useState(!1),r=t=>!t||typeof t=="string"&&(t.startsWith("/")||t.startsWith("http"))?"ðŸ“":t,y=(t,c)=>{if(t==="category_id"){const l=x.find(R=>R.id===c);return l?`${r(l.icon)} ${l.label||l.value||l.name||l.nombre}`:c}if(t==="account_id"){const l=m.find(R=>R.id===c);return l?l.name||l.nombre:c}return t==="type"?c==="expense"?"Gasto":"Ingreso":c},C=()=>{p?u==null||u(a.id):i(!g)};return e.jsxs("div",{className:`rounded-2xl overflow-hidden transition-all ${h?"ring-2 ring-[var(--accent-primary)]":""}`,style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-medium)",opacity:a.is_active?1:.6},children:[e.jsxs("div",{className:"flex items-center justify-between p-4 cursor-pointer",onClick:C,children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[p?e.jsx("div",{className:`w-5 h-5 rounded-md border-2 flex items-center justify-center shrink-0 transition-colors ${h?"bg-[var(--accent-primary)] border-[var(--accent-primary)]":"border-[var(--border-medium)]"}`,children:h&&e.jsx(pe,{className:"w-3 h-3 text-white"})}):e.jsx("div",{className:"w-2 h-2 rounded-full shrink-0",style:{backgroundColor:a.is_active?"var(--accent-green)":"var(--text-muted)"}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",style:{color:"var(--text-primary)"},children:a.name}),e.jsxs("p",{className:"text-xs mt-0.5",style:{color:"var(--text-secondary)"},children:[((S=a.conditions)==null?void 0:S.length)||0," condiciÃ³n",((w=a.conditions)==null?void 0:w.length)!==1?"es":""," â€¢"," ",((_=a.actions)==null?void 0:_.length)||0," acciÃ³n",((b=a.actions)==null?void 0:b.length)!==1?"es":""]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[!p&&e.jsx("button",{onClick:t=>{t.stopPropagation(),v(a)},className:"p-2 rounded-lg transition-colors hover:bg-red-500/10",style:{color:"var(--text-muted)"},title:"Eliminar",children:e.jsx(M,{className:"w-4 h-4"})}),!p&&e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:t=>{t.stopPropagation(),n(!s)},className:"p-2 rounded-lg transition-colors",style:{color:"var(--text-secondary)"},children:e.jsx(Ne,{className:"w-4 h-4"})}),s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:t=>{t.stopPropagation(),n(!1)}}),e.jsxs("div",{className:"absolute right-0 top-full mt-1 z-20 py-1 rounded-xl shadow-lg min-w-[140px]",style:{backgroundColor:"var(--bg-tertiary)",border:"1px solid var(--border-medium)"},children:[e.jsxs("button",{onClick:t=>{t.stopPropagation(),n(!1),j(a)},className:"w-full flex items-center gap-2 px-4 py-2 text-sm text-left transition-colors",style:{color:"var(--text-primary)"},children:[e.jsx(_e,{className:"w-4 h-4"}),"Editar"]}),e.jsxs("button",{onClick:t=>{t.stopPropagation(),n(!1),N(a)},className:"w-full flex items-center gap-2 px-4 py-2 text-sm text-left transition-colors",style:{color:"var(--text-primary)"},children:[e.jsx(Ae,{className:"w-4 h-4"}),a.is_active?"Desactivar":"Activar"]}),e.jsxs("button",{onClick:t=>{t.stopPropagation(),n(!1),v(a)},className:"w-full flex items-center gap-2 px-4 py-2 text-sm text-left transition-colors",style:{color:"var(--accent-red)"},children:[e.jsx(M,{className:"w-4 h-4"}),"Eliminar"]})]})]})]}),!p&&(g?e.jsx(fe,{className:"w-4 h-4",style:{color:"var(--text-secondary)"}}):e.jsx(he,{className:"w-4 h-4",style:{color:"var(--text-secondary)"}}))]})]}),g&&!p&&e.jsxs("div",{className:"px-4 pb-4 space-y-3 border-t",style:{borderColor:"var(--border-medium)"},children:[e.jsxs("div",{className:"pt-3",children:[e.jsxs("p",{className:"text-xs font-medium mb-2",style:{color:"var(--text-secondary)"},children:["SI ",a.logic_operator==="OR"?"(alguna)":"(todas)",":"]}),e.jsx("div",{className:"space-y-1",children:(A=a.conditions)==null?void 0:A.map((t,c)=>e.jsxs("div",{className:"flex items-center gap-2 text-xs p-2 rounded-lg",style:{backgroundColor:"rgba(245, 158, 11, 0.1)"},children:[e.jsx("span",{style:{color:"#f59e0b"},children:"â€¢"}),e.jsxs("span",{style:{color:"var(--text-primary)"},children:[B[t.field]||t.field," ",e.jsx("span",{style:{color:"var(--text-secondary)"},children:Pe[t.operator]||t.operator})," ",'"',y(t.field,t.value),'"']})]},c))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium mb-2",style:{color:"var(--text-secondary)"},children:"ENTONCES:"}),e.jsx("div",{className:"space-y-1",children:(f=a.actions)==null?void 0:f.map((t,c)=>e.jsxs("div",{className:"flex items-center gap-2 text-xs p-2 rounded-lg",style:{backgroundColor:"rgba(34, 197, 94, 0.1)"},children:[e.jsx("span",{style:{color:"#22c55e"},children:"â†’"}),e.jsxs("span",{style:{color:"var(--text-primary)"},children:[B[t.field]||t.field,":"," ",e.jsx("span",{className:"font-medium",children:y(t.field,t.value)})]})]},c))})]})]})]})}function Be(){const{showError:a}=le(),x=ne(),{rules:m,loading:j,refetch:v}=De(),[N,p]=d.useState([]),[h,u]=d.useState([]),[g,i]=d.useState(!1),[s,n]=d.useState(null),[r,y]=d.useState(!1),[C,S]=d.useState(!1),[w,_]=d.useState(null),[b,A]=d.useState(!1),[f,t]=d.useState(new Set),[c,l]=d.useState(!1),R=d.useCallback(async()=>{try{const[o,E]=await Promise.all([ce(),ie()]);p(o.accounts||[]);const O=E.categorias||{},te=[...(O.gastos||[]).map($=>({...$,type:"expense"})),...(O.ingresos||[]).map($=>({...$,type:"income"}))];u(te)}catch(o){console.error("Error loading data:",o)}},[]);d.useEffect(()=>{R()},[R,x.key]);const I=(o=null)=>{n(o),i(!0)},T=()=>{i(!1),n(null)},U=async o=>{try{y(!0),o.id?await me(o.id,o):await ue(o),T(),await v()}catch(E){a("Error al guardar la regla",E.message)}finally{y(!1)}},W=async o=>{try{await de(o.id,!o.is_active),await v()}catch(E){a("Error al cambiar estado",E.message)}},Q=async()=>{if(w)try{await P(w.id),_(null),await v()}catch(o){a("Error al eliminar",o.message)}},Y=async()=>{try{S(!0);const o=await xe();await v(),console.log(`âœ… ${o.rulesCreated} reglas generadas exitosamente`)}catch(o){a("Error al generar reglas",o.message)}finally{S(!1)}},X=()=>{A(!b),t(new Set)},J=o=>{t(E=>{const O=new Set(E);return O.has(o)?O.delete(o):O.add(o),O})},K=()=>{f.size===m.length?t(new Set):t(new Set(m.map(o=>o.id)))},Z=async()=>{try{const o=Array.from(f);await Promise.all(o.map(E=>P(E))),l(!1),t(new Set),A(!1),await v()}catch(o){a("Error al eliminar",o.message)}},ee=()=>e.jsx("div",{className:"space-y-3",children:[1,2,3].map(o=>e.jsx("div",{className:"h-20 rounded-2xl animate-pulse",style:{backgroundColor:"var(--bg-secondary)"}},o))}),ae=()=>e.jsxs("div",{className:"rounded-2xl p-8 text-center max-w-2xl mx-auto",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-2xl mb-4",style:{backgroundColor:"rgba(20, 184, 166, 0.1)"},children:e.jsx(ve,{className:"w-8 h-8",style:{color:"var(--accent-primary)"}})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",style:{color:"var(--text-primary)"},children:"Â¿QuÃ© son las reglas automÃ¡ticas?"}),e.jsxs("p",{className:"text-sm mb-4 max-w-md mx-auto",style:{color:"var(--text-secondary)"},children:["Las reglas automÃ¡ticas te permiten categorizar tus movimientos de forma inteligente, tanto en la app web como en el ",e.jsx("strong",{children:"bot de WhatsApp/Telegram"}),"."]}),e.jsxs("div",{className:"bg-opacity-50 rounded-xl p-4 mb-6 text-left max-w-md mx-auto",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsx("p",{className:"text-sm mb-3",style:{color:"var(--text-secondary)"},children:e.jsx("strong",{style:{color:"var(--text-primary)"},children:"Por ejemplo:"})}),e.jsxs("p",{className:"text-sm mb-2",style:{color:"var(--text-secondary)"},children:['â€¢ Si la nota contiene "super" â†’ ðŸ›’ Supermercado',e.jsx("br",{}),'â€¢ Si la nota contiene "galicia" â†’ ðŸ¦ Galicia Pesos',e.jsx("br",{}),'â€¢ Si la nota contiene "spotify" â†’ ðŸ“± Servicios']})]}),e.jsx("p",{className:"text-sm mb-6 max-w-md mx-auto",style:{color:"var(--text-secondary)"},children:"Cuando usÃ¡s el bot, estas reglas ayudan a detectar automÃ¡ticamente la categorÃ­a y cuenta correcta para cada movimiento."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsxs("button",{onClick:Y,disabled:C,className:"px-6 py-3 rounded-xl font-medium text-white transition-all inline-flex items-center justify-center gap-2",style:{backgroundColor:C?"var(--text-tertiary)":"var(--accent-primary)",opacity:C?.6:1,cursor:C?"not-allowed":"pointer"},children:[e.jsx(L,{className:"w-5 h-5"}),C?"Generando...":"Generar reglas automÃ¡ticamente"]}),e.jsxs("button",{onClick:()=>I(),className:"px-6 py-3 rounded-xl font-medium transition-all inline-flex items-center justify-center gap-2",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-medium)"},children:[e.jsx(D,{className:"w-5 h-5"}),"Crear regla manualmente"]})]})]});return e.jsxs("div",{className:"space-y-4 overflow-x-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-base font-medium flex items-center gap-2",style:{color:"var(--text-primary)"},children:[e.jsx(L,{className:"w-5 h-5",style:{color:"var(--accent-primary)"}}),"Reglas automÃ¡ticas"]}),e.jsx("p",{className:"text-xs mt-0.5",style:{color:"var(--text-secondary)"},children:"Categoriza tus movimientos automÃ¡ticamente"})]}),m.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:X,className:"p-2 rounded-xl text-sm font-medium transition-colors",style:{backgroundColor:b?"var(--accent-primary)":"var(--bg-tertiary)",color:b?"white":"var(--text-secondary)",border:b?"none":"1px solid var(--border-medium)"},title:b?"Cancelar selecciÃ³n":"Seleccionar mÃºltiples",children:b?e.jsx(H,{className:"w-4 h-4"}):e.jsx(Re,{className:"w-4 h-4"})}),!b&&e.jsxs("button",{onClick:()=>I(),className:"px-3 py-2 rounded-xl text-sm font-medium transition-colors flex items-center gap-1.5",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-medium)"},children:[e.jsx(D,{className:"w-4 h-4",style:{color:"var(--accent-primary)"}}),"Nueva"]})]})]}),j?ee():m.length===0?ae():e.jsxs("div",{className:"space-y-3",children:[b&&m.length>1&&e.jsx("button",{onClick:K,className:"w-full py-2 text-sm font-medium rounded-xl transition-colors",style:{backgroundColor:"var(--bg-secondary)",color:"var(--text-secondary)",border:"1px solid var(--border-medium)"},children:f.size===m.length?"Deseleccionar todas":"Seleccionar todas"}),m.map(o=>e.jsx(qe,{rule:o,categories:h,accounts:N,onEdit:I,onDelete:_,onToggle:W,selectionMode:b,selected:f.has(o.id),onSelect:J},o.id))]}),g&&e.jsx(Fe,{rule:s,categories:h,accounts:N,onSave:U,onClose:T,onDelete:o=>{T(),_(o)},loading:r}),e.jsx(F,{isOpen:!!w,onClose:()=>_(null),onConfirm:Q,title:"Eliminar regla",message:w?`Â¿EstÃ¡s seguro de eliminar la regla "${w.name}"? Esta acciÃ³n no se puede deshacer.`:"",confirmText:"Eliminar",variant:"danger"}),e.jsx(F,{isOpen:c,onClose:()=>l(!1),onConfirm:Z,title:"Eliminar reglas",message:`Â¿EstÃ¡s seguro de eliminar ${f.size} regla${f.size!==1?"s":""}? Esta acciÃ³n no se puede deshacer.`,confirmText:"Eliminar",variant:"danger"}),b&&f.size>0&&e.jsxs("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 px-4 py-3 rounded-2xl shadow-lg flex items-center gap-4 z-50",style:{backgroundColor:"var(--bg-tertiary)",border:"1px solid var(--border-medium)"},children:[e.jsxs("span",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:[f.size," seleccionada",f.size!==1?"s":""]}),e.jsxs("button",{onClick:()=>l(!0),className:"px-4 py-2 rounded-xl text-sm font-medium flex items-center gap-2 transition-colors",style:{backgroundColor:"rgba(239, 68, 68, 0.1)",color:"var(--accent-red)"},children:[e.jsx(M,{className:"w-4 h-4"}),"Eliminar"]})]})]})}export{Be as default};
