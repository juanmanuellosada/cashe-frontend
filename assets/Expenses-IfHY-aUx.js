import{g as b,r as o,S as j,n as A,o as B,j as c,E as R,U as T,V as U,W as q,p as N,q as P,X as G}from"./index-EdJAMjxN.js";import{M as L}from"./MovementsList-pONLYmnG.js";import{P as O}from"./PullToRefresh-CnJcW6cT.js";import"./DateRangePicker-af3Yldoe.js";import"./subMonths-CxXASRBE.js";import"./SortDropdown-D6EPyoyf.js";function J(){const{showError:d}=b(),[S,l]=o.useState([]),[p,E]=o.useState([]),[g,y]=o.useState({ingresos:[],gastos:[]}),[f,x]=o.useState(!0),[m,i]=o.useState(null),[v,w]=o.useState(!1),[D,h]=o.useState(!1),a=o.useCallback(async(e=!1,t=!0)=>{try{t&&x(!0);const[s,n,r]=await Promise.all([j(e),A(),B()]);l(s.expenses||[]),E(n.accounts||[]),y(r.categorias||{ingresos:[],gastos:[]})}catch(s){console.error("Error fetching data:",s)}finally{t&&x(!1)}},[]);o.useEffect(()=>{a()},[a]);const k=async e=>{try{w(!0),await P(e),e.applyToSubsequent&&e.idCompra&&await G(e),i(null),await a(!0,!1)}catch(t){console.error("Error updating:",t),d("No se pudo guardar el gasto",t.message)}finally{w(!1)}},M=async e=>{i(null),l(t=>t.filter(s=>s.rowIndex!==e.rowIndex));try{await N(e)}catch(t){console.error("Error deleting:",t),d("No se pudo eliminar el gasto",t.message),a()}},C=async e=>{const t=new Set(e.map(s=>s.rowIndex));l(s=>s.filter(n=>!t.has(n.rowIndex))),await q(e),await a()},I=async(e,t,s)=>{const n=new Set(e.map(r=>r.rowIndex));l(r=>r.map(u=>n.has(u.rowIndex)?{...u,[t]:s}:u)),await U(e,t,s),await a()};return c.jsxs(O,{onRefresh:a,disabled:f,children:[c.jsx(L,{title:"Gastos",movements:S,accounts:p,categories:g.gastos||[],loading:f,onMovementClick:i,onMovementDelete:M,onBulkDelete:C,onBulkUpdate:I,onAddClick:()=>h(!0),type:"gasto"}),m&&c.jsx(R,{movement:m,accounts:p,categories:g,onSave:k,onDelete:M,onClose:()=>i(null),onConvertedToRecurring:()=>a(!0,!1),loading:v}),c.jsx(T,{isOpen:D,onClose:()=>{h(!1),a()},defaultType:"expense"})]})}export{J as default};
