import{al as R,r as p,j as e,L as F,f as c}from"./index-BpxMBPca.js";import{aV as M,aM as f,aR as P,aS as T,aT as $,aQ as b,aU as L,aP as N,aN as O,aO as B}from"./PieChart-CiI-QK3H.js";import"./DateRangePicker-BVPqObrC.js";const C=[{id:"gasto",label:"Gastos",color:"var(--accent-red)",bgDim:"rgba(239, 68, 68, 0.15)"},{id:"ingreso",label:"Ingresos",color:"var(--accent-green)",bgDim:"rgba(34, 197, 94, 0.15)"}],h=["#ef4444","#f97316","#eab308","#22c55e","#14b8a6","#3b82f6","#14b8a6","#ec4899","#6366f1","#84cc16","#f43f5e","#0ea5e9","#a855f7","#10b981"];function I(){const{filteredMovements:u,currency:o,loading:k}=R(),[l,w]=p.useState("gasto"),y=p.useMemo(()=>u.filter(s=>s.tipo===l),[u,l]),r=p.useMemo(()=>{const s={};let t=0,a=0;return y.forEach(i=>{const n=i.categoria||"Sin categoria",v=i.montoPesos||i.monto||0,j=i.montoDolares||0;t+=v,a+=j,s[n]||(s[n]={pesos:0,dolares:0}),s[n].pesos+=v,s[n].dolares+=j}),{categories:Object.entries(s).map(([i,n])=>({name:i,pesos:n.pesos,dolares:n.dolares,percentage:t>0?n.pesos/t*100:0})).sort((i,n)=>n.pesos-i.pesos),totalPesos:t,totalDolares:a}},[y]),g=p.useMemo(()=>{const s=o==="ARS"?r.totalPesos:r.totalDolares;return r.categories.slice(0,8).map(t=>{const a=o==="ARS"?t.pesos:t.dolares;return{name:t.name.length>12?t.name.substring(0,12)+"...":t.name,fullName:t.name,value:a,pesos:t.pesos,dolares:t.dolares,percentage:s>0?a/s*100:0}})},[r,o]),d=p.useMemo(()=>{const s=o==="ARS"?r.totalPesos:r.totalDolares;return r.categories.map(t=>{const a=o==="ARS"?t.pesos:t.dolares;return{name:t.name,value:a,percentage:s>0?a/s*100:0,pesos:t.pesos,dolares:t.dolares}})},[r,o]),S=({active:s,payload:t})=>{if(s&&t&&t.length){const a=t[0].payload;return e.jsxs("div",{className:"px-3 py-2 rounded-lg shadow-lg",style:{backgroundColor:"var(--bg-tertiary)",border:"1px solid var(--border-subtle)"},children:[e.jsx("p",{className:"font-medium text-sm",style:{color:"var(--text-primary)"},children:a.fullName}),e.jsx("p",{className:"text-sm",style:{color:l==="gasto"?"var(--accent-red)":"var(--accent-green)"},children:c(a.pesos,"ARS")}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:c(a.dolares,"USD")}),e.jsxs("p",{className:"text-xs font-medium mt-1",style:{color:"var(--text-secondary)"},children:[a.percentage.toFixed(1),"%"]})]})}return null},D=({active:s,payload:t})=>{if(s&&t&&t.length){const a=t[0].payload;return e.jsxs("div",{className:"px-3 py-2 rounded-lg shadow-lg",style:{backgroundColor:"var(--bg-tertiary)",border:"1px solid var(--border-subtle)"},children:[e.jsx("p",{className:"font-medium text-sm",style:{color:"var(--text-primary)"},children:a.name}),e.jsx("p",{className:"text-sm",style:{color:l==="gasto"?"var(--accent-red)":"var(--accent-green)"},children:c(a.pesos,"ARS")}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:c(a.dolares,"USD")}),e.jsxs("p",{className:"text-xs font-medium mt-1",style:{color:"var(--text-secondary)"},children:[a.percentage.toFixed(1),"% del total"]})]})}return null},A=()=>{const s=`Categoria	Pesos	Dolares	%
`,t=r.categories.map(m=>`${m.name}	${m.pesos.toFixed(2)}	${m.dolares.toFixed(2)}	${m.percentage.toFixed(1)}%`).join(`
`),a=`TOTAL	${r.totalPesos.toFixed(2)}	${r.totalDolares.toFixed(2)}	100%`;navigator.clipboard.writeText(s+t+`
`+a),alert("Datos copiados al portapapeles")},x=C.find(s=>s.id===l);return k?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(F,{})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[e.jsx("h2",{className:"text-xl font-bold",style:{color:"var(--text-primary)"},children:"Resumen por categoria"}),e.jsx(M,{})]}),e.jsx("div",{className:"inline-flex rounded-xl p-1",style:{backgroundColor:"var(--bg-tertiary)"},children:C.map(s=>{const t=l===s.id;return e.jsx("button",{onClick:()=>w(s.id),className:`relative px-5 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 ${t?"shadow-md":"hover:opacity-80"}`,style:{backgroundColor:t?s.color:"transparent",color:t?"white":"var(--text-secondary)"},children:s.label},s.id)})}),e.jsx("div",{className:"h-1 rounded-full transition-all duration-300",style:{backgroundColor:x==null?void 0:x.bgDim,boxShadow:`0 0 20px ${x==null?void 0:x.bgDim}`}}),e.jsxs("div",{className:"rounded-2xl p-4",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsxs("p",{className:"text-xs uppercase tracking-wide mb-1",style:{color:"var(--text-secondary)"},children:["Total ",l==="gasto"?"Gastos":"Ingresos"]}),e.jsx("p",{className:"text-2xl font-bold",style:{color:l==="gasto"?"var(--accent-red)":"var(--accent-green)"},children:c(o==="ARS"?r.totalPesos:r.totalDolares,o)}),e.jsxs("p",{className:"text-sm mt-1",style:{color:"var(--text-secondary)"},children:[r.categories.length," categorias"]})]}),g.length>0&&e.jsxs("div",{className:"rounded-2xl p-4",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("h3",{className:"font-semibold mb-4",style:{color:"var(--text-primary)"},children:"Distribucion por Categoria"}),e.jsx(f,{width:"100%",height:Math.max(200,g.length*40),children:e.jsxs(P,{data:g,layout:"vertical",margin:{top:5,right:30,left:10,bottom:5},children:[e.jsx(T,{type:"number",tickFormatter:s=>s>=1e6?`${(s/1e6).toFixed(1)}M`:s>=1e3?`${(s/1e3).toFixed(0)}K`:s,tick:{fill:"var(--text-secondary)",fontSize:11},axisLine:{stroke:"var(--border-subtle)"},tickLine:!1}),e.jsx($,{type:"category",dataKey:"name",width:90,tick:{fill:"var(--text-secondary)",fontSize:11},axisLine:!1,tickLine:!1}),e.jsx(b,{content:e.jsx(S,{}),cursor:{fill:"var(--bg-tertiary)",opacity:.5}}),e.jsx(L,{dataKey:"value",radius:[0,4,4,0],maxBarSize:30,children:g.map((s,t)=>e.jsx(N,{fill:l==="gasto"?"var(--accent-red)":"var(--accent-green)"},`cell-${t}`))})]})})]}),d.length>0&&e.jsxs("div",{className:"rounded-2xl p-4",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsxs("h3",{className:"font-semibold mb-4",style:{color:"var(--text-primary)"},children:[l==="gasto"?"Gastos":"Ingresos"," por Categoria"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(f,{width:"100%",height:220,children:e.jsxs(O,{children:[e.jsx(B,{data:d,cx:"50%",cy:"50%",innerRadius:50,outerRadius:85,paddingAngle:2,dataKey:"value",nameKey:"name",children:d.map((s,t)=>e.jsx(N,{fill:h[t%h.length],stroke:"transparent"},`pie-cell-${t}`))}),e.jsx(b,{content:e.jsx(D,{})})]})}),e.jsxs("div",{className:"text-center -mt-4",children:[e.jsx("p",{className:"text-xs",style:{color:"var(--text-secondary)"},children:"Total"}),e.jsx("p",{className:"font-bold",style:{color:l==="gasto"?"var(--accent-red)":"var(--accent-green)"},children:c(o==="ARS"?r.totalPesos:r.totalDolares,o)})]})]}),e.jsxs("div",{className:"md:col-span-3 flex flex-col justify-center gap-1.5 max-h-64 overflow-y-auto",children:[d.slice(0,10).map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between gap-2 px-2 py-1.5 rounded-lg transition-colors hover:bg-[var(--bg-tertiary)]",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:h[t%h.length]}}),e.jsx("span",{className:"text-sm truncate",style:{color:"var(--text-primary)"},title:s.name,children:s.name})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-shrink-0",children:[e.jsxs("span",{className:"text-xs",style:{color:"var(--text-secondary)"},children:[s.percentage.toFixed(1),"%"]}),e.jsx("span",{className:"text-sm font-medium min-w-[80px] text-right",style:{color:l==="gasto"?"var(--accent-red)":"var(--accent-green)"},children:c(s.value,o)})]})]},`legend-${t}`)),d.length>10&&e.jsxs("p",{className:"text-xs text-center py-1",style:{color:"var(--text-secondary)"},children:["+",d.length-10," categorias mas"]})]})]})]}),e.jsxs("div",{className:"rounded-2xl overflow-hidden",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsxs("div",{className:"p-4 flex items-center justify-between border-b",style:{borderColor:"var(--border-subtle)"},children:[e.jsx("h3",{className:"font-semibold",style:{color:"var(--text-primary)"},children:"Detalle por Categoria"}),e.jsxs("button",{onClick:A,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition-colors hover:opacity-80",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-secondary)"},children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),"Copiar"]})]}),r.categories.length===0?e.jsxs("div",{className:"p-8 text-center",style:{color:"var(--text-secondary)"},children:["No hay ",l==="gasto"?"gastos":"ingresos"," en este periodo"]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsx("th",{className:"text-left px-4 py-3 text-xs font-medium uppercase tracking-wide",style:{color:"var(--text-secondary)"},children:"Categoria"}),e.jsx("th",{className:"text-right px-4 py-3 text-xs font-medium uppercase tracking-wide",style:{color:"var(--text-secondary)"},children:"Monto"}),e.jsx("th",{className:"text-right px-4 py-3 text-xs font-medium uppercase tracking-wide",style:{color:"var(--text-secondary)"},children:"%"})]})}),e.jsx("tbody",{children:r.categories.map((s,t)=>e.jsxs("tr",{className:"transition-colors hover:bg-[var(--bg-tertiary)]",style:{backgroundColor:t%2===0?"transparent":"var(--bg-tertiary)",opacity:t%2===0?1:.7},children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"font-medium text-sm",style:{color:"var(--text-primary)"},children:s.name})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("span",{className:"font-medium text-sm",style:{color:l==="gasto"?"var(--accent-red)":"var(--accent-green)"},children:c(o==="ARS"?s.pesos:s.dolares,o)})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("span",{className:"text-sm",style:{color:"var(--text-secondary)"},children:[s.percentage.toFixed(1),"%"]})})]},s.name))}),e.jsx("tfoot",{children:e.jsxs("tr",{style:{backgroundColor:"var(--bg-tertiary)",borderTop:"2px solid var(--border-subtle)"},children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"font-bold text-sm",style:{color:"var(--text-primary)"},children:"TOTAL"})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("span",{className:"font-bold text-sm",style:{color:l==="gasto"?"var(--accent-red)":"var(--accent-green)"},children:c(o==="ARS"?r.totalPesos:r.totalDolares,o)})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("span",{className:"font-bold text-sm",style:{color:"var(--text-secondary)"},children:"100%"})})]})})]})})]}),e.jsx("div",{className:"text-center py-2",children:e.jsxs("p",{className:"text-xs",style:{color:"var(--text-secondary)"},children:["Mostrando ",r.categories.length," categorias con ",y.length," movimientos"]})})]})}export{I as default};
