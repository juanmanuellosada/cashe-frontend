import{g as x,r,a0 as M,o as y,n as R,j as c,E as G,X as H,a1 as p,v as o,D as n,a2 as _}from"./index-BGEaSxlK.js";import{M as j}from"./MovementsList-DWSv2OKF.js";import{P as k}from"./PullToRefresh-Dlgqxg7w.js";import"./DateRangePicker-BKGIHUt9.js";import"./subMonths-tRzUbsbS.js";import"./SortDropdown-CR2ikgDi.js";function B(){const{showError:u}=x(),[D,i]=r.useState([]),[d,N]=r.useState([]),[m,E]=r.useState(!0),[S,l]=r.useState(null),[v,A]=r.useState(!1),[w,g]=r.useState(!1),s=r.useCallback(async(a=!1,e=!0)=>{try{e&&E(!0);const[t,f]=await Promise.all([M(a),y()]);i(t.transfers||[]),N(f.accounts||[])}catch(t){console.error("Error fetching data:",t)}finally{e&&E(!1)}},[]);r.useEffect(()=>{s()},[s]),R(n.TRANSFERS_CHANGED,()=>s(!0,!1));const h=async a=>{try{A(!0),await _(a),l(null),o(n.TRANSFERS_CHANGED),o(n.ACCOUNTS_CHANGED),await s(!0,!1)}catch(e){console.error("Error updating:",e),u("No se pudo guardar la transferencia",e.message)}finally{A(!1)}},C=async a=>{l(null),i(e=>e.filter(t=>t.rowIndex!==a.rowIndex));try{await p(a),o(n.TRANSFERS_CHANGED),o(n.ACCOUNTS_CHANGED)}catch(e){console.error("Error deleting:",e),u("No se pudo eliminar la transferencia",e.message),s()}},T=async a=>{const e=new Set(a.map(t=>t.rowIndex));i(t=>t.filter(f=>!e.has(f.rowIndex)));for(const t of a)await p(t);o(n.TRANSFERS_CHANGED),o(n.ACCOUNTS_CHANGED),await s()};return c.jsxs(k,{onRefresh:s,disabled:m,children:[c.jsx(j,{title:"Transferencias",movements:D,accounts:d,categories:[],loading:m,onMovementClick:l,onMovementDelete:C,onBulkDelete:T,onAddClick:()=>g(!0),type:"transferencia"}),S&&c.jsx(G,{movement:S,accounts:d,categories:{ingresos:[],gastos:[]},onSave:h,onDelete:C,onClose:()=>l(null),loading:v}),c.jsx(H,{isOpen:w,onClose:()=>{g(!1),s()},defaultType:"transfer"})]})}export{B as default};
