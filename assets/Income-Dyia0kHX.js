import{n as k,r as o,a4 as G,x as H,y as _,w as T,j as d,E as U,a0 as j,a1 as B,A as r,a2 as b,z as R,D as n,B as P}from"./index-XMNSLHhk.js";import{M as z}from"./MovementsList-Q8GcXhg3.js";import{P as L}from"./PullToRefresh-DBSs_IOy.js";import"./DateRangePicker-ZLvgKtwE.js";import"./SortDropdown-6rJH1n0H.js";function V(){const{showError:g}=k(),[N,i]=o.useState([]),[C,A]=o.useState([]),[E,x]=o.useState({ingresos:[],gastos:[]}),[f,w]=o.useState(!0),[D,u]=o.useState(null),[I,S]=o.useState(!1),[h,p]=o.useState(!1),a=o.useCallback(async(t=!1,e=!0)=>{try{e&&w(!0);const[s,l,c]=await Promise.all([G(t),H(),_()]);i(s.incomes||[]),A(l.accounts||[]),x(c.categorias||{ingresos:[],gastos:[]})}catch(s){console.error("Error fetching data:",s)}finally{e&&w(!1)}},[]);o.useEffect(()=>{a()},[a]),T(n.INCOMES_CHANGED,()=>a(!0,!1));const v=async t=>{try{S(!0),await P(t),u(null),r(n.INCOMES_CHANGED),r(n.ACCOUNTS_CHANGED),await a(!0,!1)}catch(e){console.error("Error updating:",e),g("No se pudo guardar el ingreso",e.message)}finally{S(!1)}},M=async t=>{u(null),i(e=>e.filter(s=>s.rowIndex!==t.rowIndex));try{await R(t),r(n.INCOMES_CHANGED),r(n.ACCOUNTS_CHANGED)}catch(e){console.error("Error deleting:",e),g("No se pudo eliminar el ingreso",e.message),a()}},y=async t=>{const e=new Set(t.map(s=>s.rowIndex));i(s=>s.filter(l=>!e.has(l.rowIndex))),await b(t),r(n.INCOMES_CHANGED),r(n.ACCOUNTS_CHANGED),await a()},O=async(t,e,s)=>{const l=new Set(t.map(c=>c.rowIndex));i(c=>c.map(m=>l.has(m.rowIndex)?{...m,[e]:s}:m)),await B(t,e,s),r(n.INCOMES_CHANGED),r(n.ACCOUNTS_CHANGED),await a()};return d.jsxs(L,{onRefresh:a,disabled:f,children:[d.jsx(z,{title:"Ingresos",movements:N,accounts:C,categories:E.ingresos||[],loading:f,onMovementClick:u,onMovementDelete:M,onBulkDelete:y,onBulkUpdate:O,onAddClick:()=>p(!0),type:"ingreso"}),D&&d.jsx(U,{movement:D,accounts:C,categories:E,onSave:v,onDelete:M,onClose:()=>u(null),onConvertedToRecurring:()=>a(!0,!1),loading:I}),d.jsx(j,{isOpen:h,onClose:()=>{p(!1),a()},defaultType:"income"})]})}export{V as default};
