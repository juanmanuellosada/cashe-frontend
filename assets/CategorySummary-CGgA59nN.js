import{r as n,h as u,k as v,j as e,L as B,f as i,aa as I}from"./index-CKWgcbuo.js";import{D as K,s as j}from"./DateRangePicker-581Jnx40.js";import{a7 as R,ac as V,ad as z,ae as G,ab as A,af as H,aa as M,a8 as _,a9 as W}from"./PieChart-ClTNeDjj.js";const X=[{label:"Este mes",getValue:()=>({from:v(new Date),to:u(new Date)})},{label:"Mes anterior",getValue:()=>({from:v(j(new Date,1)),to:u(j(new Date,1))})},{label:"3 meses",getValue:()=>({from:v(j(new Date,2)),to:u(new Date)})}],P=[{id:"gasto",label:"Gastos",color:"var(--accent-red)",bgDim:"rgba(239, 68, 68, 0.15)"},{id:"ingreso",label:"Ingresos",color:"var(--accent-green)",bgDim:"rgba(34, 197, 94, 0.15)"}],y=["#ef4444","#f97316","#eab308","#22c55e","#14b8a6","#3b82f6","#14b8a6","#ec4899","#6366f1","#84cc16","#f43f5e","#0ea5e9","#a855f7","#10b981"];function Q(){const[b,E]=n.useState([]),[$,N]=n.useState(!0),[w,S]=n.useState(null),[l,T]=n.useState("gasto"),[r,C]=n.useState("ARS"),[m,F]=n.useState({from:v(new Date),to:u(new Date)});n.useEffect(()=>{async function t(){try{N(!0),S(null);const s=await I(5e3);E(s.movements||[])}catch(s){console.error("Error loading movements:",s),S("Error al cargar los movimientos")}finally{N(!1)}}t()},[]);const f=n.useMemo(()=>{if(!m.from||!m.to)return[];const t=new Date(m.from);t.setHours(0,0,0,0);const s=new Date(m.to);return s.setHours(23,59,59,999),b.filter(a=>{if(a.tipo!==l)return!1;const d=new Date(a.fecha);return d>=t&&d<=s})},[b,l,m]),o=n.useMemo(()=>{const t={};let s=0,a=0;return f.forEach(x=>{const c=x.categoria||"Sin categoria",D=x.montoPesos||x.monto||0,k=x.montoDolares||0;s+=D,a+=k,t[c]||(t[c]={pesos:0,dolares:0}),t[c].pesos+=D,t[c].dolares+=k}),{categories:Object.entries(t).map(([x,c])=>({name:x,pesos:c.pesos,dolares:c.dolares,percentage:s>0?c.pesos/s*100:0})).sort((x,c)=>c.pesos-x.pesos),totalPesos:s,totalDolares:a}},[f]),h=n.useMemo(()=>{const t=r==="ARS"?o.totalPesos:o.totalDolares;return o.categories.slice(0,8).map(s=>{const a=r==="ARS"?s.pesos:s.dolares;return{name:s.name.length>12?s.name.substring(0,12)+"...":s.name,fullName:s.name,value:a,pesos:s.pesos,dolares:s.dolares,percentage:t>0?a/t*100:0}})},[o,r]),p=n.useMemo(()=>{const t=r==="ARS"?o.totalPesos:o.totalDolares;return o.categories.map(s=>{const a=r==="ARS"?s.pesos:s.dolares;return{name:s.name,value:a,percentage:t>0?a/t*100:0,pesos:s.pesos,dolares:s.dolares}})},[o,r]),L=({active:t,payload:s})=>{if(t&&s&&s.length){const a=s[0].payload;return e.jsxs("div",{className:"px-3 py-2 rounded-lg shadow-lg",style:{backgroundColor:"var(--bg-tertiary)",border:"1px solid var(--border-subtle)"},children:[e.jsx("p",{className:"font-medium text-sm",style:{color:"var(--text-primary)"},children:a.fullName}),e.jsx("p",{className:"text-sm",style:{color:l==="gasto"?"var(--accent-red)":"var(--accent-green)"},children:i(a.pesos,"ARS")}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:i(a.dolares,"USD")}),e.jsxs("p",{className:"text-xs font-medium mt-1",style:{color:"var(--text-secondary)"},children:[a.percentage.toFixed(1),"%"]})]})}return null},O=({active:t,payload:s})=>{if(t&&s&&s.length){const a=s[0].payload;return e.jsxs("div",{className:"px-3 py-2 rounded-lg shadow-lg",style:{backgroundColor:"var(--bg-tertiary)",border:"1px solid var(--border-subtle)"},children:[e.jsx("p",{className:"font-medium text-sm",style:{color:"var(--text-primary)"},children:a.name}),e.jsx("p",{className:"text-sm",style:{color:l==="gasto"?"var(--accent-red)":"var(--accent-green)"},children:i(a.pesos,"ARS")}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:i(a.dolares,"USD")}),e.jsxs("p",{className:"text-xs font-medium mt-1",style:{color:"var(--text-secondary)"},children:[a.percentage.toFixed(1),"% del total"]})]})}return null},U=()=>{const t=`Categoria	Pesos	Dolares	%
`,s=o.categories.map(d=>`${d.name}	${d.pesos.toFixed(2)}	${d.dolares.toFixed(2)}	${d.percentage.toFixed(1)}%`).join(`
`),a=`TOTAL	${o.totalPesos.toFixed(2)}	${o.totalDolares.toFixed(2)}	100%`;navigator.clipboard.writeText(t+s+`
`+a),alert("Datos copiados al portapapeles")},g=P.find(t=>t.id===l);return $?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(B,{})}):w?e.jsxs("div",{className:"text-center py-20",children:[e.jsx("p",{style:{color:"var(--accent-red)"},children:w}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 rounded-lg",style:{backgroundColor:"var(--accent-primary)",color:"white"},children:"Reintentar"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[e.jsx("h2",{className:"text-xl font-bold",style:{color:"var(--text-primary)"},children:"Resumen por categoría"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"inline-flex rounded-xl p-1",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsxs("button",{onClick:()=>C("ARS"),className:"px-3.5 py-1.5 rounded-lg text-xs font-semibold transition-all duration-300 active:scale-95 flex items-center gap-1.5",style:{backgroundColor:r==="ARS"?"var(--accent-primary)":"transparent",color:r==="ARS"?"white":"var(--text-secondary)",boxShadow:r==="ARS"?"0 4px 12px var(--accent-primary-glow)":"none"},children:[e.jsx("img",{src:"/icons/catalog/ARS.svg",alt:"ARS",className:"w-4 h-4 rounded-sm"}),"ARS"]}),e.jsxs("button",{onClick:()=>C("USD"),className:"px-3.5 py-1.5 rounded-lg text-xs font-semibold transition-all duration-300 active:scale-95 flex items-center gap-1.5",style:{backgroundColor:r==="USD"?"var(--accent-green)":"transparent",color:r==="USD"?"white":"var(--text-secondary)",boxShadow:r==="USD"?"0 4px 12px rgba(0, 217, 154, 0.3)":"none"},children:[e.jsx("img",{src:"/icons/catalog/USD.svg",alt:"USD",className:"w-4 h-4 rounded-sm"}),"USD"]})]}),e.jsx(K,{value:m,onChange:F,presets:X,defaultPreset:"Este mes"})]})]}),e.jsx("div",{className:"inline-flex rounded-xl p-1",style:{backgroundColor:"var(--bg-tertiary)"},children:P.map(t=>{const s=l===t.id;return e.jsx("button",{onClick:()=>T(t.id),className:`relative px-5 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 ${s?"shadow-md":"hover:opacity-80"}`,style:{backgroundColor:s?t.color:"transparent",color:s?"white":"var(--text-secondary)"},children:t.label},t.id)})}),e.jsx("div",{className:"h-1 rounded-full transition-all duration-300",style:{backgroundColor:g==null?void 0:g.bgDim,boxShadow:`0 0 20px ${g==null?void 0:g.bgDim}`}}),e.jsxs("div",{className:"rounded-2xl p-4",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsxs("p",{className:"text-xs uppercase tracking-wide mb-1",style:{color:"var(--text-secondary)"},children:["Total ",l==="gasto"?"Gastos":"Ingresos"]}),e.jsx("p",{className:"text-2xl font-bold",style:{color:l==="gasto"?"var(--accent-red)":"var(--accent-green)"},children:i(r==="ARS"?o.totalPesos:o.totalDolares,r)}),e.jsxs("p",{className:"text-sm mt-1",style:{color:"var(--text-secondary)"},children:[o.categories.length," categorías"]})]}),h.length>0&&e.jsxs("div",{className:"rounded-2xl p-4",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("h3",{className:"font-semibold mb-4",style:{color:"var(--text-primary)"},children:"Distribucion por Categoria"}),e.jsx(R,{width:"100%",height:Math.max(200,h.length*40),children:e.jsxs(V,{data:h,layout:"vertical",margin:{top:5,right:30,left:10,bottom:5},children:[e.jsx(z,{type:"number",tickFormatter:t=>t>=1e6?`${(t/1e6).toFixed(1)}M`:t>=1e3?`${(t/1e3).toFixed(0)}K`:t,tick:{fill:"var(--text-secondary)",fontSize:11},axisLine:{stroke:"var(--border-subtle)"},tickLine:!1}),e.jsx(G,{type:"category",dataKey:"name",width:90,tick:{fill:"var(--text-secondary)",fontSize:11},axisLine:!1,tickLine:!1}),e.jsx(A,{content:e.jsx(L,{}),cursor:{fill:"var(--bg-tertiary)",opacity:.5}}),e.jsx(H,{dataKey:"value",radius:[0,4,4,0],maxBarSize:30,children:h.map((t,s)=>e.jsx(M,{fill:l==="gasto"?"var(--accent-red)":"var(--accent-green)"},`cell-${s}`))})]})})]}),p.length>0&&e.jsxs("div",{className:"rounded-2xl p-4",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsxs("h3",{className:"font-semibold mb-4",style:{color:"var(--text-primary)"},children:[l==="gasto"?"Gastos":"Ingresos"," por Categoria"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(R,{width:"100%",height:220,children:e.jsxs(_,{children:[e.jsx(W,{data:p,cx:"50%",cy:"50%",innerRadius:50,outerRadius:85,paddingAngle:2,dataKey:"value",nameKey:"name",children:p.map((t,s)=>e.jsx(M,{fill:y[s%y.length],stroke:"transparent"},`pie-cell-${s}`))}),e.jsx(A,{content:e.jsx(O,{})})]})}),e.jsxs("div",{className:"text-center -mt-4",children:[e.jsx("p",{className:"text-xs",style:{color:"var(--text-secondary)"},children:"Total"}),e.jsx("p",{className:"font-bold",style:{color:l==="gasto"?"var(--accent-red)":"var(--accent-green)"},children:i(r==="ARS"?o.totalPesos:o.totalDolares,r)})]})]}),e.jsxs("div",{className:"md:col-span-3 flex flex-col justify-center gap-1.5 max-h-64 overflow-y-auto",children:[p.slice(0,10).map((t,s)=>e.jsxs("div",{className:"flex items-center justify-between gap-2 px-2 py-1.5 rounded-lg transition-colors hover:bg-[var(--bg-tertiary)]",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:y[s%y.length]}}),e.jsx("span",{className:"text-sm truncate",style:{color:"var(--text-primary)"},title:t.name,children:t.name})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-shrink-0",children:[e.jsxs("span",{className:"text-xs",style:{color:"var(--text-secondary)"},children:[t.percentage.toFixed(1),"%"]}),e.jsx("span",{className:"text-sm font-medium min-w-[80px] text-right",style:{color:l==="gasto"?"var(--accent-red)":"var(--accent-green)"},children:i(t.value,r)})]})]},`legend-${s}`)),p.length>10&&e.jsxs("p",{className:"text-xs text-center py-1",style:{color:"var(--text-secondary)"},children:["+",p.length-10," categorias mas"]})]})]})]}),e.jsxs("div",{className:"rounded-2xl overflow-hidden",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsxs("div",{className:"p-4 flex items-center justify-between border-b",style:{borderColor:"var(--border-subtle)"},children:[e.jsx("h3",{className:"font-semibold",style:{color:"var(--text-primary)"},children:"Detalle por Categoria"}),e.jsxs("button",{onClick:U,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition-colors hover:opacity-80",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-secondary)"},children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),"Copiar"]})]}),o.categories.length===0?e.jsxs("div",{className:"p-8 text-center",style:{color:"var(--text-secondary)"},children:["No hay ",l==="gasto"?"gastos":"ingresos"," en este periodo"]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsx("th",{className:"text-left px-4 py-3 text-xs font-medium uppercase tracking-wide",style:{color:"var(--text-secondary)"},children:"Categoria"}),e.jsx("th",{className:"text-right px-4 py-3 text-xs font-medium uppercase tracking-wide",style:{color:"var(--text-secondary)"},children:"Monto"}),e.jsx("th",{className:"text-right px-4 py-3 text-xs font-medium uppercase tracking-wide",style:{color:"var(--text-secondary)"},children:"%"})]})}),e.jsx("tbody",{children:o.categories.map((t,s)=>e.jsxs("tr",{className:"transition-colors hover:bg-[var(--bg-tertiary)]",style:{backgroundColor:s%2===0?"transparent":"var(--bg-tertiary)",opacity:s%2===0?1:.7},children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"font-medium text-sm",style:{color:"var(--text-primary)"},children:t.name})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("span",{className:"font-medium text-sm",style:{color:l==="gasto"?"var(--accent-red)":"var(--accent-green)"},children:i(r==="ARS"?t.pesos:t.dolares,r)})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("span",{className:"text-sm",style:{color:"var(--text-secondary)"},children:[t.percentage.toFixed(1),"%"]})})]},t.name))}),e.jsx("tfoot",{children:e.jsxs("tr",{style:{backgroundColor:"var(--bg-tertiary)",borderTop:"2px solid var(--border-subtle)"},children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"font-bold text-sm",style:{color:"var(--text-primary)"},children:"TOTAL"})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("span",{className:"font-bold text-sm",style:{color:l==="gasto"?"var(--accent-red)":"var(--accent-green)"},children:i(r==="ARS"?o.totalPesos:o.totalDolares,r)})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("span",{className:"font-bold text-sm",style:{color:"var(--text-secondary)"},children:"100%"})})]})})]})})]}),e.jsx("div",{className:"text-center py-2",children:e.jsxs("p",{className:"text-xs",style:{color:"var(--text-secondary)"},children:["Mostrando ",o.categories.length," categorias con ",f.length," movimientos"]})})]})}export{Q as default};
