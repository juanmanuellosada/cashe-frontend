import{aA as h,n as G,r as o,j as e,P as O,aD as Q,aE as X}from"./index-BpxMBPca.js";const B="15551632329",A=async()=>{const{data:{user:s},error:r}=await h.auth.getUser();if(r)throw console.error("Error getting user:",r),new Error("Error getting authenticated user");if(!s)throw new Error("No authenticated user");return s.id},Z=async()=>{const s=await A(),{data:r,error:t}=await h.from("profiles").select("whatsapp_enabled, email, full_name").eq("id",s).single();return t?(console.error("Error checking WhatsApp access:",t),{enabled:!1,email:null,name:null}):{enabled:(r==null?void 0:r.whatsapp_enabled)===!0,email:r==null?void 0:r.email,name:r==null?void 0:r.full_name}},ee=async()=>{const s=await A(),{data:r,error:t}=await h.from("whatsapp_users").select("*").eq("user_id",s).maybeSingle();if(t)throw console.error("Error getting WhatsApp status:",t),t;if(!r)return{status:"not_linked",phone:null,verificationCode:null,linkedAt:null};if(r.verified)return{status:"linked",phone:r.phone_number,verificationCode:null,linkedAt:r.updated_at};const a=r.verification_expires_at&&new Date(r.verification_expires_at)<new Date;return{status:a?"code_expired":"pending_verification",phone:null,verificationCode:a?null:r.verification_code,expiresAt:r.verification_expires_at,linkedAt:null}},re=async()=>{const s=await A(),r=Math.floor(1e5+Math.random()*9e5).toString(),t=new Date(Date.now()+600*1e3).toISOString(),{data:a,error:n}=await h.from("whatsapp_users").upsert({user_id:s,phone_number:`pending_${s}`,verification_code:r,verification_expires_at:t,verified:!1,updated_at:new Date().toISOString()},{onConflict:"user_id",ignoreDuplicates:!1}).select().single();if(n)throw console.error("Error generating verification code:",n),n;return{code:r,expiresAt:t,expiresIn:600}},se=async()=>{const s=await A(),{data:r,error:t}=await h.from("whatsapp_users").select("verified, phone_number, updated_at").eq("user_id",s).maybeSingle();return t?(console.error("Error checking verification:",t),{verified:!1,phone:null}):r?{verified:r.verified===!0,phone:r.verified?r.phone_number:null,linkedAt:r.verified?r.updated_at:null}:{verified:!1,phone:null}},te=async()=>{const s=await A(),{error:r}=await h.from("whatsapp_users").delete().eq("user_id",s);if(r)throw console.error("Error unlinking WhatsApp:",r),r;return{success:!0}},ae=s=>{if(!s||s.startsWith("pending_"))return null;if(s.startsWith("+54")){const r=s.slice(3);if(r.length>=10){const t=r.slice(0,1)==="9"?r.slice(1,3):r.slice(0,2),a=r.slice(-8);return`+54 9 ${t} ${a.slice(0,4)}-${a.slice(4)}`}}return s},ne=async()=>{const s=await A(),{data:r}=await h.from("profiles").select("email, full_name").eq("id",s).single();if(!r)throw new Error("No se pudo obtener informaci√≥n del usuario");const{data:t,error:a}=await h.functions.invoke("send-access-request",{body:{userId:s,email:r.email,name:r.full_name}});if(a)throw console.error("Error requesting access:",a),a;return{success:!0}};function oe(){const{showError:s}=G(),[r,t]=o.useState("loading"),[a,n]=o.useState("not_linked"),[l,p]=o.useState({email:null,name:null}),[f,y]=o.useState(null),[g,N]=o.useState(null),[w,b]=o.useState(null),[d,v]=o.useState(null),[C,k]=o.useState(!1),[u,m]=o.useState(!1),[_,S]=o.useState(!1),[E,I]=o.useState(!1);o.useEffect(()=>{i()},[]),o.useEffect(()=>{if(a==="code_generated"){const c=setInterval(async()=>{const x=await se();x.verified&&(n("linked"),N(x.phone),b(x.linkedAt),y(null))},3e3);return()=>clearInterval(c)}},[a]),o.useEffect(()=>{if(!d||a!=="code_generated")return;const x=setInterval(()=>{new Date>new Date(d)&&(n("not_linked"),y(null),v(null))},1e3);return()=>clearInterval(x)},[d,a]);const i=async()=>{try{const c=await Z();if(p({email:c.email,name:c.name}),!c.enabled){t("restricted");return}t("enabled");const x=await ee();x.status==="linked"?(n("linked"),N(x.phone),b(x.linkedAt)):x.status==="pending_verification"&&x.verificationCode?(n("code_generated"),y(x.verificationCode),v(x.expiresAt)):n("not_linked")}catch(c){console.error("Error checking status:",c),t("restricted")}},j=async()=>{k(!0);try{const c=await re();y(c.code),v(c.expiresAt),n("code_generated")}catch(c){console.error("Error generating code:",c),s("Error al generar el c√≥digo. Por favor intent√° de nuevo.")}finally{k(!1)}},P=async()=>{k(!0);try{await te(),n("not_linked"),N(null),b(null),m(!1)}catch(c){console.error("Error unlinking WhatsApp:",c),s("Error al desvincular WhatsApp. Por favor intent√° de nuevo.")}finally{k(!1)}},Y=async()=>{I(!0);try{await ne(),S(!0),t("requested")}catch(c){console.error("Error requesting access:",c),s("No se pudo enviar la solicitud. Por favor intent√° de nuevo.")}finally{I(!1)}},U=o.useCallback(()=>{if(!d)return null;const c=new Date(d).getTime()-Date.now();if(c<=0)return null;const x=Math.floor(c/6e4),K=Math.floor(c%6e4/1e3);return`${x}:${K.toString().padStart(2,"0")}`},[d]),[q,R]=o.useState(null);o.useEffect(()=>{if(a!=="code_generated"){R(null);return}const c=()=>R(U());c();const x=setInterval(c,1e3);return()=>clearInterval(x)},[a,U]);const M=()=>e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-8 h-8",children:e.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"})}),J=()=>e.jsxs("div",{className:"space-y-4 mb-4",children:[e.jsx("div",{className:"p-4 rounded-xl border",style:{backgroundColor:"rgba(37, 211, 102, 0.08)",borderColor:"rgba(37, 211, 102, 0.2)"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0",style:{backgroundColor:"rgba(37, 211, 102, 0.15)"},children:e.jsx("span",{className:"text-xl",children:"ü§ñ"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-1",style:{color:"#25D366"},children:"Con Inteligencia Artificial"}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:"Chate√° naturalmente como si hablaras con una persona. El bot entiende lenguaje natural en espa√±ol argentino."})]})]})}),e.jsxs("div",{className:"p-4 rounded-xl",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsx("h4",{className:"font-medium text-sm mb-3",style:{color:"var(--text-primary)"},children:"Ejemplos de lo que pod√©s decir:"}),e.jsxs("div",{className:"space-y-2 text-sm",style:{color:"var(--text-secondary)"},children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("span",{children:"üí¨"}),e.jsx("code",{className:"text-xs",style:{color:"#25D366"},children:'"Gast√© 500 en comida con galicia"'})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("span",{children:"üí¨"}),e.jsx("code",{className:"text-xs",style:{color:"#25D366"},children:'"Cobr√© 50000 de sueldo en santander"'})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("span",{children:"üí¨"}),e.jsx("code",{className:"text-xs",style:{color:"#25D366"},children:'"Transfer√≠ 10k de mp a brubank"'})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("span",{children:"üí¨"}),e.jsx("code",{className:"text-xs",style:{color:"#25D366"},children:'"Cu√°nto gast√© en comida este mes?"'})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("span",{children:"üí¨"}),e.jsx("code",{className:"text-xs",style:{color:"#25D366"},children:'"Saldo mercadopago"'})]})]})]}),e.jsxs("div",{className:"p-4 rounded-xl",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsx("h4",{className:"font-medium text-sm mb-3",style:{color:"var(--text-primary)"},children:"Funcionalidades"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",style:{color:"var(--text-secondary)"},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{style:{color:"#25D366"},children:"üí∏"}),e.jsx("span",{children:"Gastos"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{style:{color:"#25D366"},children:"üí∞"}),e.jsx("span",{children:"Ingresos"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{style:{color:"#25D366"},children:"üîÑ"}),e.jsx("span",{children:"Transferencias"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{style:{color:"#25D366"},children:"üìä"}),e.jsx("span",{children:"Saldos"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{style:{color:"#25D366"},children:"üìà"}),e.jsx("span",{children:"Resumen mensual"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{style:{color:"#25D366"},children:"üïê"}),e.jsx("span",{children:"√öltimos movimientos"})]})]}),e.jsx("p",{className:"text-xs mt-3",style:{color:"var(--text-muted)"},children:"Tambi√©n pod√©s usar los botones del men√∫ si prefer√≠s"})]})]});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"rounded-2xl p-6 border transition-all",style:{backgroundColor:"var(--bg-secondary)",borderColor:a==="linked"?"rgba(37, 211, 102, 0.3)":"var(--border-color)"},children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl flex items-center justify-center",style:{backgroundColor:a==="linked"?"rgba(37, 211, 102, 0.15)":"rgba(37, 211, 102, 0.1)",color:"#25D366"},children:e.jsx(M,{})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg",style:{color:"var(--text-primary)"},children:"Bot de WhatsApp"}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:a==="linked"?"Vinculado - Registr√° movimientos por mensaje":"Registr√° gastos e ingresos por mensaje"})]}),a==="linked"&&e.jsx("div",{className:"px-3 py-1 rounded-full text-sm font-medium",style:{backgroundColor:"rgba(37, 211, 102, 0.15)",color:"#25D366"},children:"Conectado"})]}),e.jsx(J,{}),r==="loading"&&e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"w-6 h-6 border-2 border-t-transparent rounded-full animate-spin",style:{borderColor:"var(--accent-primary)",borderTopColor:"transparent"}})}),r==="restricted"&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"p-4 rounded-xl mb-4 flex items-start gap-3",style:{backgroundColor:"rgba(251, 191, 36, 0.1)"},children:[e.jsx("span",{className:"text-xl",children:"üîí"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",style:{color:"var(--text-primary)"},children:"Acceso restringido"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--text-secondary)"},children:"El bot de WhatsApp est√° en fase beta. Solicit√° acceso para probarlo."})]})]}),e.jsx("button",{onClick:Y,disabled:E,className:"w-full py-3 px-4 rounded-xl font-medium transition-all flex items-center justify-center gap-2",style:{backgroundColor:"var(--accent-primary)",color:"white",opacity:E?.7:1},children:E?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Enviando solicitud..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Solicitar acceso"}),e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})]})})]}),r==="requested"&&e.jsx("div",{className:"mt-2",children:e.jsxs("div",{className:"p-4 rounded-xl flex items-start gap-3",style:{backgroundColor:"rgba(34, 197, 94, 0.1)"},children:[e.jsx("span",{className:"text-xl",children:"‚úÖ"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",style:{color:"var(--text-primary)"},children:"Solicitud enviada"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--text-secondary)"},children:"Te notificaremos cuando tu acceso est√© habilitado."})]})]})}),r==="enabled"&&a==="not_linked"&&e.jsx("div",{className:"mt-2",children:e.jsx("button",{onClick:j,disabled:C,className:"w-full py-3 px-4 rounded-xl font-medium transition-all flex items-center justify-center gap-2",style:{backgroundColor:"#25D366",color:"white",opacity:C?.7:1},children:C?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Generando c√≥digo..."})]}):e.jsx("span",{children:"Vincular WhatsApp"})})}),r==="enabled"&&a==="code_generated"&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm mb-3",style:{color:"var(--text-secondary)"},children:"Envi√° este c√≥digo al bot de WhatsApp de Cash√©:"}),e.jsx("div",{className:"flex justify-center gap-2 mb-4",children:f==null?void 0:f.split("").map((c,x)=>e.jsx("span",{className:"w-12 h-14 rounded-xl flex items-center justify-center text-2xl font-bold",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--accent-primary)"},children:c},x))}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm mb-4",style:{color:"var(--text-secondary)"},children:[e.jsx("div",{className:"w-4 h-4 border-2 border-t-transparent rounded-full animate-spin",style:{borderColor:"#25D366",borderTopColor:"transparent"}}),e.jsx("span",{children:"Esperando verificaci√≥n..."})]}),q&&e.jsxs("p",{className:"text-xs text-center mb-4",style:{color:"var(--text-muted)"},children:["El c√≥digo expira en ",q]}),e.jsxs("a",{href:`https://wa.me/${B}?text=${encodeURIComponent(f||"")}`,target:"_blank",rel:"noopener noreferrer",className:"w-full py-3 px-4 rounded-xl font-medium transition-all flex items-center justify-center gap-2 mb-3",style:{backgroundColor:"#25D366",color:"white"},children:[e.jsx(M,{}),e.jsx("span",{children:"Abrir WhatsApp"})]}),e.jsx("button",{onClick:()=>{n("not_linked"),y(null),v(null)},className:"w-full py-2 px-4 rounded-xl text-sm transition-all",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-secondary)"},children:"Cancelar"})]}),r==="enabled"&&a==="linked"&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"p-4 rounded-xl mb-4",style:{backgroundColor:"var(--bg-tertiary)"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:"N√∫mero vinculado"}),e.jsx("p",{className:"font-medium",style:{color:"var(--text-primary)"},children:ae(g)||g})]}),w&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:"Vinculado"}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:new Date(w).toLocaleDateString("es-AR",{day:"numeric",month:"short",year:"numeric"})})]})]})}),e.jsxs("a",{href:`https://wa.me/${B}`,target:"_blank",rel:"noopener noreferrer",className:"w-full py-3 px-4 rounded-xl font-medium transition-all flex items-center justify-center gap-2 mb-3",style:{backgroundColor:"#25D366",color:"white"},children:[e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-5 h-5",children:e.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"})}),e.jsx("span",{children:"Abrir chat con el bot"})]}),e.jsx("button",{onClick:()=>m(!0),className:"w-full py-2 px-4 rounded-xl text-sm transition-all",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-secondary)"},children:"Desvincular WhatsApp"})]})]}),e.jsx(O,{isOpen:u,onClose:()=>m(!1),onConfirm:P,title:"Desvincular WhatsApp",message:"¬øEst√°s seguro de que quer√©s desvincular tu WhatsApp? Ya no podr√°s registrar movimientos por mensaje.",confirmText:"Desvincular",variant:"warning",loading:C}),_&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:()=>S(!1)}),e.jsxs("div",{className:"relative w-full max-w-sm rounded-2xl p-6 text-center animate-scale-in",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center",style:{backgroundColor:"rgba(34, 197, 94, 0.15)"},children:e.jsx("svg",{className:"w-8 h-8",style:{color:"#22c55e"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",style:{color:"var(--text-primary)"},children:"Solicitud enviada"}),e.jsx("p",{className:"text-sm mb-6",style:{color:"var(--text-secondary)"},children:"Tu solicitud de acceso al bot de WhatsApp fue enviada correctamente. Te notificaremos cuando est√© habilitado."}),e.jsx("button",{onClick:()=>S(!1),className:"w-full py-3 px-4 rounded-xl font-medium transition-all",style:{backgroundColor:"var(--accent-primary)",color:"white"},children:"Entendido"})]})]})]})}const F="CasheAppBot",D=async()=>{const{data:{user:s},error:r}=await h.auth.getUser();if(r)throw console.error("Error getting user:",r),new Error("Error getting authenticated user");if(!s)throw new Error("No authenticated user");return s.id},ie=async()=>{const s=await D(),{data:r,error:t}=await h.from("telegram_users").select("*").eq("user_id",s).maybeSingle();if(t)throw console.error("Error getting Telegram status:",t),t;if(!r)return{status:"not_linked",telegramId:null,telegramUsername:null,telegramFirstName:null,verificationCode:null,linkedAt:null};if(r.verified)return{status:"linked",telegramId:r.telegram_id,telegramUsername:r.telegram_username,telegramFirstName:r.telegram_first_name,verificationCode:null,linkedAt:r.updated_at};const a=r.verification_expires_at&&new Date(r.verification_expires_at)<new Date;return{status:a?"code_expired":"pending_verification",telegramId:null,telegramUsername:null,telegramFirstName:null,verificationCode:a?null:r.verification_code,expiresAt:r.verification_expires_at,linkedAt:null}},le=async()=>{const s=await D(),r=Math.floor(1e5+Math.random()*9e5).toString(),t=new Date(Date.now()+600*1e3).toISOString(),{data:a,error:n}=await h.from("telegram_users").upsert({user_id:s,telegram_id:null,verification_code:r,verification_expires_at:t,verified:!1,updated_at:new Date().toISOString()},{onConflict:"user_id",ignoreDuplicates:!1}).select().single();if(n)throw console.error("Error generating verification code:",n),n;return{code:r,expiresAt:t,expiresIn:600}},ce=async()=>{const s=await D(),{data:r,error:t}=await h.from("telegram_users").select("verified, telegram_id, telegram_username, telegram_first_name, updated_at").eq("user_id",s).maybeSingle();return t?(console.error("Error checking verification:",t),{verified:!1,telegramUsername:null}):r?{verified:r.verified===!0,telegramId:r.verified?r.telegram_id:null,telegramUsername:r.verified?r.telegram_username:null,telegramFirstName:r.verified?r.telegram_first_name:null,linkedAt:r.verified?r.updated_at:null}:{verified:!1,telegramUsername:null}},de=async()=>{const s=await D(),{error:r}=await h.from("telegram_users").delete().eq("user_id",s);if(r)throw console.error("Error unlinking Telegram:",r),r;return{success:!0}},ue=s=>s?s.startsWith("@")?s:`@${s}`:null;function me(){const{showError:s}=G(),[r,t]=o.useState("loading"),[a,n]=o.useState(null),[l,p]=o.useState({telegramId:null,telegramUsername:null,telegramFirstName:null}),[f,y]=o.useState(null),[g,N]=o.useState(null),[w,b]=o.useState(!1),[d,v]=o.useState(!1);o.useEffect(()=>{C()},[]),o.useEffect(()=>{if(r==="code_generated"){const i=setInterval(async()=>{const j=await ce();j.verified&&(t("linked"),p({telegramId:j.telegramId,telegramUsername:j.telegramUsername,telegramFirstName:j.telegramFirstName}),y(j.linkedAt),n(null))},3e3);return()=>clearInterval(i)}},[r]),o.useEffect(()=>{if(!g||r!=="code_generated")return;const j=setInterval(()=>{new Date>new Date(g)&&(t("not_linked"),n(null),N(null))},1e3);return()=>clearInterval(j)},[g,r]);const C=async()=>{try{const i=await ie();i.status==="linked"?(t("linked"),p({telegramId:i.telegramId,telegramUsername:i.telegramUsername,telegramFirstName:i.telegramFirstName}),y(i.linkedAt)):i.status==="pending_verification"&&i.verificationCode?(t("code_generated"),n(i.verificationCode),N(i.expiresAt)):t("not_linked")}catch(i){console.error("Error checking status:",i),t("not_linked")}},k=async()=>{b(!0);try{const i=await le();n(i.code),N(i.expiresAt),t("code_generated")}catch(i){console.error("Error generating code:",i),s("Error al generar el c√≥digo. Por favor intent√° de nuevo.")}finally{b(!1)}},u=async()=>{b(!0);try{await de(),t("not_linked"),p({telegramId:null,telegramUsername:null,telegramFirstName:null}),y(null),v(!1)}catch(i){console.error("Error unlinking Telegram:",i),s("Error al desvincular Telegram. Por favor intent√° de nuevo.")}finally{b(!1)}},m=o.useCallback(()=>{if(!g)return null;const i=new Date(g).getTime()-Date.now();if(i<=0)return null;const j=Math.floor(i/6e4),P=Math.floor(i%6e4/1e3);return`${j}:${P.toString().padStart(2,"0")}`},[g]),[_,S]=o.useState(null);o.useEffect(()=>{if(r!=="code_generated"){S(null);return}const i=()=>S(m());i();const j=setInterval(i,1e3);return()=>clearInterval(j)},[r,m]);const E=()=>e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-8 h-8",children:e.jsx("path",{d:"M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"})}),I=()=>e.jsxs("div",{className:"space-y-4 mb-4",children:[e.jsx("div",{className:"p-4 rounded-xl border",style:{backgroundColor:"rgba(0, 136, 204, 0.08)",borderColor:"rgba(0, 136, 204, 0.2)"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0",style:{backgroundColor:"rgba(0, 136, 204, 0.15)"},children:e.jsx("span",{className:"text-xl",children:"ü§ñ"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-1",style:{color:"#0088cc"},children:"Con Inteligencia Artificial"}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:"Chate√° naturalmente como si hablaras con una persona. El bot entiende lenguaje natural en espa√±ol argentino."})]})]})}),e.jsxs("div",{className:"p-4 rounded-xl",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsx("h4",{className:"font-medium text-sm mb-3",style:{color:"var(--text-primary)"},children:"Ejemplos de lo que pod√©s decir:"}),e.jsxs("div",{className:"space-y-2 text-sm",style:{color:"var(--text-secondary)"},children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("span",{children:"üí¨"}),e.jsx("code",{className:"text-xs",style:{color:"#0088cc"},children:'"Gast√© 500 en comida con galicia"'})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("span",{children:"üí¨"}),e.jsx("code",{className:"text-xs",style:{color:"#0088cc"},children:'"Cobr√© 50000 de sueldo en santander"'})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("span",{children:"üí¨"}),e.jsx("code",{className:"text-xs",style:{color:"#0088cc"},children:'"Transfer√≠ 10k de mp a brubank"'})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("span",{children:"üí¨"}),e.jsx("code",{className:"text-xs",style:{color:"#0088cc"},children:'"Cu√°nto gast√© en comida este mes?"'})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("span",{children:"üí¨"}),e.jsx("code",{className:"text-xs",style:{color:"#0088cc"},children:'"Saldo mercadopago"'})]})]})]}),e.jsxs("div",{className:"p-4 rounded-xl",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsx("h4",{className:"font-medium text-sm mb-3",style:{color:"var(--text-primary)"},children:"Funcionalidades"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",style:{color:"var(--text-secondary)"},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{style:{color:"#0088cc"},children:"üí∏"}),e.jsx("span",{children:"Gastos"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{style:{color:"#0088cc"},children:"üí∞"}),e.jsx("span",{children:"Ingresos"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{style:{color:"#0088cc"},children:"üîÑ"}),e.jsx("span",{children:"Transferencias"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{style:{color:"#0088cc"},children:"üìä"}),e.jsx("span",{children:"Saldos"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{style:{color:"#0088cc"},children:"üìà"}),e.jsx("span",{children:"Resumen mensual"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{style:{color:"#0088cc"},children:"üïê"}),e.jsx("span",{children:"√öltimos movimientos"})]})]}),e.jsx("p",{className:"text-xs mt-3",style:{color:"var(--text-muted)"},children:"Tambi√©n pod√©s usar los botones del men√∫ si prefer√≠s"})]})]});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"rounded-2xl p-6 border transition-all",style:{backgroundColor:"var(--bg-secondary)",borderColor:r==="linked"?"rgba(0, 136, 204, 0.3)":"var(--border-color)"},children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl flex items-center justify-center",style:{backgroundColor:r==="linked"?"rgba(0, 136, 204, 0.15)":"rgba(0, 136, 204, 0.1)",color:"#0088cc"},children:e.jsx(E,{})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg",style:{color:"var(--text-primary)"},children:"Bot de Telegram"}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:r==="linked"?"Vinculado - Registr√° movimientos por mensaje":"Registr√° gastos e ingresos por mensaje"})]}),r==="linked"&&e.jsx("div",{className:"px-3 py-1 rounded-full text-sm font-medium",style:{backgroundColor:"rgba(0, 136, 204, 0.15)",color:"#0088cc"},children:"Conectado"})]}),e.jsx(I,{}),r==="loading"&&e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"w-6 h-6 border-2 border-t-transparent rounded-full animate-spin",style:{borderColor:"var(--accent-primary)",borderTopColor:"transparent"}})}),r==="not_linked"&&e.jsx("div",{className:"mt-2",children:e.jsx("button",{onClick:k,disabled:w,className:"w-full py-3 px-4 rounded-xl font-medium transition-all flex items-center justify-center gap-2",style:{backgroundColor:"#0088cc",color:"white",opacity:w?.7:1},children:w?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Generando c√≥digo..."})]}):e.jsx("span",{children:"Vincular Telegram"})})}),r==="code_generated"&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm mb-3 text-center",style:{color:"var(--text-secondary)"},children:"Copi√° el comando y pegalo en el chat del bot"}),e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-xl mb-4",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsxs("code",{className:"text-lg font-mono font-semibold",style:{color:"#0088cc"},children:["/start ",a]}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(`/start ${a}`);const i=document.getElementById("copy-btn-telegram");i&&(i.textContent="¬°Copiado!",setTimeout(()=>{i.textContent="Copiar"},2e3))},id:"copy-btn-telegram",className:"px-3 py-1.5 rounded-lg text-sm font-medium transition-all",style:{backgroundColor:"#0088cc",color:"white"},children:"Copiar"})]}),e.jsxs("a",{href:`https://t.me/${F}`,target:"_blank",rel:"noopener noreferrer",className:"w-full py-3 px-4 rounded-xl font-medium transition-all flex items-center justify-center gap-2 mb-4",style:{backgroundColor:"#0088cc",color:"white"},children:[e.jsx(E,{}),e.jsx("span",{children:"Abrir chat en Telegram"})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm mb-3",style:{color:"var(--text-secondary)"},children:[e.jsx("div",{className:"w-4 h-4 border-2 border-t-transparent rounded-full animate-spin",style:{borderColor:"#0088cc",borderTopColor:"transparent"}}),e.jsx("span",{children:"Esperando vinculaci√≥n..."})]}),_&&e.jsxs("p",{className:"text-xs text-center mb-4",style:{color:"var(--text-muted)"},children:["El c√≥digo expira en ",_]}),e.jsx("button",{onClick:()=>{t("not_linked"),n(null),N(null)},className:"w-full py-2 px-4 rounded-xl text-sm transition-all",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-secondary)"},children:"Cancelar"})]}),r==="linked"&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"p-4 rounded-xl mb-4",style:{backgroundColor:"var(--bg-tertiary)"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:"Cuenta vinculada"}),e.jsxs("p",{className:"font-medium",style:{color:"var(--text-primary)"},children:[l.telegramFirstName||"Usuario",l.telegramUsername&&e.jsxs("span",{style:{color:"var(--text-secondary)"},children:[" ","(",ue(l.telegramUsername),")"]})]})]}),f&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:"Vinculado"}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:new Date(f).toLocaleDateString("es-AR",{day:"numeric",month:"short",year:"numeric"})})]})]})}),e.jsxs("a",{href:`https://t.me/${F}`,target:"_blank",rel:"noopener noreferrer",className:"w-full py-3 px-4 rounded-xl font-medium transition-all flex items-center justify-center gap-2 mb-3",style:{backgroundColor:"#0088cc",color:"white"},children:[e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-5 h-5",children:e.jsx("path",{d:"M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"})}),e.jsx("span",{children:"Abrir chat con el bot"})]}),e.jsx("button",{onClick:()=>v(!0),className:"w-full py-2 px-4 rounded-xl text-sm transition-all",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-secondary)"},children:"Desvincular Telegram"})]})]}),e.jsx(O,{isOpen:d,onClose:()=>v(!1),onConfirm:u,title:"Desvincular Telegram",message:"¬øEst√°s seguro de que quer√©s desvincular tu Telegram? Ya no podr√°s registrar movimientos por mensaje.",confirmText:"Desvincular",variant:"warning",loading:w})]})}const L=()=>"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window,H=()=>"Notification"in window?Notification.permission:"unsupported",xe=async()=>{if(!("Notification"in window))throw new Error("Notifications not supported");return await Notification.requestPermission()},T=(s,r,t)=>Promise.race([s,new Promise((a,n)=>setTimeout(()=>n(new Error(t)),r))]),V=()=>window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1",pe=async s=>{if(!L())throw new Error("Push notifications not supported");if((await navigator.serviceWorker.getRegistrations()).length===0)throw V()?new Error("Las notificaciones push no funcionan en modo desarrollo. Prob√° con el build de producci√≥n (npm run build && npm run preview)."):new Error("Service Worker no est√° registrado. Recarg√° la p√°gina e intent√° de nuevo.");if(await T(xe(),3e4,"El navegador no respondi√≥ a la solicitud de permisos")!=="granted")throw new Error("Permiso de notificaciones denegado");let a;try{a=await T(navigator.serviceWorker.ready,1e4,"Service Worker no est√° disponible"),await new Promise(l=>setTimeout(l,500))}catch(l){throw console.error("SW registration error:",l),V()?new Error("Las notificaciones push solo funcionan en producci√≥n"):new Error("No se pudo conectar con el Service Worker. Recarg√° la p√°gina.")}let n;try{n=await T(a.pushManager.getSubscription(),5e3,"No se pudo verificar la suscripci√≥n existente")}catch(l){console.warn("Error checking existing subscription:",l),n=null}if(!n){const l=ve(s);try{n=await T(a.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:l}),15e3,"El navegador no pudo completar la suscripci√≥n. Esto puede ocurrir en navegadores con bloqueo de rastreadores activo (como Brave). Prob√° desactivar Shields o us√° Chrome/Firefox.")}catch(p){throw console.error("Push subscription error:",p),p.message.includes("push service")||p.message.includes("Registration failed")?navigator.brave&&navigator.brave.isBrave||navigator.userAgent.includes("Brave")?new Error('Brave bloquea las push notifications por privacidad. And√° a brave://settings/privacy y activ√° "Use Google services for push messaging", o us√° Chrome/Firefox.'):new Error("Tu navegador bloque√≥ las notificaciones push. Verific√° la configuraci√≥n de privacidad del navegador."):p}}try{await T(ge(n),1e4,"No se pudo guardar la suscripci√≥n en el servidor")}catch(l){console.error("Error saving subscription:",l);try{await n.unsubscribe()}catch{}throw l}return n},he=async()=>{if(!L())return;const r=await(await navigator.serviceWorker.ready).pushManager.getSubscription();r&&(await fe(r.endpoint),await r.unsubscribe())},ge=async s=>{const{data:{user:r}}=await h.auth.getUser();if(!r)throw new Error("Not authenticated");const t=s.toJSON(),{error:a}=await h.from("push_subscriptions").upsert({user_id:r.id,endpoint:t.endpoint,p256dh:t.keys.p256dh,auth:t.keys.auth},{onConflict:"user_id,endpoint"});if(a)throw a},fe=async s=>{const{data:{user:r}}=await h.auth.getUser();r&&await h.from("push_subscriptions").delete().eq("user_id",r.id).eq("endpoint",s)},z=async()=>{if(!L())return{supported:!1,subscribed:!1};const s=H();if(s==="denied")return{supported:!0,subscribed:!1,permission:"denied"};try{return(await navigator.serviceWorker.getRegistrations()).length===0?{supported:!0,subscribed:!1,permission:s,noSW:!0}:{supported:!0,subscribed:!!await(await Promise.race([navigator.serviceWorker.ready,new Promise((n,l)=>setTimeout(()=>l(new Error("SW timeout")),1e4))])).pushManager.getSubscription(),permission:s}}catch(r){return console.warn("Service worker not ready:",r),{supported:!0,subscribed:!1,permission:s}}};function ve(s){const r="=".repeat((4-s.length%4)%4),t=(s+r).replace(/-/g,"+").replace(/_/g,"/"),a=window.atob(t),n=new Uint8Array(a.length);for(let l=0;l<a.length;++l)n[l]=a.charCodeAt(l);return n}const $=async(s,r={})=>{if(H()!=="granted")throw new Error("Notification permission not granted");await(await navigator.serviceWorker.ready).showNotification(s,{icon:"/icons/icon-192.png",badge:"/icons/icon-96.png",...r})},ye="BGAtLxt4YDMsBi4kHWTDoGusF-x1-qGY3YF6TqYzr_JOMbcVUJ2sh9cjOMHty3v6_B5F5QabzpMmFqPDjSGQRCU";function be(){const[s,r]=o.useState({supported:!1,subscribed:!1,permission:"default",loading:!0}),[t,a]=o.useState(null),[n,l]=o.useState(!1);o.useEffect(()=>{p()},[]);const p=async()=>{try{const d=await z();r({...d,loading:!1})}catch(d){console.error("Error checking push status:",d),r(v=>({...v,loading:!1}))}},f=async()=>{l(!0),a(null);try{await pe(ye),await p(),await $("Notificaciones activadas",{body:"Recibir√°s alertas de transacciones programadas",tag:"subscription-success"})}catch(d){console.error("Error subscribing:",d),a(d.message||"No se pudieron activar las notificaciones")}finally{l(!1)}},y=async()=>{l(!0),a(null);try{await he(),await p()}catch(d){console.error("Error unsubscribing:",d),a(d.message||"No se pudieron desactivar las notificaciones")}finally{l(!1)}},g=async()=>{try{await $("Notificaci√≥n de prueba",{body:"Las notificaciones funcionan correctamente",tag:"test-notification"})}catch{a("No se pudo enviar la notificaci√≥n de prueba")}},N=/iPad|iPhone|iPod/.test(navigator.userAgent),w=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0,b=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1";return!s.supported&&!s.loading?e.jsx("div",{className:"rounded-2xl p-6",style:{backgroundColor:"var(--bg-secondary)"},children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl flex items-center justify-center flex-shrink-0",style:{backgroundColor:"var(--bg-tertiary)"},children:e.jsx("svg",{className:"w-8 h-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{color:"var(--text-muted)"},children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold",style:{color:"var(--text-primary)"},children:"Notificaciones Push"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--text-muted)"},children:N&&!w?"Para activar notificaciones en iOS, instal√° la app: Compartir ‚Üí Agregar a pantalla de inicio":"Tu navegador no soporta notificaciones push"})]})]})}):s.permission==="denied"?e.jsx("div",{className:"rounded-2xl p-6",style:{backgroundColor:"var(--bg-secondary)"},children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl flex items-center justify-center flex-shrink-0",style:{backgroundColor:"var(--accent-red-dim)"},children:e.jsx("svg",{className:"w-8 h-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{color:"var(--accent-red)"},children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold",style:{color:"var(--text-primary)"},children:"Notificaciones Push"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--text-secondary)"},children:"Las notificaciones est√°n bloqueadas. Para activarlas, debes cambiar los permisos en la configuraci√≥n de tu navegador."})]})]})}):e.jsx("div",{className:"rounded-2xl p-6",style:{backgroundColor:"var(--bg-secondary)"},children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl flex items-center justify-center flex-shrink-0",style:{backgroundColor:s.subscribed?"var(--accent-green-dim)":"var(--accent-primary-dim)"},children:e.jsx("svg",{className:"w-8 h-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{color:s.subscribed?"var(--accent-green)":"var(--accent-primary)"},children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold",style:{color:"var(--text-primary)"},children:"Notificaciones Push"}),s.subscribed&&e.jsx("span",{className:"px-2 py-1 rounded-lg text-xs font-medium",style:{backgroundColor:"var(--accent-green-dim)",color:"var(--accent-green)"},children:"Activadas"})]}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--text-secondary)"},children:s.subscribed?"Recibir√°s notificaciones cuando tengas transacciones programadas pendientes de aprobaci√≥n.":"Activa las notificaciones para recibir alertas de transacciones programadas."}),t&&e.jsx("p",{className:"text-sm mt-2",style:{color:"var(--accent-red)"},children:t}),e.jsx("div",{className:"flex gap-2 mt-4",children:s.subscribed?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:g,className:"px-4 py-2 rounded-xl text-sm font-medium transition-colors",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-secondary)"},children:"Probar"}),e.jsx("button",{onClick:y,disabled:n,className:"px-4 py-2 rounded-xl text-sm font-medium transition-colors disabled:opacity-50",style:{backgroundColor:"var(--accent-red-dim)",color:"var(--accent-red)"},children:n?"Desactivando...":"Desactivar"})]}):e.jsx("button",{onClick:f,disabled:n||s.loading,className:"px-4 py-2 rounded-xl text-sm font-medium transition-colors disabled:opacity-50",style:{backgroundColor:"var(--accent-primary)",color:"white"},children:n?"Activando...":"Activar notificaciones"})}),!s.subscribed&&e.jsx("p",{className:"text-xs mt-3",style:{color:"var(--text-muted)"},children:b?'Nota: Las notificaciones push solo funcionan en producci√≥n. Us√° "npm run build && npm run preview" para probar.':"Se te pedir√° permiso para enviar notificaciones. Puedes desactivarlas en cualquier momento."})]})]})})}function je(){const[s,r]=o.useState({notifyPush:!0,notifyTelegram:!1,notifyWhatsapp:!1,notificationHour:9}),[t,a]=o.useState(!0),[n,l]=o.useState(!1),[p,f]=o.useState(null),[y,g]=o.useState(!1),[N,w]=o.useState({push:!1,telegram:!1,whatsapp:!1});o.useEffect(()=>{b(),d()},[]);const b=async()=>{try{a(!0);const u=await Q();r(u)}catch(u){console.error("Error loading notification preferences:",u),f("No se pudieron cargar las preferencias")}finally{a(!1)}},d=async()=>{try{const u=await z();w(m=>({...m,push:u.subscribed}))}catch(u){console.error("Error checking linked services:",u)}},v=async u=>{const m=!s[u],_={...s,[u]:m};r(_),await k(_)},C=async u=>{const m={...s,notificationHour:u};r(m),await k(m)},k=async u=>{try{l(!0),f(null),g(!1),await X(u),g(!0),setTimeout(()=>g(!1),2e3)}catch(m){console.error("Error saving notification preferences:",m),f("No se pudieron guardar las preferencias"),await b()}finally{l(!1)}};return t?e.jsx("div",{className:"rounded-2xl p-6",style:{backgroundColor:"var(--bg-secondary)"},children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl flex items-center justify-center flex-shrink-0 animate-pulse",style:{backgroundColor:"var(--bg-tertiary)"}}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 rounded animate-pulse",style:{backgroundColor:"var(--bg-tertiary)",width:"60%"}}),e.jsx("div",{className:"h-3 rounded animate-pulse",style:{backgroundColor:"var(--bg-tertiary)",width:"80%"}})]})]})}):e.jsx("div",{className:"rounded-2xl p-6",style:{backgroundColor:"var(--bg-secondary)"},children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl flex items-center justify-center flex-shrink-0",style:{backgroundColor:"var(--accent-yellow-dim)"},children:e.jsx("span",{className:"text-2xl",children:"üí≥"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold",style:{color:"var(--text-primary)"},children:"Vencimiento de Tarjetas"}),y&&e.jsx("span",{className:"px-2 py-1 rounded-lg text-xs font-medium",style:{backgroundColor:"var(--accent-green-dim)",color:"var(--accent-green)"},children:"Guardado"})]}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--text-secondary)"},children:"Recib√≠ un recordatorio un d√≠a antes del vencimiento de tus tarjetas de cr√©dito con el monto a pagar."}),p&&e.jsx("p",{className:"text-sm mt-2",style:{color:"var(--accent-red)"},children:p}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx(W,{label:"Notificaciones Push",description:"En el navegador o app instalada",enabled:s.notifyPush,onToggle:()=>v("notifyPush"),disabled:n}),e.jsx(W,{label:"Telegram",description:"Requiere vincular tu cuenta",enabled:s.notifyTelegram,onToggle:()=>v("notifyTelegram"),disabled:n}),e.jsx(W,{label:"WhatsApp",description:"Requiere vincular tu cuenta",enabled:s.notifyWhatsapp,onToggle:()=>v("notifyWhatsapp"),disabled:n})]}),e.jsx("div",{className:"mt-4 pt-4 border-t",style:{borderColor:"var(--border-subtle)"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:"Hora de notificaci√≥n"}),e.jsx("p",{className:"text-xs mt-0.5",style:{color:"var(--text-muted)"},children:"Hora Argentina (UTC-3)"})]}),e.jsx("select",{value:s.notificationHour,onChange:u=>C(parseInt(u.target.value)),disabled:n,className:"px-3 py-2 rounded-lg text-sm font-medium border-none cursor-pointer",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-primary)"},children:Array.from({length:24},(u,m)=>e.jsxs("option",{value:m,children:[m.toString().padStart(2,"0"),":00"]},m))})]})}),e.jsx("p",{className:"text-xs mt-4",style:{color:"var(--text-muted)"},children:"Las notificaciones se env√≠an un d√≠a antes del vencimiento. Asegurate de configurar el d√≠a de vencimiento en cada tarjeta de cr√©dito."})]})]})})}function W({label:s,description:r,enabled:t,onToggle:a,disabled:n}){return e.jsxs("button",{onClick:a,disabled:n,className:"w-full flex items-center justify-between p-2 rounded-lg transition-colors hover:bg-[var(--bg-tertiary)] disabled:opacity-50",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:s}),r&&e.jsx("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:r})]}),e.jsx("div",{className:"w-11 h-6 rounded-full transition-all duration-200 relative flex-shrink-0",style:{backgroundColor:t?"var(--accent-primary)":"var(--bg-tertiary)"},children:e.jsx("div",{className:`absolute top-1 w-4 h-4 rounded-full bg-white shadow transition-all duration-200 ${t?"left-6":"left-1"}`})})]})}function we(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-medium",style:{color:"var(--text-primary)"},children:"Integraciones"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--text-secondary)"},children:"Conect√° servicios externos para gestionar tus finanzas"})]}),e.jsx("div",{className:"rounded-2xl p-5 border",style:{background:"linear-gradient(135deg, rgba(20, 184, 166, 0.1) 0%, rgba(59, 130, 246, 0.1) 100%)",borderColor:"rgba(20, 184, 166, 0.2)"},children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0",style:{backgroundColor:"rgba(20, 184, 166, 0.2)"},children:e.jsx("span",{className:"text-2xl",children:"ü§ñ"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-1",style:{color:"var(--text-primary)"},children:"Bots con Inteligencia Artificial"}),e.jsxs("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:["Nuestros bots de Telegram y WhatsApp entienden ",e.jsx("strong",{children:"lenguaje natural"}),". Escrib√≠ como si chatearas con un amigo: ",e.jsx("em",{children:'"gast√© 500 en el super con mp"'})," y el bot lo entiende autom√°ticamente."]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-3",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs",style:{backgroundColor:"rgba(20, 184, 166, 0.15)",color:"var(--accent-primary)"},children:[e.jsx("span",{children:"‚ú®"})," Espa√±ol argentino"]}),e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs",style:{backgroundColor:"rgba(20, 184, 166, 0.15)",color:"var(--accent-primary)"},children:[e.jsx("span",{children:"üéØ"})," Entiende aliases (mp, gal, bru)"]}),e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs",style:{backgroundColor:"rgba(20, 184, 166, 0.15)",color:"var(--accent-primary)"},children:[e.jsx("span",{children:"‚úÖ"})," Confirmaci√≥n antes de guardar"]})]})]})]})}),e.jsx(je,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(be,{}),e.jsx(me,{}),e.jsx(oe,{}),e.jsx("div",{className:"rounded-2xl p-6 border border-dashed",style:{backgroundColor:"var(--bg-secondary)",borderColor:"var(--border-color)",opacity:.6},children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl flex items-center justify-center",style:{backgroundColor:"var(--bg-tertiary)"},children:e.jsx("svg",{className:"w-8 h-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{color:"var(--text-muted)"},children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",style:{color:"var(--text-muted)"},children:"M√°s integraciones pr√≥ximamente"}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:"Importaci√≥n de extractos bancarios y m√°s"})]})]})})]})]})}export{we as default};
