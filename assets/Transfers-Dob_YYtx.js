import{n as T,r,a5 as M,x as y,w as R,j as c,E as G,a0 as H,a6 as D,A as o,D as n,a7 as _}from"./index-BpxMBPca.js";import{M as j}from"./MovementsList-CU4LwYIH.js";import{P as k}from"./PullToRefresh-2qygRaJC.js";import"./DateRangePicker-BVPqObrC.js";import"./SortDropdown-DbDxdAR7.js";function b(){const{showError:u}=T(),[N,i]=r.useState([]),[d,p]=r.useState([]),[m,E]=r.useState(!0),[S,l]=r.useState(null),[w,A]=r.useState(!1),[v,g]=r.useState(!1),s=r.useCallback(async(a=!1,e=!0)=>{try{e&&E(!0);const[t,f]=await Promise.all([M(a),y()]);i(t.transfers||[]),p(f.accounts||[])}catch(t){console.error("Error fetching data:",t)}finally{e&&E(!1)}},[]);r.useEffect(()=>{s()},[s]),R(n.TRANSFERS_CHANGED,()=>s(!0,!1));const h=async a=>{try{A(!0),await _(a),l(null),o(n.TRANSFERS_CHANGED),o(n.ACCOUNTS_CHANGED),await s(!0,!1)}catch(e){console.error("Error updating:",e),u("No se pudo guardar la transferencia",e.message)}finally{A(!1)}},C=async a=>{l(null),i(e=>e.filter(t=>t.rowIndex!==a.rowIndex));try{await D(a),o(n.TRANSFERS_CHANGED),o(n.ACCOUNTS_CHANGED)}catch(e){console.error("Error deleting:",e),u("No se pudo eliminar la transferencia",e.message),s()}},x=async a=>{const e=new Set(a.map(t=>t.rowIndex));i(t=>t.filter(f=>!e.has(f.rowIndex)));for(const t of a)await D(t);o(n.TRANSFERS_CHANGED),o(n.ACCOUNTS_CHANGED),await s()};return c.jsxs(k,{onRefresh:s,disabled:m,children:[c.jsx(j,{title:"Transferencias",movements:N,accounts:d,categories:[],loading:m,onMovementClick:l,onMovementDelete:C,onBulkDelete:x,onAddClick:()=>g(!0),type:"transferencia"}),S&&c.jsx(G,{movement:S,accounts:d,categories:{ingresos:[],gastos:[]},onSave:h,onDelete:C,onClose:()=>l(null),loading:w}),c.jsx(H,{isOpen:v,onClose:()=>{g(!1),s()},defaultType:"transfer"})]})}export{b as default};
