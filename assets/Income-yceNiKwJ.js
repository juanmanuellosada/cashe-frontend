import{g as A,r as o,a2 as C,n as B,o as N,j as n,E as U,$ as b,a0 as L,a1 as q,p as F,q as O}from"./index-CKWgcbuo.js";import{M as P}from"./MovementsList-BhyvU6zd.js";import"./DateRangePicker-581Jnx40.js";import"./SortDropdown-8-fXskt5.js";function G(){const{showError:u}=A(),[h,r]=o.useState([]),[g,v]=o.useState([]),[m,S]=o.useState({ingresos:[],gastos:[]}),[y,p]=o.useState(!0),[w,c]=o.useState(null),[I,f]=o.useState(!1),[E,x]=o.useState(!1);o.useEffect(()=>{a()},[]);const a=async()=>{try{p(!0);const[e,t,s]=await Promise.all([C(),B(),N()]);r(e.incomes||[]),v(t.accounts||[]),S(s.categorias||{ingresos:[],gastos:[]})}catch(e){console.error("Error fetching data:",e)}finally{p(!1)}},D=async e=>{try{f(!0),await O(e),c(null),await a()}catch(t){console.error("Error updating:",t),u("No se pudo guardar el ingreso",t.message)}finally{f(!1)}},M=async e=>{c(null),r(t=>t.filter(s=>s.rowIndex!==e.rowIndex));try{await F(e)}catch(t){console.error("Error deleting:",t),u("No se pudo eliminar el ingreso",t.message),a()}},k=async e=>{const t=new Set(e.map(s=>s.rowIndex));r(s=>s.filter(l=>!t.has(l.rowIndex))),await q(e),a()},j=async(e,t,s)=>{const l=new Set(e.map(i=>i.rowIndex));r(i=>i.map(d=>l.has(d.rowIndex)?{...d,[t]:s}:d)),await L(e,t,s),a()};return n.jsxs(n.Fragment,{children:[n.jsx(P,{title:"Ingresos",movements:h,accounts:g,categories:m.ingresos||[],loading:y,onMovementClick:c,onMovementDelete:M,onBulkDelete:k,onBulkUpdate:j,onAddClick:()=>x(!0),type:"ingreso"}),w&&n.jsx(U,{movement:w,accounts:g,categories:m,onSave:D,onDelete:M,onClose:()=>c(null),loading:I}),n.jsx(b,{isOpen:E,onClose:()=>{x(!1),a()},defaultType:"income"})]})}export{G as default};
