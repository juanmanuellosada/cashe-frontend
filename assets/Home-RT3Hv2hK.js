import{t as z,j as e,f as M,r as u,u as re,i as ee,a as se,s as H,e as U,b as B,c as ue,d as pe,g as he,h as ge,k as ve,l as ye,m as te,n as fe,L as ae,E as be,o as je,p as we,q as Ne,D as R,v as T,w as ke}from"./index-BGEaSxlK.js";import{D as oe}from"./DateRangePicker-BKGIHUt9.js";import{P as Ce}from"./PullToRefresh-Dlgqxg7w.js";import"./subMonths-tRzUbsbS.js";function Se(p,b,r){const h=+z(p,r==null?void 0:r.in),[i,j]=[+z(b.start,r==null?void 0:r.in),+z(b.end,r==null?void 0:r.in)].sort((x,o)=>x-o);return h>=i&&h<=j}function De({totalPesos:p,totalDolares:b,totalGeneralPesos:r,totalGeneralDolares:h,tipoCambio:i,currency:j="ARS",ingresosMes:x=0,gastosMes:o=0,ingresosMesDolares:N=0,gastosMesDolares:k=0}){const n=j==="ARS"?r:h,d=j==="ARS"?x:N,v=j==="ARS"?o:k,C=d-Math.abs(v);return e.jsxs("div",{className:"p-3 sm:p-4 rounded-xl",style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-subtle)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-3",children:[e.jsx("span",{className:"text-[11px] sm:text-xs",style:{color:"var(--text-muted)"},children:"Balance total"}),e.jsx("span",{className:"px-1.5 sm:px-2 py-0.5 rounded text-[9px] sm:text-[10px] font-medium",style:{backgroundColor:j==="ARS"?"var(--accent-primary-dim)":"var(--accent-green-dim)",color:j==="ARS"?"var(--accent-primary)":"var(--accent-green)"},children:j})]}),e.jsx("h2",{className:"text-xl sm:text-2xl font-medium tracking-tight mb-3 sm:mb-4",style:{color:"var(--text-primary)"},children:M(n,j)}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-3 mb-2 sm:mb-3",children:[e.jsxs("div",{className:"p-2 sm:p-3 rounded-lg",style:{backgroundColor:"var(--accent-green-dim)"},children:[e.jsx("p",{className:"text-[9px] sm:text-[10px] uppercase tracking-wide mb-0.5 sm:mb-1",style:{color:"var(--text-muted)"},children:"Ingresos"}),e.jsxs("p",{className:"text-xs sm:text-sm font-medium truncate",style:{color:"var(--accent-green)"},children:["+",M(Math.abs(d),j)]})]}),e.jsxs("div",{className:"p-2 sm:p-3 rounded-lg",style:{backgroundColor:"var(--accent-red-dim)"},children:[e.jsx("p",{className:"text-[9px] sm:text-[10px] uppercase tracking-wide mb-0.5 sm:mb-1",style:{color:"var(--text-muted)"},children:"Gastos"}),e.jsxs("p",{className:"text-xs sm:text-sm font-medium truncate",style:{color:"var(--accent-red)"},children:["-",M(Math.abs(v),j)]})]})]}),e.jsxs("div",{className:"flex items-center justify-between py-1.5 sm:py-2",children:[e.jsx("span",{className:"text-[11px] sm:text-xs",style:{color:"var(--text-muted)"},children:"Flujo neto"}),e.jsxs("span",{className:"text-xs sm:text-sm font-medium",style:{color:C>=0?"var(--accent-green)":"var(--accent-red)"},children:[C>=0?"+":"",M(C,j)]})]}),i&&e.jsxs("div",{className:"flex items-center justify-between pt-1.5 sm:pt-2 mt-1.5 sm:mt-2",style:{borderTop:"1px solid var(--border-subtle)"},children:[e.jsx("span",{className:"text-[11px] sm:text-xs",style:{color:"var(--text-muted)"},children:"Tipo de cambio"}),e.jsxs("span",{className:"text-[11px] sm:text-xs font-medium",style:{color:"var(--text-secondary)"},children:[M(i)," / USD"]})]})]})}function Me({accounts:p,loading:b,onAccountClick:r}){const[h,i]=u.useState(!0),j=re();if(b)return e.jsx("div",{className:"card-glass overflow-hidden",children:e.jsxs("div",{className:"p-4 flex items-center justify-between",children:[e.jsx("div",{className:"h-4 w-24 skeleton-shimmer rounded-lg",style:{backgroundColor:"var(--bg-tertiary)"}}),e.jsx("div",{className:"h-4 w-16 skeleton-shimmer rounded-lg",style:{backgroundColor:"var(--bg-tertiary)"}})]})});if(!p||p.length===0)return null;const x=o=>{r&&r(o)};return e.jsxs("div",{className:"card-glass overflow-hidden transition-all duration-300",children:[e.jsxs("button",{onClick:()=>i(!h),className:"w-full px-3 py-3 sm:p-4 flex items-center justify-between text-left transition-all duration-200 hover:bg-[var(--bg-tertiary)] active:scale-[0.99]",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("div",{className:"w-8 h-8 sm:w-9 sm:h-9 rounded-lg sm:rounded-xl flex items-center justify-center",style:{backgroundColor:"var(--accent-primary-dim)"},children:e.jsx("svg",{className:"w-4 h-4 sm:w-4.5 sm:h-4.5",style:{color:"var(--accent-primary)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.75,d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-sm sm:text-[15px]",style:{color:"var(--text-primary)"},children:"Cuentas"}),e.jsx("span",{className:"ml-1.5 sm:ml-2 text-[9px] sm:text-[10px] px-1.5 sm:px-2 py-0.5 rounded-full font-medium",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-secondary)"},children:p.length})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx("span",{className:"text-[11px] sm:text-xs font-medium hidden sm:inline",style:{color:"var(--text-secondary)"},children:h?"Ocultar":"Ver todas"}),e.jsx("div",{className:"w-5 h-5 sm:w-6 sm:h-6 rounded-md sm:rounded-lg flex items-center justify-center transition-colors",style:{backgroundColor:"var(--bg-tertiary)"},children:e.jsx("svg",{className:`w-3.5 h-3.5 sm:w-4 sm:h-4 transition-transform duration-300 ${h?"rotate-180":""}`,style:{color:"var(--text-secondary)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),h&&e.jsxs("div",{className:"animate-scale-in",style:{borderTop:"1px solid var(--border-subtle)"},children:[e.jsx("div",{className:"hidden lg:grid lg:grid-cols-2 xl:grid-cols-3 gap-px",style:{backgroundColor:"var(--border-subtle)"},children:p.map((o,N)=>{const k=o.moneda==="Peso",n=k?"#75AADB":"#3CB371",d=!!o.icon,v=d&&ee(o.icon);return e.jsxs("button",{onClick:()=>x(o),className:"p-4 flex items-center gap-3 text-left transition-all duration-200 hover:bg-[var(--bg-tertiary)] group",style:{backgroundColor:"var(--bg-secondary)",animationDelay:`${N*50}ms`},children:[e.jsx("div",{className:"w-11 h-11 rounded-xl flex items-center justify-center flex-shrink-0 transition-transform duration-200 group-hover:scale-110 overflow-hidden",style:{backgroundColor:d&&!v?"transparent":`${n}15`,boxShadow:`0 0 20px ${n}10`},children:d?v?e.jsx("span",{className:"text-xl",children:o.icon}):e.jsx("img",{src:se(o.icon),alt:o.nombre,className:"w-full h-full object-cover rounded-xl"}):e.jsx("span",{className:"text-sm font-bold",style:{color:n},children:k?"$":"US$"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold truncate text-[15px]",style:{color:"var(--text-primary)"},children:o.nombre}),e.jsxs("p",{className:"text-[11px] mt-0.5",style:{color:"var(--text-secondary)"},children:[k?"Pesos":"DÃ³lares",o.tipo&&` Â· ${o.tipo}`]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsx("p",{className:"font-bold text-[15px]",style:{color:n},children:M(o.balanceActual,k?"ARS":"USD")})})]},o.nombre)})}),e.jsx("div",{className:"lg:hidden overflow-hidden",children:p.map((o,N)=>{const k=o.moneda==="Peso",n=k?"#75AADB":"#3CB371",d=!!o.icon,v=d&&ee(o.icon);return e.jsxs("button",{onClick:()=>x(o),className:"w-full px-3 py-2.5 flex items-start gap-2 text-left transition-all duration-200 hover:bg-[var(--bg-tertiary)] active:scale-[0.99] group",style:{borderBottom:N<p.length-1?"1px solid var(--border-subtle)":"none"},children:[e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0 mt-0.5 overflow-hidden",style:{backgroundColor:d&&!v?"transparent":`${n}15`},children:d?v?e.jsx("span",{className:"text-lg",children:o.icon}):e.jsx("img",{src:se(o.icon),alt:o.nombre,className:"w-full h-full object-cover rounded-lg"}):e.jsx("span",{className:"text-[11px] font-bold",style:{color:n},children:k?"$":"US$"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-[13px] leading-tight break-words",style:{color:"var(--text-primary)",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:o.nombre}),e.jsxs("p",{className:"text-[10px] mt-0.5",style:{color:"var(--text-secondary)"},children:[k?"Pesos":"DÃ³lares",o.tipo&&` Â· ${o.tipo}`]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsx("p",{className:"font-bold text-[13px]",style:{color:n},children:M(o.balanceActual,k?"ARS":"USD")})})]},o.nombre)})}),e.jsx("button",{onClick:()=>j("/cuentas"),className:"w-full py-2.5 sm:p-3.5 text-center text-xs sm:text-sm font-semibold transition-all duration-200 hover:bg-[var(--accent-primary-dim)] active:scale-[0.99]",style:{color:"var(--accent-primary)",borderTop:"1px solid var(--border-subtle)"},children:"Ver detalles de cuentas â†’"})]})]})}function Ee({movements:p,loading:b}){var x,o,N,k;const[r,h]=u.useState("ARS"),i=u.useMemo(()=>{if(!p||p.length===0)return null;const n=new Date,d=H(n,{weekStartsOn:1}),v=U(n,{weekStartsOn:1}),C=p.filter(y=>{if(y.tipo!=="gasto")return!1;const f=new Date(y.fecha);return Se(f,{start:d,end:v})});if(C.length===0)return{avgDaily:0,avgDailyDolares:0,maxDay:null,topCategory:null,totalWeek:0,totalWeekDolares:0,daysWithExpenses:0};const D=C.reduce((y,f)=>y+(f.montoPesos||f.monto||0),0),E=C.reduce((y,f)=>y+(f.montoDolares||0),0),l=new Set(C.map(y=>B(new Date(y.fecha),"yyyy-MM-dd"))).size,c=D/7,t=E/7,m={};C.forEach(y=>{const f=B(new Date(y.fecha),"yyyy-MM-dd"),_=B(new Date(y.fecha),"EEEE",{locale:ue});m[f]||(m[f]={name:_,amount:0,amountDolares:0,date:f}),m[f].amount+=y.montoPesos||y.monto||0,m[f].amountDolares+=y.montoDolares||0});const A=Object.values(m).sort((y,f)=>f.amount-y.amount)[0]||null,W={};C.forEach(y=>{const f=y.categoria||"Sin categorÃ­a";W[f]||(W[f]={name:f,amount:0,amountDolares:0}),W[f].amount+=y.montoPesos||y.monto||0,W[f].amountDolares+=y.montoDolares||0});const O=Object.values(W).sort((y,f)=>f.amount-y.amount)[0]||null;return{avgDaily:c,avgDailyDolares:t,maxDay:A,topCategory:O,totalWeek:D,totalWeekDolares:E,daysWithExpenses:l}},[p]);if(b)return e.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx("div",{className:"w-7 h-7 sm:w-8 sm:h-8 rounded-md sm:rounded-lg skeleton-shimmer",style:{backgroundColor:"var(--bg-tertiary)"}}),e.jsx("div",{className:"h-4 w-24 sm:w-28 skeleton-shimmer rounded-lg",style:{backgroundColor:"var(--bg-tertiary)"}})]}),e.jsx("div",{className:"card-glass p-3 sm:p-4",children:e.jsx("div",{className:"grid grid-cols-3 gap-2 sm:gap-3",children:[1,2,3].map(n=>e.jsxs("div",{className:"space-y-1.5 sm:space-y-2",children:[e.jsx("div",{className:"h-2.5 sm:h-3 w-12 sm:w-16 skeleton-shimmer rounded-lg",style:{backgroundColor:"var(--bg-tertiary)"}}),e.jsx("div",{className:"h-4 sm:h-5 w-16 sm:w-20 skeleton-shimmer rounded-lg",style:{backgroundColor:"var(--bg-tertiary)"}})]},n))})})]});if(!i||i.totalWeek===0)return e.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx("div",{className:"w-7 h-7 sm:w-8 sm:h-8 rounded-md sm:rounded-lg flex items-center justify-center",style:{backgroundColor:"var(--accent-primary-dim)"},children:e.jsx("svg",{className:"w-3.5 h-3.5 sm:w-4 sm:h-4",style:{color:"var(--accent-primary)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("h3",{className:"text-sm sm:text-[15px] font-semibold",style:{color:"var(--text-primary)"},children:"Esta semana"})]}),e.jsxs("div",{className:"card-glass p-4 sm:p-6 text-center",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 mx-auto mb-2 sm:mb-3 rounded-lg sm:rounded-xl flex items-center justify-center",style:{backgroundColor:"var(--bg-tertiary)"},children:e.jsx("svg",{className:"w-5 h-5 sm:w-6 sm:h-6",style:{color:"var(--text-secondary)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),e.jsx("p",{className:"text-xs sm:text-sm font-medium",style:{color:"var(--text-secondary)"},children:"Sin gastos esta semana"})]})]});const j=n=>{const d=n==null?void 0:n.match(/^[\p{Emoji}\u200d]+/u);return d?d[0]:"ðŸ“Š"};return e.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx("div",{className:"w-7 h-7 sm:w-8 sm:h-8 rounded-md sm:rounded-lg flex items-center justify-center",style:{backgroundColor:"var(--accent-primary-dim)"},children:e.jsx("svg",{className:"w-3.5 h-3.5 sm:w-4 sm:h-4",style:{color:"var(--accent-primary)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("h3",{className:"text-sm sm:text-[15px] font-semibold",style:{color:"var(--text-primary)"},children:"Esta semana"})]}),e.jsxs("div",{className:"inline-flex rounded-lg sm:rounded-xl p-0.5 sm:p-1",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsxs("button",{onClick:()=>h("ARS"),className:"px-2 sm:px-3.5 py-1 sm:py-1.5 rounded-md sm:rounded-lg text-[11px] sm:text-xs font-semibold transition-all duration-300 active:scale-95 flex items-center gap-1 sm:gap-1.5",style:{backgroundColor:r==="ARS"?"var(--accent-primary)":"transparent",color:r==="ARS"?"white":"var(--text-secondary)",boxShadow:r==="ARS"?"0 4px 12px var(--accent-primary-glow)":"none"},children:[e.jsx("img",{src:"/icons/catalog/ARS.svg",alt:"ARS",className:"w-3.5 h-3.5 sm:w-4 sm:h-4 rounded-sm"}),"ARS"]}),e.jsxs("button",{onClick:()=>h("USD"),className:"px-2 sm:px-3.5 py-1 sm:py-1.5 rounded-md sm:rounded-lg text-[11px] sm:text-xs font-semibold transition-all duration-300 active:scale-95 flex items-center gap-1 sm:gap-1.5",style:{backgroundColor:r==="USD"?"var(--accent-green)":"transparent",color:r==="USD"?"white":"var(--text-secondary)",boxShadow:r==="USD"?"0 4px 12px rgba(0, 217, 154, 0.3)":"none"},children:[e.jsx("img",{src:"/icons/catalog/USD.svg",alt:"USD",className:"w-3.5 h-3.5 sm:w-4 sm:h-4 rounded-sm"}),"USD"]})]})]}),e.jsx("div",{className:"card-glass p-3 sm:p-4",children:e.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-3",children:[e.jsxs("div",{className:"group p-2 sm:p-3 rounded-xl transition-all duration-200 hover:bg-[var(--bg-tertiary)]",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-1.5 mb-1.5 sm:mb-2",children:[e.jsx("div",{className:"w-5 h-5 sm:w-6 sm:h-6 rounded-md sm:rounded-lg flex items-center justify-center",style:{backgroundColor:"rgba(59, 130, 246, 0.15)"},children:e.jsx("svg",{className:"w-2.5 h-2.5 sm:w-3 sm:h-3",style:{color:"var(--accent-blue)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),e.jsx("span",{className:"text-[9px] sm:text-[10px] uppercase tracking-wider font-medium",style:{color:"var(--text-secondary)"},children:"Prom/dÃ­a"})]}),e.jsx("p",{className:"text-xs sm:text-base font-bold truncate",style:{color:"var(--accent-blue)"},children:M(r==="ARS"?i.avgDaily:i.avgDailyDolares,r)})]}),e.jsxs("div",{className:"group p-2 sm:p-3 rounded-xl transition-all duration-200 hover:bg-[var(--bg-tertiary)]",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-1.5 mb-1.5 sm:mb-2",children:[e.jsx("div",{className:"w-5 h-5 sm:w-6 sm:h-6 rounded-md sm:rounded-lg flex items-center justify-center",style:{backgroundColor:"rgba(255, 92, 114, 0.15)"},children:e.jsx("svg",{className:"w-2.5 h-2.5 sm:w-3 sm:h-3",style:{color:"var(--accent-red)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("span",{className:"text-[9px] sm:text-[10px] uppercase tracking-wider font-medium",style:{color:"var(--text-secondary)"},children:"DÃ­a pico"})]}),e.jsx("p",{className:"text-xs sm:text-sm font-bold capitalize truncate",style:{color:"var(--accent-red)"},children:((x=i.maxDay)==null?void 0:x.name)||"-"}),e.jsx("p",{className:"text-[10px] sm:text-[11px] mt-0.5 truncate",style:{color:"var(--text-secondary)"},children:i.maxDay?M(r==="ARS"?i.maxDay.amount:i.maxDay.amountDolares,r):"-"})]}),e.jsxs("div",{className:"group p-2 sm:p-3 rounded-xl transition-all duration-200 hover:bg-[var(--bg-tertiary)]",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-1.5 mb-1.5 sm:mb-2",children:[e.jsx("div",{className:"w-5 h-5 sm:w-6 sm:h-6 rounded-md sm:rounded-lg flex items-center justify-center text-[10px] sm:text-xs",style:{backgroundColor:"rgba(20, 184, 166, 0.15)"},children:j((o=i.topCategory)==null?void 0:o.name)}),e.jsx("span",{className:"text-[9px] sm:text-[10px] uppercase tracking-wider font-medium",style:{color:"var(--text-secondary)"},children:"Top"})]}),e.jsx("p",{className:"text-xs sm:text-sm font-bold truncate",style:{color:"var(--accent-primary)"},children:((k=(N=i.topCategory)==null?void 0:N.name)==null?void 0:k.replace(/^[\p{Emoji}\u200d]+\s*/u,"").trim())||"-"}),e.jsx("p",{className:"text-[10px] sm:text-[11px] mt-0.5 truncate",style:{color:"var(--text-secondary)"},children:i.topCategory?M(r==="ARS"?i.topCategory.amount:i.topCategory.amountDolares,r):"-"})]})]})})]})}function Ae({accounts:p=[],categories:b={ingresos:[],gastos:[]},filters:r,onFilterChange:h}){var n,d,v,C,D,E;const[i,j]=u.useState(!1);[...b.ingresos||[],...b.gastos||[]];const x=(l,c)=>{const t=r[l]||[];let m;t.includes(c)?m=t.filter(w=>w!==c):m=[...t,c],h==null||h({...r,[l]:m})},o=(l,c)=>(r[l]||[]).includes(c),N=[((n=r.tipos)==null?void 0:n.length)>0&&((d=r.tipos)==null?void 0:d.length)<3,((v=r.cuentas)==null?void 0:v.length)>0,((C=r.categorias)==null?void 0:C.length)>0].filter(Boolean).length,k=()=>{h==null||h({tipos:[],cuentas:[],categorias:[]})};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>j(!i),className:"flex items-center gap-2 px-3.5 py-2.5 rounded-xl text-sm transition-all duration-200 hover:bg-[var(--bg-tertiary)] active:scale-[0.98]",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-secondary)"},children:[e.jsx("svg",{className:"w-4 h-4",style:{color:"var(--accent-primary)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.75,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})}),e.jsx("span",{className:"font-medium",children:"Filtros"}),N>0&&e.jsx("span",{className:"px-2 py-0.5 rounded-lg text-[10px] font-bold",style:{backgroundColor:"var(--accent-primary)",color:"white",boxShadow:"0 2px 8px var(--accent-primary-glow)"},children:N}),e.jsx("svg",{className:`w-4 h-4 transition-transform duration-300 ${i?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),i&&e.jsxs("div",{className:"p-4 rounded-2xl space-y-4 animate-scale-in card-glass",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[11px] font-semibold uppercase tracking-wider mb-2.5",style:{color:"var(--text-secondary)"},children:"Tipo de movimiento"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[{value:"ingreso",label:"Ingresos",color:"var(--accent-green)",glow:"rgba(0, 217, 154, 0.3)"},{value:"gasto",label:"Gastos",color:"var(--accent-red)",glow:"rgba(255, 92, 114, 0.3)"},{value:"transferencia",label:"Transferencias",color:"var(--accent-blue)",glow:"rgba(59, 130, 246, 0.3)"}].map(l=>{const c=o("tipos",l.value);return e.jsx("button",{onClick:()=>x("tipos",l.value),className:"px-3.5 py-2 rounded-xl text-xs font-semibold transition-all duration-200 active:scale-95",style:{backgroundColor:c?l.color:"var(--bg-secondary)",color:c?"white":"var(--text-secondary)",boxShadow:c?`0 4px 16px ${l.glow}`:"none"},children:l.label},l.value)})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2.5",children:[e.jsx("label",{className:"text-[11px] font-semibold uppercase tracking-wider",style:{color:"var(--text-secondary)"},children:"Cuentas"}),e.jsx("button",{onClick:()=>{const l=p.map(t=>t.nombre),c=l.every(t=>{var m;return(m=r.cuentas)==null?void 0:m.includes(t)});h==null||h({...r,cuentas:c?[]:l})},className:"text-[10px] font-semibold transition-colors hover:opacity-80",style:{color:"var(--accent-primary)"},children:p.length>0&&p.every(l=>{var c;return(c=r.cuentas)==null?void 0:c.includes(l.nombre)})?"Deseleccionar todos":"Seleccionar todos"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 max-h-28 overflow-y-auto custom-scrollbar",children:p.map(l=>{const c=o("cuentas",l.nombre);return e.jsx("button",{onClick:()=>x("cuentas",l.nombre),className:"px-3.5 py-2 rounded-xl text-xs font-semibold transition-all duration-200 active:scale-95",style:{backgroundColor:c?"var(--accent-primary)":"var(--bg-secondary)",color:c?"white":"var(--text-secondary)",boxShadow:c?"0 4px 16px var(--accent-primary-glow)":"none"},children:l.nombre},l.nombre)})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2.5",children:[e.jsx("label",{className:"text-[11px] font-semibold uppercase tracking-wider",style:{color:"var(--text-secondary)"},children:"CategorÃ­as"}),(()=>{const l=[...(b.ingresos||[]).map(t=>typeof t=="string"?t:t.value),...(b.gastos||[]).map(t=>typeof t=="string"?t:t.value)],c=l.length>0&&l.every(t=>{var m;return(m=r.categorias)==null?void 0:m.includes(t)});return e.jsx("button",{onClick:()=>{h==null||h({...r,categorias:c?[]:l})},className:"text-[10px] font-semibold transition-colors hover:opacity-80",style:{color:"var(--accent-primary)"},children:c?"Deseleccionar todos":"Seleccionar todos"})})()]}),e.jsxs("div",{className:"flex flex-wrap gap-2 max-h-36 overflow-y-auto custom-scrollbar",children:[((D=b.ingresos)==null?void 0:D.length)>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-full text-[10px] font-semibold uppercase tracking-wider",style:{color:"var(--accent-green)"},children:"Ingresos:"}),b.ingresos.map(l=>{const c=typeof l=="string"?l:l.value,t=typeof l=="string"?l:l.label,m=o("categorias",c);return e.jsx("button",{onClick:()=>x("categorias",c),className:"px-3.5 py-2 rounded-xl text-xs font-semibold transition-all duration-200 active:scale-95",style:{backgroundColor:m?"var(--accent-green)":"var(--bg-secondary)",color:m?"white":"var(--text-secondary)",boxShadow:m?"0 4px 16px rgba(0, 217, 154, 0.3)":"none"},children:t},c)})]}),((E=b.gastos)==null?void 0:E.length)>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-full text-[10px] font-semibold uppercase tracking-wider mt-2",style:{color:"var(--accent-red)"},children:"Gastos:"}),b.gastos.map(l=>{const c=typeof l=="string"?l:l.value,t=typeof l=="string"?l:l.label,m=o("categorias",c);return e.jsx("button",{onClick:()=>x("categorias",c),className:"px-3.5 py-2 rounded-xl text-xs font-semibold transition-all duration-200 active:scale-95",style:{backgroundColor:m?"var(--accent-red)":"var(--bg-secondary)",color:m?"white":"var(--text-secondary)",boxShadow:m?"0 4px 16px rgba(255, 92, 114, 0.3)":"none"},children:t},c)})]})]})]}),N>0&&e.jsx("div",{className:"pt-3",style:{borderTop:"1px solid var(--border-subtle)"},children:e.jsxs("button",{onClick:k,className:"text-xs font-semibold flex items-center gap-1.5 transition-all duration-200 hover:opacity-80 active:scale-95",style:{color:"var(--accent-primary)"},children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),"Limpiar filtros"]})})]})]})}function Le({movements:p,dateRange:b,onDateRangeChange:r,filters:h,onFilterChange:i,accounts:j,categories:x,onMovementClick:o,onMovementDelete:N,loading:k=!1,currency:n="ARS"}){const[d,v]=u.useState(null),C=t=>{switch(t){case"ingreso":return{color:"var(--accent-green)",bgColor:"rgba(0, 217, 154, 0.12)",glowColor:"rgba(0, 217, 154, 0.3)",prefix:"+",icon:"up"};case"gasto":return{color:"var(--accent-red)",bgColor:"rgba(255, 92, 114, 0.12)",glowColor:"rgba(255, 92, 114, 0.3)",prefix:"-",icon:"down"};case"transferencia":return{color:"var(--accent-blue)",bgColor:"rgba(59, 130, 246, 0.12)",glowColor:"rgba(59, 130, 246, 0.3)",prefix:"",icon:"transfer"};default:return{color:"var(--accent-blue)",bgColor:"rgba(59, 130, 246, 0.12)",glowColor:"rgba(59, 130, 246, 0.3)",prefix:"",icon:"down"}}},D=(t,m)=>{t.stopPropagation(),v(m)},E=()=>{d&&(N==null||N(d),v(null))},l=(t,m)=>{const w="w-4 h-4 sm:w-5 sm:h-5";return t==="transferencia"?e.jsx("svg",{className:w,style:{color:m},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}):t==="ingreso"?e.jsx("svg",{className:w,style:{color:m},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 10l7-7m0 0l7 7m-7-7v18"})}):e.jsx("svg",{className:w,style:{color:m},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 14l-7 7m0 0l-7-7m7 7V3"})})},c=()=>e.jsx("div",{className:"card-glass overflow-hidden",children:[1,2,3].map(t=>e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 px-3 py-2.5 sm:p-4",style:{borderBottom:t<3?"1px solid var(--border-subtle)":"none"},children:[e.jsx("div",{className:"w-9 h-9 sm:w-11 sm:h-11 rounded-lg sm:rounded-xl skeleton-shimmer",style:{backgroundColor:"var(--bg-tertiary)"}}),e.jsxs("div",{className:"flex-1 space-y-2 sm:space-y-2.5",children:[e.jsx("div",{className:"h-3.5 sm:h-4 w-20 sm:w-28 skeleton-shimmer rounded-lg",style:{backgroundColor:"var(--bg-tertiary)"}}),e.jsx("div",{className:"h-2.5 sm:h-3 w-24 sm:w-36 skeleton-shimmer rounded-lg",style:{backgroundColor:"var(--bg-tertiary)"}})]}),e.jsxs("div",{className:"text-right space-y-2 sm:space-y-2.5",children:[e.jsx("div",{className:"h-4 sm:h-5 w-16 sm:w-24 skeleton-shimmer rounded-lg ml-auto",style:{backgroundColor:"var(--bg-tertiary)"}}),e.jsx("div",{className:"h-2.5 sm:h-3 w-12 sm:w-16 skeleton-shimmer rounded-lg ml-auto",style:{backgroundColor:"var(--bg-tertiary)"}})]})]},t))});return e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 sm:gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx("div",{className:"w-7 h-7 sm:w-8 sm:h-8 rounded-md sm:rounded-lg flex items-center justify-center",style:{backgroundColor:"var(--accent-primary-dim)"},children:e.jsx("svg",{className:"w-3.5 h-3.5 sm:w-4 sm:h-4",style:{color:"var(--accent-primary)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),e.jsx("h3",{className:"text-sm sm:text-[15px] font-semibold",style:{color:"var(--text-primary)"},children:"Movimientos"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(oe,{value:b,onChange:r,defaultPreset:"Esta semana"}),(b.from||b.to)&&e.jsx("button",{onClick:()=>r({from:null,to:null}),className:"p-1.5 rounded-lg transition-colors hover:opacity-80",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-muted)"},title:"Limpiar fechas",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),e.jsx(Ae,{accounts:j,categories:x,filters:h,onFilterChange:i}),k?c():!p||p.length===0?e.jsxs("div",{className:"card-glass p-6 sm:p-8 text-center",children:[e.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 mx-auto mb-3 sm:mb-4 rounded-xl sm:rounded-2xl flex items-center justify-center",style:{backgroundColor:"var(--bg-tertiary)"},children:e.jsx("svg",{className:"w-6 h-6 sm:w-8 sm:h-8",style:{color:"var(--text-secondary)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),e.jsx("p",{className:"font-semibold text-sm sm:text-base mb-0.5 sm:mb-1",style:{color:"var(--text-primary)"},children:"Sin movimientos"}),e.jsx("p",{className:"text-xs sm:text-sm",style:{color:"var(--text-secondary)"},children:"No hay movimientos en este periodo"})]}):e.jsx("div",{className:"card-glass overflow-hidden",children:p.map((t,m)=>{const w=C(t.tipo);return e.jsxs("div",{className:`group flex items-center gap-2 sm:gap-3 px-3 py-2.5 sm:p-4 transition-all duration-200 hover:bg-[var(--bg-tertiary)] active:scale-[0.995] ${m!==p.length-1?"border-b":""}`,style:{borderColor:"var(--border-subtle)"},children:[e.jsxs("button",{onClick:()=>o==null?void 0:o(t),className:"flex items-center gap-2 sm:gap-3 flex-1 min-w-0 text-left transition-transform duration-200",style:{backgroundColor:"transparent"},children:[e.jsx("div",{className:"w-9 h-9 sm:w-11 sm:h-11 rounded-lg sm:rounded-xl flex items-center justify-center flex-shrink-0 transition-all duration-200 group-hover:scale-110",style:{backgroundColor:w.bgColor,boxShadow:`0 0 0 ${w.glowColor}`},onMouseEnter:A=>A.currentTarget.style.boxShadow=`0 0 20px ${w.glowColor}`,onMouseLeave:A=>A.currentTarget.style.boxShadow=`0 0 0 ${w.glowColor}`,children:l(t.tipo,w.color)}),e.jsxs("div",{className:"flex-1 min-w-0 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx("p",{className:"font-semibold truncate text-sm sm:text-[15px]",style:{color:"var(--text-primary)"},children:t.tipo==="transferencia"?"Transferencia":t.categoria||""}),t.cuota&&e.jsx("span",{className:"px-1.5 sm:px-2 py-0.5 rounded-md sm:rounded-lg text-[9px] sm:text-[10px] font-semibold flex-shrink-0",style:{backgroundColor:"rgba(20, 184, 166, 0.12)",color:"var(--accent-primary)"},children:t.cuota})]}),e.jsx("p",{className:"text-[11px] sm:text-xs truncate mt-0.5",style:{color:"var(--text-secondary)"},children:t.tipo==="transferencia"?`${t.cuentaSaliente} â†’ ${t.cuentaEntrante}`:t.cuenta})]}),e.jsxs("div",{className:"text-right flex-shrink-0 pl-1",children:[e.jsx("p",{className:"font-bold text-sm sm:text-lg",style:{color:w.color},children:t.tipo==="transferencia"?M(n==="ARS"?t.montoSaliente:t.montoSalienteDolares||0,n):`${w.prefix}${M(n==="ARS"?t.montoPesos||t.monto:t.montoDolares||0,n)}`}),e.jsx("p",{className:"text-[10px] sm:text-[11px] mt-0.5",style:{color:"var(--text-secondary)"},children:pe(t.fecha,"short")})]})]}),e.jsx("button",{onClick:A=>D(A,t),className:"p-2 sm:p-2.5 rounded-lg sm:rounded-xl flex-shrink-0 transition-all duration-200 hover:bg-red-500/15 active:scale-95",style:{color:"var(--text-muted)"},title:"Eliminar",children:e.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5 transition-colors hover:text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.75,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]},t.rowIndex||m)})}),p&&p.length>0&&e.jsxs("p",{className:"text-[10px] sm:text-[11px] text-center font-medium",style:{color:"var(--text-secondary)"},children:["Mostrando ",p.length," movimiento",p.length!==1?"s":""]}),d&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-md animate-fade-in",onClick:()=>v(null)}),e.jsx("div",{className:"relative w-full max-w-sm rounded-2xl p-6 animate-scale-in card-elevated",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-2xl flex items-center justify-center",style:{backgroundColor:"rgba(255, 92, 114, 0.12)",boxShadow:"0 0 30px rgba(255, 92, 114, 0.2)"},children:e.jsx("svg",{className:"w-8 h-8",style:{color:"var(--accent-red)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.75,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),e.jsx("h3",{className:"text-lg font-bold font-display mb-2",style:{color:"var(--text-primary)"},children:"Eliminar movimiento"}),e.jsxs("p",{className:"text-sm mb-5",style:{color:"var(--text-secondary)"},children:["Â¿EstÃ¡s seguro de que quieres eliminar ",d.tipo==="transferencia"?"esta":"este"," ",d.tipo,"?",e.jsx("br",{}),e.jsx("span",{className:"font-bold text-base mt-1 inline-block",style:{color:C(d.tipo).color},children:d.tipo==="transferencia"?M(d.montoSaliente):M(d.montoPesos||d.monto)})," - ",d.tipo==="transferencia"?`${d.cuentaSaliente} â†’ ${d.cuentaEntrante}`:d.categoria]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>v(null),className:"flex-1 py-3.5 rounded-xl font-semibold transition-all duration-200 hover:bg-[var(--bg-tertiary)] active:scale-[0.98]",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-primary)"},children:"Cancelar"}),e.jsx("button",{onClick:E,className:"flex-1 py-3.5 rounded-xl font-semibold text-white transition-all duration-200 hover:opacity-90 active:scale-[0.98]",style:{backgroundColor:"var(--accent-red)",boxShadow:"0 4px 20px rgba(255, 92, 114, 0.3)"},children:"Eliminar"})]})]})})]})]})}function Ie(){const p=re(),{showError:b}=he(),[r,h]=u.useState("ARS"),[i,j]=u.useState({from:ve(new Date),to:ge(new Date)}),[x,o]=u.useState(()=>{try{const s=localStorage.getItem("cashe_home_balance_accounts");if(s)return JSON.parse(s)}catch(s){console.warn("Error loading balance account filters:",s)}return[]});u.useEffect(()=>{try{localStorage.setItem("cashe_home_balance_accounts",JSON.stringify(x))}catch(s){console.warn("Error saving balance account filters:",s)}},[x]);const[N,k]=u.useState(!1),[n,d]=u.useState(()=>{try{const s=localStorage.getItem("cashe_home_movement_dates");if(s){const a=JSON.parse(s);return{from:a.from?new Date(a.from):H(new Date,{weekStartsOn:1}),to:a.to?new Date(a.to):U(new Date,{weekStartsOn:1})}}}catch(s){console.warn("Error loading saved date range:",s)}return{from:H(new Date,{weekStartsOn:1}),to:U(new Date,{weekStartsOn:1})}});u.useEffect(()=>{var s,a;try{localStorage.setItem("cashe_home_movement_dates",JSON.stringify({from:((s=n.from)==null?void 0:s.toISOString())||null,to:((a=n.to)==null?void 0:a.toISOString())||null}))}catch(S){console.warn("Error saving date range:",S)}},[n]);const[v,C]=u.useState(()=>{try{const s=localStorage.getItem("cashe_home_filters");if(s){const a=JSON.parse(s);return{tipos:a.tipos||[],cuentas:a.cuentas||[],categorias:a.categorias||[]}}}catch(s){console.warn("Error loading saved filters:",s)}return{tipos:[],cuentas:[],categorias:[]}});u.useEffect(()=>{try{localStorage.setItem("cashe_home_filters",JSON.stringify(v))}catch(s){console.warn("Error saving filters:",s)}},[v]);const[D,E]=u.useState(null),[l,c]=u.useState([]),[t,m]=u.useState([]),[w,A]=u.useState([]),[W,J]=u.useState({ingresos:[],gastos:[]}),[O,y]=u.useState(!0),[f,_]=u.useState(!0),[le,q]=u.useState(!0),[F,ne]=u.useState(!0),[X,K]=u.useState(null),[Q,$]=u.useState(null),[ce,Y]=u.useState(!1);u.useEffect(()=>{async function s(){try{const[a,S]=await Promise.all([je(),we()]);A(a.accounts||[]),J(S.categorias||{ingresos:[],gastos:[]})}catch(a){console.error("Error fetching initial data:",a)}finally{ne(!1)}}s()},[]);const P=u.useCallback(async()=>{try{y(!0);const s=await ye({fromDate:i.from?B(i.from,"yyyy-MM-dd"):null,toDate:i.to?B(i.to,"yyyy-MM-dd"):null});E(s.dashboard),K(null)}catch(s){K(s.message),console.error("Error fetching dashboard:",s)}finally{y(!1)}},[i]);u.useEffect(()=>{P()},[P]);const I=u.useCallback(async()=>{try{_(!0);const s=await te({fromDate:n.from?B(n.from,"yyyy-MM-dd"):null,toDate:n.to?B(n.to,"yyyy-MM-dd"):null,tipos:v.tipos,cuentas:v.cuentas,categorias:v.categorias});c(s.movements||[])}catch(s){console.error("Error fetching movements:",s)}finally{_(!1)}},[n,v]);u.useEffect(()=>{I()},[I]);const V=u.useCallback(async()=>{try{q(!0);const s=H(new Date,{weekStartsOn:1}),a=U(new Date,{weekStartsOn:1}),S=await te({fromDate:B(s,"yyyy-MM-dd"),toDate:B(a,"yyyy-MM-dd"),tipos:[],cuentas:[],categorias:[]});m(S.movements||[])}catch(s){console.error("Error fetching weekly movements:",s)}finally{q(!1)}},[]);u.useEffect(()=>{V()},[V]);const G=u.useCallback(async()=>{await Promise.all([P(),I(),V()])},[P,I,V]);fe(R.ALL_DATA_CHANGED,G);const ie=async s=>{try{Y(!0),await ke(s),$(null);const a=s.tipo==="ingreso"?R.INCOMES_CHANGED:s.tipo==="gasto"?R.EXPENSES_CHANGED:R.TRANSFERS_CHANGED;T(a),T(R.ACCOUNTS_CHANGED),await Promise.all([P(),I(),V()])}catch(a){console.error("Error updating movement:",a),b("No se pudo guardar el movimiento",a.message)}finally{Y(!1)}},Z=async s=>{$(null),c(a=>a.filter(S=>!(S.tipo===s.tipo&&S.rowIndex===s.rowIndex))),m(a=>a.filter(S=>!(S.tipo===s.tipo&&S.rowIndex===s.rowIndex)));try{await Ne(s);const a=s.tipo==="ingreso"?R.INCOMES_CHANGED:s.tipo==="gasto"?R.EXPENSES_CHANGED:R.TRANSFERS_CHANGED;T(a),T(R.ACCOUNTS_CHANGED),await Promise.all([P(),I(),V()])}catch(a){console.error("Error deleting movement:",a),b("No se pudo eliminar el movimiento",a.message),await Promise.all([I(),V()])}},de=s=>{$(null),p("/nuevo",{state:{prefill:s}})},L=x.length>0?w.filter(s=>x.includes(s.nombre)):w,me={totalPesos:L.filter(s=>s.moneda==="Peso").reduce((s,a)=>s+(a.balanceActual||0),0),totalDolares:L.filter(s=>s.moneda==="DÃ³lar").reduce((s,a)=>s+(a.balanceActual||0),0),totalGeneralPesos:L.filter(s=>s.moneda==="Peso").reduce((s,a)=>s+(a.balanceActual||0),0)+L.filter(s=>s.moneda==="DÃ³lar").reduce((s,a)=>s+(a.balanceActual||0),0)*((D==null?void 0:D.tipoCambio)||1e3),totalGeneralDolares:L.filter(s=>s.moneda==="DÃ³lar").reduce((s,a)=>s+(a.balanceActual||0),0)+L.filter(s=>s.moneda==="Peso").reduce((s,a)=>s+(a.balanceActual||0),0)/((D==null?void 0:D.tipoCambio)||1e3),ingresosMes:L.reduce((s,a)=>s+(a.totalIngresos||0),0),gastosMes:L.reduce((s,a)=>s+(a.totalGastos||0),0)},g=x.length>0?{...D,...me}:D;return F&&O?e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsx(ae,{size:"lg"})}):X&&!D?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[60vh] gap-4",children:[e.jsxs("p",{style:{color:"var(--accent-red)"},children:["Error: ",X]}),e.jsx("button",{onClick:P,className:"px-4 py-2 rounded-lg font-medium",style:{backgroundColor:"var(--accent-primary)",color:"white"},children:"Reintentar"})]}):e.jsx(Ce,{onRefresh:G,disabled:O&&f,children:e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-2 sm:gap-3",children:[e.jsx("h1",{className:"text-base sm:text-lg font-medium",style:{color:"var(--text-primary)"},children:"Dashboard"}),e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsxs("div",{className:"inline-flex p-0.5 sm:p-1 rounded-md sm:rounded-lg",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsxs("button",{onClick:()=>h("ARS"),className:"px-2 sm:px-3 py-1 sm:py-1.5 rounded-md text-[11px] sm:text-xs font-medium transition-colors duration-150 flex items-center gap-1 sm:gap-1.5",style:{backgroundColor:r==="ARS"?"var(--bg-elevated)":"transparent",color:r==="ARS"?"var(--text-primary)":"var(--text-muted)"},children:[e.jsx("img",{src:"/icons/catalog/ARS.svg",alt:"ARS",className:"w-3.5 h-3.5 sm:w-4 sm:h-4 rounded-sm"}),"ARS"]}),e.jsxs("button",{onClick:()=>h("USD"),className:"px-2 sm:px-3 py-1 sm:py-1.5 rounded-md text-[11px] sm:text-xs font-medium transition-colors duration-150 flex items-center gap-1 sm:gap-1.5",style:{backgroundColor:r==="USD"?"var(--bg-elevated)":"transparent",color:r==="USD"?"var(--text-primary)":"var(--text-muted)"},children:[e.jsx("img",{src:"/icons/catalog/USD.svg",alt:"USD",className:"w-3.5 h-3.5 sm:w-4 sm:h-4 rounded-sm"}),"USD"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(oe,{value:i,onChange:j,defaultPreset:"Este mes"}),(i.from||i.to)&&e.jsx("button",{onClick:()=>j({from:null,to:null}),className:"p-1.5 rounded-lg transition-colors hover:opacity-80",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-muted)"},title:"Limpiar fechas",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]})]}),O?e.jsx("div",{className:"rounded-xl p-12 flex items-center justify-center",style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-subtle)"},children:e.jsx(ae,{})}):e.jsxs("div",{className:"space-y-3",children:[e.jsx(De,{totalPesos:g==null?void 0:g.totalPesos,totalDolares:g==null?void 0:g.totalDolares,totalGeneralPesos:g==null?void 0:g.totalGeneralPesos,totalGeneralDolares:g==null?void 0:g.totalGeneralDolares,tipoCambio:g==null?void 0:g.tipoCambio,currency:r,ingresosMes:g==null?void 0:g.ingresosMes,gastosMes:g==null?void 0:g.gastosMes,ingresosMesDolares:g==null?void 0:g.ingresosMesDolares,gastosMesDolares:g==null?void 0:g.gastosMesDolares}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>k(!N),className:"flex items-center gap-2 px-3.5 py-2.5 rounded-xl text-sm transition-all duration-200 hover:bg-[var(--bg-tertiary)] active:scale-[0.98]",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-secondary)"},children:[e.jsx("svg",{className:"w-4 h-4",style:{color:"var(--accent-primary)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.75,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})}),e.jsx("span",{className:"font-medium",children:"Filtrar cuentas"}),x.length>0&&e.jsx("span",{className:"px-2 py-0.5 rounded-lg text-[10px] font-bold",style:{backgroundColor:"var(--accent-primary)",color:"white",boxShadow:"0 2px 8px var(--accent-primary-glow)"},children:x.length}),e.jsx("svg",{className:`w-4 h-4 transition-transform duration-300 ${N?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),N&&e.jsxs("div",{className:"p-4 rounded-2xl space-y-3 animate-scale-in card-glass",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-[11px] font-semibold uppercase tracking-wider",style:{color:"var(--text-secondary)"},children:"Cuentas incluidas en el balance"}),e.jsx("button",{onClick:()=>{const s=w.map(S=>S.nombre),a=s.length>0&&s.every(S=>x.includes(S));o(a?[]:s)},className:"text-[10px] font-semibold transition-colors hover:opacity-80",style:{color:"var(--accent-primary)"},children:w.length>0&&w.every(s=>x.includes(s.nombre))?"Deseleccionar todos":"Seleccionar todos"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 max-h-32 overflow-y-auto custom-scrollbar",children:w.map(s=>{const a=x.length===0||x.includes(s.nombre);return e.jsx("button",{onClick:()=>{if(x.length===0)o([s.nombre]);else if(x.includes(s.nombre)){const S=x.filter(xe=>xe!==s.nombre);o(S.length===0?[]:S)}else o([...x,s.nombre])},className:"px-3.5 py-2 rounded-xl text-xs font-semibold transition-all duration-200 active:scale-95",style:{backgroundColor:a?"var(--accent-primary)":"var(--bg-secondary)",color:a?"white":"var(--text-secondary)",boxShadow:a?"0 4px 16px var(--accent-primary-glow)":"none",opacity:x.length===0?.7:1},children:s.nombre},s.nombre)})}),x.length>0&&e.jsx("div",{className:"pt-2",style:{borderTop:"1px solid var(--border-subtle)"},children:e.jsxs("button",{onClick:()=>o([]),className:"text-xs font-semibold flex items-center gap-1.5 transition-all duration-200 hover:opacity-80 active:scale-95",style:{color:"var(--accent-primary)"},children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),"Mostrar todas las cuentas"]})})]})]})]}),e.jsx(Me,{accounts:L,loading:F,onAccountClick:s=>{C(a=>({...a,cuentas:[s.nombre]}))}}),e.jsx(Ee,{movements:t,loading:le}),e.jsx(Le,{movements:l,dateRange:n,onDateRangeChange:d,filters:v,onFilterChange:C,accounts:w,categories:W,onMovementClick:$,onMovementDelete:Z,loading:f,currency:r}),Q&&e.jsx(be,{movement:Q,accounts:w,categories:W,onSave:ie,onDelete:Z,onDuplicate:de,onClose:()=>$(null),onConvertedToRecurring:G,loading:ce})]})})}export{Ie as default};
