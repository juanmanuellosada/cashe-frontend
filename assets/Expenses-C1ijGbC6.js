import{g as A,r as a,_ as C,n as B,o as N,j as n,E as U,$ as b,a0 as L,a1 as q,p as F,q as G}from"./index-CKWgcbuo.js";import{M as O}from"./MovementsList-BhyvU6zd.js";import"./DateRangePicker-581Jnx40.js";import"./SortDropdown-8-fXskt5.js";function $(){const{showError:u}=A(),[h,r]=a.useState([]),[g,E]=a.useState([]),[p,v]=a.useState({ingresos:[],gastos:[]}),[S,m]=a.useState(!0),[x,l]=a.useState(null),[y,w]=a.useState(!1),[D,f]=a.useState(!1);a.useEffect(()=>{o()},[]);const o=async()=>{try{m(!0);const[e,t,s]=await Promise.all([C(),B(),N()]);r(e.expenses||[]),E(t.accounts||[]),v(s.categorias||{ingresos:[],gastos:[]})}catch(e){console.error("Error fetching data:",e)}finally{m(!1)}},k=async e=>{try{w(!0),await G(e),l(null),await o()}catch(t){console.error("Error updating:",t),u("No se pudo guardar el gasto",t.message)}finally{w(!1)}},M=async e=>{l(null),r(t=>t.filter(s=>s.rowIndex!==e.rowIndex));try{await F(e)}catch(t){console.error("Error deleting:",t),u("No se pudo eliminar el gasto",t.message),o()}},I=async e=>{const t=new Set(e.map(s=>s.rowIndex));r(s=>s.filter(c=>!t.has(c.rowIndex))),await q(e),o()},j=async(e,t,s)=>{const c=new Set(e.map(i=>i.rowIndex));r(i=>i.map(d=>c.has(d.rowIndex)?{...d,[t]:s}:d)),await L(e,t,s),o()};return n.jsxs(n.Fragment,{children:[n.jsx(O,{title:"Gastos",movements:h,accounts:g,categories:p.gastos||[],loading:S,onMovementClick:l,onMovementDelete:M,onBulkDelete:I,onBulkUpdate:j,onAddClick:()=>f(!0),type:"gasto"}),x&&n.jsx(U,{movement:x,accounts:g,categories:p,onSave:k,onDelete:M,onClose:()=>l(null),loading:y}),n.jsx(b,{isOpen:D,onClose:()=>{f(!1),o()},defaultType:"expense"})]})}export{$ as default};
