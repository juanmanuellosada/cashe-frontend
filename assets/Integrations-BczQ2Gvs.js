import{ak as I,az as j,o as U,r as o,j as e,Q as O,aC as X,aD as ee,L as V,aE as re,aF as se}from"./index-BMb4UKgp.js";import{C as ae}from"./check-b92OW6_7.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],ne=I("bell",te);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],ie=I("calendar",oe);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],ce=I("clock",le);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],ue=I("credit-card",de),$="15551632329",T=async()=>{const{data:{user:s},error:r}=await j.auth.getUser();if(r)throw console.error("Error getting user:",r),new Error("Error getting authenticated user");if(!s)throw new Error("No authenticated user");return s.id},me=async()=>{const s=await T(),{data:r,error:a}=await j.from("profiles").select("whatsapp_enabled, email, full_name").eq("id",s).single();return a?(console.error("Error checking WhatsApp access:",a),{enabled:!1,email:null,name:null}):{enabled:(r==null?void 0:r.whatsapp_enabled)===!0,email:r==null?void 0:r.email,name:r==null?void 0:r.full_name}},xe=async()=>{const s=await T(),{data:r,error:a}=await j.from("whatsapp_users").select("*").eq("user_id",s).maybeSingle();if(a)throw console.error("Error getting WhatsApp status:",a),a;if(!r)return{status:"not_linked",phone:null,verificationCode:null,linkedAt:null};if(r.verified)return{status:"linked",phone:r.phone_number,verificationCode:null,linkedAt:r.updated_at};const t=r.verification_expires_at&&new Date(r.verification_expires_at)<new Date;return{status:t?"code_expired":"pending_verification",phone:null,verificationCode:t?null:r.verification_code,expiresAt:r.verification_expires_at,linkedAt:null}},pe=async()=>{const s=await T(),r=Math.floor(1e5+Math.random()*9e5).toString(),a=new Date(Date.now()+600*1e3).toISOString(),{data:t,error:n}=await j.from("whatsapp_users").upsert({user_id:s,phone_number:`pending_${s}`,verification_code:r,verification_expires_at:a,verified:!1,updated_at:new Date().toISOString()},{onConflict:"user_id",ignoreDuplicates:!1}).select().single();if(n)throw console.error("Error generating verification code:",n),n;return{code:r,expiresAt:a,expiresIn:600}},he=async()=>{const s=await T(),{data:r,error:a}=await j.from("whatsapp_users").select("verified, phone_number, updated_at").eq("user_id",s).maybeSingle();return a?(console.error("Error checking verification:",a),{verified:!1,phone:null}):r?{verified:r.verified===!0,phone:r.verified?r.phone_number:null,linkedAt:r.verified?r.updated_at:null}:{verified:!1,phone:null}},fe=async()=>{const s=await T(),{error:r}=await j.from("whatsapp_users").delete().eq("user_id",s);if(r)throw console.error("Error unlinking WhatsApp:",r),r;return{success:!0}},ge=s=>{if(!s||s.startsWith("pending_"))return null;if(s.startsWith("+54")){const r=s.slice(3);if(r.length>=10){const a=r.slice(0,1)==="9"?r.slice(1,3):r.slice(0,2),t=r.slice(-8);return`+54 9 ${a} ${t.slice(0,4)}-${t.slice(4)}`}}return s},ve=async()=>{const s=await T(),{data:r}=await j.from("profiles").select("email, full_name").eq("id",s).single();if(!r)throw new Error("No se pudo obtener informaci√≥n del usuario");const{data:a,error:t}=await j.functions.invoke("send-access-request",{body:{userId:s,email:r.email,name:r.full_name}});if(t)throw console.error("Error requesting access:",t),t;return{success:!0}};function ye(){const{showError:s}=U(),[r,a]=o.useState("loading"),[t,n]=o.useState("not_linked"),[l,x]=o.useState({email:null,name:null}),[m,p]=o.useState(null),[h,N]=o.useState(null),[C,w]=o.useState(null),[c,y]=o.useState(null),[_,k]=o.useState(!1),[u,f]=o.useState(!1),[S,E]=o.useState(!1),[A,b]=o.useState(!1);o.useEffect(()=>{i()},[]),o.useEffect(()=>{if(t==="code_generated"){const d=setInterval(async()=>{const g=await he();g.verified&&(n("linked"),N(g.phone),w(g.linkedAt),p(null))},3e3);return()=>clearInterval(d)}},[t]),o.useEffect(()=>{if(!c||t!=="code_generated")return;const g=setInterval(()=>{new Date>new Date(c)&&(n("not_linked"),p(null),y(null))},1e3);return()=>clearInterval(g)},[c,t]);const i=async()=>{try{const d=await me();if(x({email:d.email,name:d.name}),!d.enabled){a("restricted");return}a("enabled");const g=await xe();g.status==="linked"?(n("linked"),N(g.phone),w(g.linkedAt)):g.status==="pending_verification"&&g.verificationCode?(n("code_generated"),p(g.verificationCode),y(g.expiresAt)):n("not_linked")}catch(d){console.error("Error checking status:",d),a("restricted")}},v=async()=>{k(!0);try{const d=await pe();p(d.code),y(d.expiresAt),n("code_generated")}catch(d){console.error("Error generating code:",d),s("Error al generar el c√≥digo. Por favor intent√° de nuevo.")}finally{k(!1)}},W=async()=>{k(!0);try{await fe(),n("not_linked"),N(null),w(null),f(!1)}catch(d){console.error("Error unlinking WhatsApp:",d),s("Error al desvincular WhatsApp. Por favor intent√° de nuevo.")}finally{k(!1)}},Q=async()=>{b(!0);try{await ve(),E(!0),a("requested")}catch(d){console.error("Error requesting access:",d),s("No se pudo enviar la solicitud. Por favor intent√° de nuevo.")}finally{b(!1)}},q=o.useCallback(()=>{if(!c)return null;const d=new Date(c).getTime()-Date.now();if(d<=0)return null;const g=Math.floor(d/6e4),Z=Math.floor(d%6e4/1e3);return`${g}:${Z.toString().padStart(2,"0")}`},[c]),[R,B]=o.useState(null);o.useEffect(()=>{if(t!=="code_generated"){B(null);return}const d=()=>B(q());d();const g=setInterval(d,1e3);return()=>clearInterval(g)},[t,q]);const F=()=>e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-8 h-8",children:e.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"})}),K=()=>e.jsxs("div",{className:"space-y-4 mb-4",children:[e.jsx("div",{className:"p-4 rounded-xl border",style:{backgroundColor:"rgba(37, 211, 102, 0.08)",borderColor:"rgba(37, 211, 102, 0.2)"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0",style:{backgroundColor:"rgba(37, 211, 102, 0.15)"},children:e.jsx("span",{className:"text-xl",children:"ü§ñ"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-1",style:{color:"#25D366"},children:"Con Inteligencia Artificial"}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:"Chate√° naturalmente como si hablaras con una persona. El bot entiende lenguaje natural en espa√±ol argentino."})]})]})}),e.jsxs("div",{className:"p-4 rounded-xl",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsx("h4",{className:"font-medium text-sm mb-3",style:{color:"var(--text-primary)"},children:"Ejemplos de lo que pod√©s decir:"}),e.jsxs("div",{className:"space-y-2 text-sm",style:{color:"var(--text-secondary)"},children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("span",{children:"üí¨"}),e.jsx("code",{className:"text-xs",style:{color:"#25D366"},children:'"Gast√© 500 en comida con galicia"'})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("span",{children:"üí¨"}),e.jsx("code",{className:"text-xs",style:{color:"#25D366"},children:'"Cobr√© 50000 de sueldo en santander"'})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("span",{children:"üí¨"}),e.jsx("code",{className:"text-xs",style:{color:"#25D366"},children:'"Transfer√≠ 10k de mp a brubank"'})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("span",{children:"üí¨"}),e.jsx("code",{className:"text-xs",style:{color:"#25D366"},children:'"Cu√°nto gast√© en comida este mes?"'})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("span",{children:"üí¨"}),e.jsx("code",{className:"text-xs",style:{color:"#25D366"},children:'"Saldo mercadopago"'})]})]})]}),e.jsxs("div",{className:"p-4 rounded-xl",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsx("h4",{className:"font-medium text-sm mb-3",style:{color:"var(--text-primary)"},children:"Funcionalidades"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",style:{color:"var(--text-secondary)"},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{style:{color:"#25D366"},children:"üí∏"}),e.jsx("span",{children:"Gastos"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{style:{color:"#25D366"},children:"üí∞"}),e.jsx("span",{children:"Ingresos"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{style:{color:"#25D366"},children:"üîÑ"}),e.jsx("span",{children:"Transferencias"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{style:{color:"#25D366"},children:"üìä"}),e.jsx("span",{children:"Saldos"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{style:{color:"#25D366"},children:"üìà"}),e.jsx("span",{children:"Resumen mensual"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{style:{color:"#25D366"},children:"üïê"}),e.jsx("span",{children:"√öltimos movimientos"})]})]}),e.jsx("p",{className:"text-xs mt-3",style:{color:"var(--text-muted)"},children:"Tambi√©n pod√©s usar los botones del men√∫ si prefer√≠s"})]})]});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"rounded-2xl p-6 border transition-all",style:{backgroundColor:"var(--bg-secondary)",borderColor:t==="linked"?"rgba(37, 211, 102, 0.3)":"var(--border-color)"},children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl flex items-center justify-center",style:{backgroundColor:t==="linked"?"rgba(37, 211, 102, 0.15)":"rgba(37, 211, 102, 0.1)",color:"#25D366"},children:e.jsx(F,{})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg",style:{color:"var(--text-primary)"},children:"Bot de WhatsApp"}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:t==="linked"?"Vinculado - Registr√° movimientos por mensaje":"Registr√° gastos e ingresos por mensaje"})]}),t==="linked"&&e.jsx("div",{className:"px-3 py-1 rounded-full text-sm font-medium",style:{backgroundColor:"rgba(37, 211, 102, 0.15)",color:"#25D366"},children:"Conectado"})]}),e.jsx(K,{}),r==="loading"&&e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"w-6 h-6 border-2 border-t-transparent rounded-full animate-spin",style:{borderColor:"var(--accent-primary)",borderTopColor:"transparent"}})}),r==="restricted"&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"p-4 rounded-xl mb-4 flex items-start gap-3",style:{backgroundColor:"rgba(251, 191, 36, 0.1)"},children:[e.jsx("span",{className:"text-xl",children:"üîí"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",style:{color:"var(--text-primary)"},children:"Acceso restringido"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--text-secondary)"},children:"El bot de WhatsApp est√° en fase beta. Solicit√° acceso para probarlo."})]})]}),e.jsx("button",{onClick:Q,disabled:A,className:"w-full py-3 px-4 rounded-xl font-medium transition-all flex items-center justify-center gap-2",style:{backgroundColor:"var(--accent-primary)",color:"white",opacity:A?.7:1},children:A?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Enviando solicitud..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Solicitar acceso"}),e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})]})})]}),r==="requested"&&e.jsx("div",{className:"mt-2",children:e.jsxs("div",{className:"p-4 rounded-xl flex items-start gap-3",style:{backgroundColor:"rgba(34, 197, 94, 0.1)"},children:[e.jsx("span",{className:"text-xl",children:"‚úÖ"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",style:{color:"var(--text-primary)"},children:"Solicitud enviada"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--text-secondary)"},children:"Te notificaremos cuando tu acceso est√© habilitado."})]})]})}),r==="enabled"&&t==="not_linked"&&e.jsx("div",{className:"mt-2",children:e.jsx("button",{onClick:v,disabled:_,className:"w-full py-3 px-4 rounded-xl font-medium transition-all flex items-center justify-center gap-2",style:{backgroundColor:"#25D366",color:"white",opacity:_?.7:1},children:_?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Generando c√≥digo..."})]}):e.jsx("span",{children:"Vincular WhatsApp"})})}),r==="enabled"&&t==="code_generated"&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm mb-3",style:{color:"var(--text-secondary)"},children:"Envi√° este c√≥digo al bot de WhatsApp de Cash√©:"}),e.jsx("div",{className:"flex justify-center gap-2 mb-4",children:m==null?void 0:m.split("").map((d,g)=>e.jsx("span",{className:"w-12 h-14 rounded-xl flex items-center justify-center text-2xl font-bold",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--accent-primary)"},children:d},g))}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm mb-4",style:{color:"var(--text-secondary)"},children:[e.jsx("div",{className:"w-4 h-4 border-2 border-t-transparent rounded-full animate-spin",style:{borderColor:"#25D366",borderTopColor:"transparent"}}),e.jsx("span",{children:"Esperando verificaci√≥n..."})]}),R&&e.jsxs("p",{className:"text-xs text-center mb-4",style:{color:"var(--text-muted)"},children:["El c√≥digo expira en ",R]}),e.jsxs("a",{href:`https://wa.me/${$}?text=${encodeURIComponent(m||"")}`,target:"_blank",rel:"noopener noreferrer",className:"w-full py-3 px-4 rounded-xl font-medium transition-all flex items-center justify-center gap-2 mb-3",style:{backgroundColor:"#25D366",color:"white"},children:[e.jsx(F,{}),e.jsx("span",{children:"Abrir WhatsApp"})]}),e.jsx("button",{onClick:()=>{n("not_linked"),p(null),y(null)},className:"w-full py-2 px-4 rounded-xl text-sm transition-all",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-secondary)"},children:"Cancelar"})]}),r==="enabled"&&t==="linked"&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"p-4 rounded-xl mb-4",style:{backgroundColor:"var(--bg-tertiary)"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:"N√∫mero vinculado"}),e.jsx("p",{className:"font-medium",style:{color:"var(--text-primary)"},children:ge(h)||h})]}),C&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:"Vinculado"}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:new Date(C).toLocaleDateString("es-AR",{day:"numeric",month:"short",year:"numeric"})})]})]})}),e.jsxs("a",{href:`https://wa.me/${$}`,target:"_blank",rel:"noopener noreferrer",className:"w-full py-3 px-4 rounded-xl font-medium transition-all flex items-center justify-center gap-2 mb-3",style:{backgroundColor:"#25D366",color:"white"},children:[e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-5 h-5",children:e.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"})}),e.jsx("span",{children:"Abrir chat con el bot"})]}),e.jsx("button",{onClick:()=>f(!0),className:"w-full py-2 px-4 rounded-xl text-sm transition-all",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-secondary)"},children:"Desvincular WhatsApp"})]})]}),e.jsx(O,{isOpen:u,onClose:()=>f(!1),onConfirm:W,title:"Desvincular WhatsApp",message:"¬øEst√°s seguro de que quer√©s desvincular tu WhatsApp? Ya no podr√°s registrar movimientos por mensaje.",confirmText:"Desvincular",variant:"warning",loading:_}),S&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:()=>E(!1)}),e.jsxs("div",{className:"relative w-full max-w-sm rounded-2xl p-6 text-center animate-scale-in",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center",style:{backgroundColor:"rgba(34, 197, 94, 0.15)"},children:e.jsx("svg",{className:"w-8 h-8",style:{color:"#22c55e"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",style:{color:"var(--text-primary)"},children:"Solicitud enviada"}),e.jsx("p",{className:"text-sm mb-6",style:{color:"var(--text-secondary)"},children:"Tu solicitud de acceso al bot de WhatsApp fue enviada correctamente. Te notificaremos cuando est√© habilitado."}),e.jsx("button",{onClick:()=>E(!1),className:"w-full py-3 px-4 rounded-xl font-medium transition-all",style:{backgroundColor:"var(--accent-primary)",color:"white"},children:"Entendido"})]})]})]})}const H="CasheAppBot",P=async()=>{const{data:{user:s},error:r}=await j.auth.getUser();if(r)throw console.error("Error getting user:",r),new Error("Error getting authenticated user");if(!s)throw new Error("No authenticated user");return s.id},be=async()=>{const s=await P(),{data:r,error:a}=await j.from("telegram_users").select("*").eq("user_id",s).maybeSingle();if(a)throw console.error("Error getting Telegram status:",a),a;if(!r)return{status:"not_linked",telegramId:null,telegramUsername:null,telegramFirstName:null,verificationCode:null,linkedAt:null};if(r.verified)return{status:"linked",telegramId:r.telegram_id,telegramUsername:r.telegram_username,telegramFirstName:r.telegram_first_name,verificationCode:null,linkedAt:r.updated_at};const t=r.verification_expires_at&&new Date(r.verification_expires_at)<new Date;return{status:t?"code_expired":"pending_verification",telegramId:null,telegramUsername:null,telegramFirstName:null,verificationCode:t?null:r.verification_code,expiresAt:r.verification_expires_at,linkedAt:null}},je=async()=>{const s=await P(),r=Math.floor(1e5+Math.random()*9e5).toString(),a=new Date(Date.now()+600*1e3).toISOString(),{data:t,error:n}=await j.from("telegram_users").upsert({user_id:s,telegram_id:null,verification_code:r,verification_expires_at:a,verified:!1,updated_at:new Date().toISOString()},{onConflict:"user_id",ignoreDuplicates:!1}).select().single();if(n)throw console.error("Error generating verification code:",n),n;return{code:r,expiresAt:a,expiresIn:600}},Ne=async()=>{const s=await P(),{data:r,error:a}=await j.from("telegram_users").select("verified, telegram_id, telegram_username, telegram_first_name, updated_at").eq("user_id",s).maybeSingle();return a?(console.error("Error checking verification:",a),{verified:!1,telegramUsername:null}):r?{verified:r.verified===!0,telegramId:r.verified?r.telegram_id:null,telegramUsername:r.verified?r.telegram_username:null,telegramFirstName:r.verified?r.telegram_first_name:null,linkedAt:r.verified?r.updated_at:null}:{verified:!1,telegramUsername:null}},we=async()=>{const s=await P(),{error:r}=await j.from("telegram_users").delete().eq("user_id",s);if(r)throw console.error("Error unlinking Telegram:",r),r;return{success:!0}},ke=s=>s?s.startsWith("@")?s:`@${s}`:null;function Ce(){const{showError:s}=U(),[r,a]=o.useState("loading"),[t,n]=o.useState(null),[l,x]=o.useState({telegramId:null,telegramUsername:null,telegramFirstName:null}),[m,p]=o.useState(null),[h,N]=o.useState(null),[C,w]=o.useState(!1),[c,y]=o.useState(!1);o.useEffect(()=>{_()},[]),o.useEffect(()=>{if(r==="code_generated"){const i=setInterval(async()=>{const v=await Ne();v.verified&&(a("linked"),x({telegramId:v.telegramId,telegramUsername:v.telegramUsername,telegramFirstName:v.telegramFirstName}),p(v.linkedAt),n(null))},3e3);return()=>clearInterval(i)}},[r]),o.useEffect(()=>{if(!h||r!=="code_generated")return;const v=setInterval(()=>{new Date>new Date(h)&&(a("not_linked"),n(null),N(null))},1e3);return()=>clearInterval(v)},[h,r]);const _=async()=>{try{const i=await be();i.status==="linked"?(a("linked"),x({telegramId:i.telegramId,telegramUsername:i.telegramUsername,telegramFirstName:i.telegramFirstName}),p(i.linkedAt)):i.status==="pending_verification"&&i.verificationCode?(a("code_generated"),n(i.verificationCode),N(i.expiresAt)):a("not_linked")}catch(i){console.error("Error checking status:",i),a("not_linked")}},k=async()=>{w(!0);try{const i=await je();n(i.code),N(i.expiresAt),a("code_generated")}catch(i){console.error("Error generating code:",i),s("Error al generar el c√≥digo. Por favor intent√° de nuevo.")}finally{w(!1)}},u=async()=>{w(!0);try{await we(),a("not_linked"),x({telegramId:null,telegramUsername:null,telegramFirstName:null}),p(null),y(!1)}catch(i){console.error("Error unlinking Telegram:",i),s("Error al desvincular Telegram. Por favor intent√° de nuevo.")}finally{w(!1)}},f=o.useCallback(()=>{if(!h)return null;const i=new Date(h).getTime()-Date.now();if(i<=0)return null;const v=Math.floor(i/6e4),W=Math.floor(i%6e4/1e3);return`${v}:${W.toString().padStart(2,"0")}`},[h]),[S,E]=o.useState(null);o.useEffect(()=>{if(r!=="code_generated"){E(null);return}const i=()=>E(f());i();const v=setInterval(i,1e3);return()=>clearInterval(v)},[r,f]);const A=()=>e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-8 h-8",children:e.jsx("path",{d:"M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"})}),b=()=>e.jsxs("div",{className:"space-y-4 mb-4",children:[e.jsx("div",{className:"p-4 rounded-xl border",style:{backgroundColor:"rgba(0, 136, 204, 0.08)",borderColor:"rgba(0, 136, 204, 0.2)"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0",style:{backgroundColor:"rgba(0, 136, 204, 0.15)"},children:e.jsx("span",{className:"text-xl",children:"ü§ñ"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-1",style:{color:"#0088cc"},children:"Con Inteligencia Artificial"}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:"Chate√° naturalmente como si hablaras con una persona. El bot entiende lenguaje natural en espa√±ol argentino."})]})]})}),e.jsxs("div",{className:"p-4 rounded-xl",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsx("h4",{className:"font-medium text-sm mb-3",style:{color:"var(--text-primary)"},children:"Ejemplos de lo que pod√©s decir:"}),e.jsxs("div",{className:"space-y-2 text-sm",style:{color:"var(--text-secondary)"},children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("span",{children:"üí¨"}),e.jsx("code",{className:"text-xs",style:{color:"#0088cc"},children:'"Gast√© 500 en comida con galicia"'})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("span",{children:"üí¨"}),e.jsx("code",{className:"text-xs",style:{color:"#0088cc"},children:'"Cobr√© 50000 de sueldo en santander"'})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("span",{children:"üí¨"}),e.jsx("code",{className:"text-xs",style:{color:"#0088cc"},children:'"Transfer√≠ 10k de mp a brubank"'})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("span",{children:"üí¨"}),e.jsx("code",{className:"text-xs",style:{color:"#0088cc"},children:'"Cu√°nto gast√© en comida este mes?"'})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("span",{children:"üí¨"}),e.jsx("code",{className:"text-xs",style:{color:"#0088cc"},children:'"Saldo mercadopago"'})]})]})]}),e.jsxs("div",{className:"p-4 rounded-xl",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsx("h4",{className:"font-medium text-sm mb-3",style:{color:"var(--text-primary)"},children:"Funcionalidades"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",style:{color:"var(--text-secondary)"},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{style:{color:"#0088cc"},children:"üí∏"}),e.jsx("span",{children:"Gastos"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{style:{color:"#0088cc"},children:"üí∞"}),e.jsx("span",{children:"Ingresos"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{style:{color:"#0088cc"},children:"üîÑ"}),e.jsx("span",{children:"Transferencias"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{style:{color:"#0088cc"},children:"üìä"}),e.jsx("span",{children:"Saldos"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{style:{color:"#0088cc"},children:"üìà"}),e.jsx("span",{children:"Resumen mensual"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{style:{color:"#0088cc"},children:"üïê"}),e.jsx("span",{children:"√öltimos movimientos"})]})]}),e.jsx("p",{className:"text-xs mt-3",style:{color:"var(--text-muted)"},children:"Tambi√©n pod√©s usar los botones del men√∫ si prefer√≠s"})]})]});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"rounded-2xl p-6 border transition-all",style:{backgroundColor:"var(--bg-secondary)",borderColor:r==="linked"?"rgba(0, 136, 204, 0.3)":"var(--border-color)"},children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl flex items-center justify-center",style:{backgroundColor:r==="linked"?"rgba(0, 136, 204, 0.15)":"rgba(0, 136, 204, 0.1)",color:"#0088cc"},children:e.jsx(A,{})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg",style:{color:"var(--text-primary)"},children:"Bot de Telegram"}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:r==="linked"?"Vinculado - Registr√° movimientos por mensaje":"Registr√° gastos e ingresos por mensaje"})]}),r==="linked"&&e.jsx("div",{className:"px-3 py-1 rounded-full text-sm font-medium",style:{backgroundColor:"rgba(0, 136, 204, 0.15)",color:"#0088cc"},children:"Conectado"})]}),e.jsx(b,{}),r==="loading"&&e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"w-6 h-6 border-2 border-t-transparent rounded-full animate-spin",style:{borderColor:"var(--accent-primary)",borderTopColor:"transparent"}})}),r==="not_linked"&&e.jsx("div",{className:"mt-2",children:e.jsx("button",{onClick:k,disabled:C,className:"w-full py-3 px-4 rounded-xl font-medium transition-all flex items-center justify-center gap-2",style:{backgroundColor:"#0088cc",color:"white",opacity:C?.7:1},children:C?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Generando c√≥digo..."})]}):e.jsx("span",{children:"Vincular Telegram"})})}),r==="code_generated"&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm mb-3 text-center",style:{color:"var(--text-secondary)"},children:"Copi√° el comando y pegalo en el chat del bot"}),e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-xl mb-4",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsxs("code",{className:"text-lg font-mono font-semibold",style:{color:"#0088cc"},children:["/start ",t]}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(`/start ${t}`);const i=document.getElementById("copy-btn-telegram");i&&(i.textContent="¬°Copiado!",setTimeout(()=>{i.textContent="Copiar"},2e3))},id:"copy-btn-telegram",className:"px-3 py-1.5 rounded-lg text-sm font-medium transition-all",style:{backgroundColor:"#0088cc",color:"white"},children:"Copiar"})]}),e.jsxs("a",{href:`https://t.me/${H}`,target:"_blank",rel:"noopener noreferrer",className:"w-full py-3 px-4 rounded-xl font-medium transition-all flex items-center justify-center gap-2 mb-4",style:{backgroundColor:"#0088cc",color:"white"},children:[e.jsx(A,{}),e.jsx("span",{children:"Abrir chat en Telegram"})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm mb-3",style:{color:"var(--text-secondary)"},children:[e.jsx("div",{className:"w-4 h-4 border-2 border-t-transparent rounded-full animate-spin",style:{borderColor:"#0088cc",borderTopColor:"transparent"}}),e.jsx("span",{children:"Esperando vinculaci√≥n..."})]}),S&&e.jsxs("p",{className:"text-xs text-center mb-4",style:{color:"var(--text-muted)"},children:["El c√≥digo expira en ",S]}),e.jsx("button",{onClick:()=>{a("not_linked"),n(null),N(null)},className:"w-full py-2 px-4 rounded-xl text-sm transition-all",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-secondary)"},children:"Cancelar"})]}),r==="linked"&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"p-4 rounded-xl mb-4",style:{backgroundColor:"var(--bg-tertiary)"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:"Cuenta vinculada"}),e.jsxs("p",{className:"font-medium",style:{color:"var(--text-primary)"},children:[l.telegramFirstName||"Usuario",l.telegramUsername&&e.jsxs("span",{style:{color:"var(--text-secondary)"},children:[" ","(",ke(l.telegramUsername),")"]})]})]}),m&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:"Vinculado"}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:new Date(m).toLocaleDateString("es-AR",{day:"numeric",month:"short",year:"numeric"})})]})]})}),e.jsxs("a",{href:`https://t.me/${H}`,target:"_blank",rel:"noopener noreferrer",className:"w-full py-3 px-4 rounded-xl font-medium transition-all flex items-center justify-center gap-2 mb-3",style:{backgroundColor:"#0088cc",color:"white"},children:[e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-5 h-5",children:e.jsx("path",{d:"M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"})}),e.jsx("span",{children:"Abrir chat con el bot"})]}),e.jsx("button",{onClick:()=>y(!0),className:"w-full py-2 px-4 rounded-xl text-sm transition-all",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-secondary)"},children:"Desvincular Telegram"})]})]}),e.jsx(O,{isOpen:c,onClose:()=>y(!1),onConfirm:u,title:"Desvincular Telegram",message:"¬øEst√°s seguro de que quer√©s desvincular tu Telegram? Ya no podr√°s registrar movimientos por mensaje.",confirmText:"Desvincular",variant:"warning",loading:C})]})}const M=()=>"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window,Y=()=>"Notification"in window?Notification.permission:"unsupported",_e=async()=>{if(!("Notification"in window))throw new Error("Notifications not supported");return await Notification.requestPermission()},D=(s,r,a)=>Promise.race([s,new Promise((t,n)=>setTimeout(()=>n(new Error(a)),r))]),z=()=>window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1",Se=async s=>{if(!M())throw new Error("Push notifications not supported");if((await navigator.serviceWorker.getRegistrations()).length===0)throw z()?new Error("Las notificaciones push no funcionan en modo desarrollo. Prob√° con el build de producci√≥n (npm run build && npm run preview)."):new Error("Service Worker no est√° registrado. Recarg√° la p√°gina e intent√° de nuevo.");if(await D(_e(),3e4,"El navegador no respondi√≥ a la solicitud de permisos")!=="granted")throw new Error("Permiso de notificaciones denegado");let t;try{t=await D(navigator.serviceWorker.ready,1e4,"Service Worker no est√° disponible"),await new Promise(l=>setTimeout(l,500))}catch(l){throw console.error("SW registration error:",l),z()?new Error("Las notificaciones push solo funcionan en producci√≥n"):new Error("No se pudo conectar con el Service Worker. Recarg√° la p√°gina.")}let n;try{n=await D(t.pushManager.getSubscription(),5e3,"No se pudo verificar la suscripci√≥n existente")}catch(l){console.warn("Error checking existing subscription:",l),n=null}if(!n){const l=De(s);try{n=await D(t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:l}),15e3,"El navegador no pudo completar la suscripci√≥n. Esto puede ocurrir en navegadores con bloqueo de rastreadores activo (como Brave). Prob√° desactivar Shields o us√° Chrome/Firefox.")}catch(x){throw console.error("Push subscription error:",x),x.message.includes("push service")||x.message.includes("Registration failed")?navigator.brave&&navigator.brave.isBrave||navigator.userAgent.includes("Brave")?new Error('Brave bloquea las push notifications por privacidad. And√° a brave://settings/privacy y activ√° "Use Google services for push messaging", o us√° Chrome/Firefox.'):new Error("Tu navegador bloque√≥ las notificaciones push. Verific√° la configuraci√≥n de privacidad del navegador."):x}}try{await D(Ae(n),1e4,"No se pudo guardar la suscripci√≥n en el servidor")}catch(l){console.error("Error saving subscription:",l);try{await n.unsubscribe()}catch{}throw l}return n},Ee=async()=>{if(!M())return;const r=await(await navigator.serviceWorker.ready).pushManager.getSubscription();r&&(await Te(r.endpoint),await r.unsubscribe())},Ae=async s=>{const{data:{user:r}}=await j.auth.getUser();if(!r)throw new Error("Not authenticated");const a=s.toJSON(),{error:t}=await j.from("push_subscriptions").upsert({user_id:r.id,endpoint:a.endpoint,p256dh:a.keys.p256dh,auth:a.keys.auth},{onConflict:"user_id,endpoint"});if(t)throw t},Te=async s=>{const{data:{user:r}}=await j.auth.getUser();r&&await j.from("push_subscriptions").delete().eq("user_id",r.id).eq("endpoint",s)},J=async()=>{if(!M())return{supported:!1,subscribed:!1};const s=Y();if(s==="denied")return{supported:!0,subscribed:!1,permission:"denied"};try{return(await navigator.serviceWorker.getRegistrations()).length===0?{supported:!0,subscribed:!1,permission:s,noSW:!0}:{supported:!0,subscribed:!!await(await Promise.race([navigator.serviceWorker.ready,new Promise((n,l)=>setTimeout(()=>l(new Error("SW timeout")),1e4))])).pushManager.getSubscription(),permission:s}}catch(r){return console.warn("Service worker not ready:",r),{supported:!0,subscribed:!1,permission:s}}};function De(s){const r="=".repeat((4-s.length%4)%4),a=(s+r).replace(/-/g,"+").replace(/_/g,"/"),t=window.atob(a),n=new Uint8Array(t.length);for(let l=0;l<t.length;++l)n[l]=t.charCodeAt(l);return n}const G=async(s,r={})=>{if(Y()!=="granted")throw new Error("Notification permission not granted");await(await navigator.serviceWorker.ready).showNotification(s,{icon:"/icons/icon-192.png",badge:"/icons/icon-96.png",...r})},Ie="BGAtLxt4YDMsBi4kHWTDoGusF-x1-qGY3YF6TqYzr_JOMbcVUJ2sh9cjOMHty3v6_B5F5QabzpMmFqPDjSGQRCU";function Pe(){const[s,r]=o.useState({supported:!1,subscribed:!1,permission:"default",loading:!0}),[a,t]=o.useState(null),[n,l]=o.useState(!1);o.useEffect(()=>{x()},[]);const x=async()=>{try{const c=await J();r({...c,loading:!1})}catch(c){console.error("Error checking push status:",c),r(y=>({...y,loading:!1}))}},m=async()=>{l(!0),t(null);try{await Se(Ie),await x(),await G("Notificaciones activadas",{body:"Recibir√°s alertas de transacciones programadas",tag:"subscription-success"})}catch(c){console.error("Error subscribing:",c),t(c.message||"No se pudieron activar las notificaciones")}finally{l(!1)}},p=async()=>{l(!0),t(null);try{await Ee(),await x()}catch(c){console.error("Error unsubscribing:",c),t(c.message||"No se pudieron desactivar las notificaciones")}finally{l(!1)}},h=async()=>{try{await G("Notificaci√≥n de prueba",{body:"Las notificaciones funcionan correctamente",tag:"test-notification"})}catch{t("No se pudo enviar la notificaci√≥n de prueba")}},N=/iPad|iPhone|iPod/.test(navigator.userAgent),C=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0,w=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1";return!s.supported&&!s.loading?e.jsx("div",{className:"rounded-2xl p-6",style:{backgroundColor:"var(--bg-secondary)"},children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl flex items-center justify-center flex-shrink-0",style:{backgroundColor:"var(--bg-tertiary)"},children:e.jsx("svg",{className:"w-8 h-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{color:"var(--text-muted)"},children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold",style:{color:"var(--text-primary)"},children:"Notificaciones Push"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--text-muted)"},children:N&&!C?"Para activar notificaciones en iOS, instal√° la app: Compartir ‚Üí Agregar a pantalla de inicio":"Tu navegador no soporta notificaciones push"})]})]})}):s.permission==="denied"?e.jsx("div",{className:"rounded-2xl p-6",style:{backgroundColor:"var(--bg-secondary)"},children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl flex items-center justify-center flex-shrink-0",style:{backgroundColor:"var(--accent-red-dim)"},children:e.jsx("svg",{className:"w-8 h-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{color:"var(--accent-red)"},children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold",style:{color:"var(--text-primary)"},children:"Notificaciones Push"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--text-secondary)"},children:"Las notificaciones est√°n bloqueadas. Para activarlas, debes cambiar los permisos en la configuraci√≥n de tu navegador."})]})]})}):e.jsx("div",{className:"rounded-2xl p-6",style:{backgroundColor:"var(--bg-secondary)"},children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl flex items-center justify-center flex-shrink-0",style:{backgroundColor:s.subscribed?"var(--accent-green-dim)":"var(--accent-primary-dim)"},children:e.jsx("svg",{className:"w-8 h-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{color:s.subscribed?"var(--accent-green)":"var(--accent-primary)"},children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold",style:{color:"var(--text-primary)"},children:"Notificaciones Push"}),s.subscribed&&e.jsx("span",{className:"px-2 py-1 rounded-lg text-xs font-medium",style:{backgroundColor:"var(--accent-green-dim)",color:"var(--accent-green)"},children:"Activadas"})]}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--text-secondary)"},children:s.subscribed?"Recibir√°s notificaciones cuando tengas transacciones programadas pendientes de aprobaci√≥n.":"Activa las notificaciones para recibir alertas de transacciones programadas."}),a&&e.jsx("p",{className:"text-sm mt-2",style:{color:"var(--accent-red)"},children:a}),e.jsx("div",{className:"flex gap-2 mt-4",children:s.subscribed?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:h,className:"px-4 py-2 rounded-xl text-sm font-medium transition-colors",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-secondary)"},children:"Probar"}),e.jsx("button",{onClick:p,disabled:n,className:"px-4 py-2 rounded-xl text-sm font-medium transition-colors disabled:opacity-50",style:{backgroundColor:"var(--accent-red-dim)",color:"var(--accent-red)"},children:n?"Desactivando...":"Desactivar"})]}):e.jsx("button",{onClick:m,disabled:n||s.loading,className:"px-4 py-2 rounded-xl text-sm font-medium transition-colors disabled:opacity-50",style:{backgroundColor:"var(--accent-primary)",color:"white"},children:n?"Activando...":"Activar notificaciones"})}),!s.subscribed&&e.jsx("p",{className:"text-xs mt-3",style:{color:"var(--text-muted)"},children:w?'Nota: Las notificaciones push solo funcionan en producci√≥n. Us√° "npm run build && npm run preview" para probar.':"Se te pedir√° permiso para enviar notificaciones. Puedes desactivarlas en cualquier momento."})]})]})})}function We(){const[s,r]=o.useState({notifyPush:!0,notifyTelegram:!1,notifyWhatsapp:!1,notificationHour:9}),[a,t]=o.useState(!0),[n,l]=o.useState(!1),[x,m]=o.useState(null),[p,h]=o.useState(!1),[N,C]=o.useState({push:!1,telegram:!1,whatsapp:!1});o.useEffect(()=>{w(),c()},[]);const w=async()=>{try{t(!0);const u=await X();r(u)}catch(u){console.error("Error loading notification preferences:",u),m("No se pudieron cargar las preferencias")}finally{t(!1)}},c=async()=>{try{const u=await J();C(f=>({...f,push:u.subscribed}))}catch(u){console.error("Error checking linked services:",u)}},y=async u=>{const f=!s[u],S={...s,[u]:f};r(S),await k(S)},_=async u=>{const f={...s,notificationHour:u};r(f),await k(f)},k=async u=>{try{l(!0),m(null),h(!1),await ee(u),h(!0),setTimeout(()=>h(!1),2e3)}catch(f){console.error("Error saving notification preferences:",f),m("No se pudieron guardar las preferencias"),await w()}finally{l(!1)}};return a?e.jsx("div",{className:"rounded-2xl p-6",style:{backgroundColor:"var(--bg-secondary)"},children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl flex items-center justify-center flex-shrink-0 animate-pulse",style:{backgroundColor:"var(--bg-tertiary)"}}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 rounded animate-pulse",style:{backgroundColor:"var(--bg-tertiary)",width:"60%"}}),e.jsx("div",{className:"h-3 rounded animate-pulse",style:{backgroundColor:"var(--bg-tertiary)",width:"80%"}})]})]})}):e.jsx("div",{className:"rounded-2xl p-6",style:{backgroundColor:"var(--bg-secondary)"},children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl flex items-center justify-center flex-shrink-0",style:{backgroundColor:"var(--accent-yellow-dim)"},children:e.jsx("span",{className:"text-2xl",children:"üí≥"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold",style:{color:"var(--text-primary)"},children:"Vencimiento de Tarjetas"}),p&&e.jsx("span",{className:"px-2 py-1 rounded-lg text-xs font-medium",style:{backgroundColor:"var(--accent-green-dim)",color:"var(--accent-green)"},children:"Guardado"})]}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--text-secondary)"},children:"Recib√≠ un recordatorio un d√≠a antes del vencimiento de tus tarjetas de cr√©dito con el monto a pagar."}),x&&e.jsx("p",{className:"text-sm mt-2",style:{color:"var(--accent-red)"},children:x}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx(L,{label:"Notificaciones Push",description:"En el navegador o app instalada",enabled:s.notifyPush,onToggle:()=>y("notifyPush"),disabled:n}),e.jsx(L,{label:"Telegram",description:"Requiere vincular tu cuenta",enabled:s.notifyTelegram,onToggle:()=>y("notifyTelegram"),disabled:n}),e.jsx(L,{label:"WhatsApp",description:"Requiere vincular tu cuenta",enabled:s.notifyWhatsapp,onToggle:()=>y("notifyWhatsapp"),disabled:n})]}),e.jsx("div",{className:"mt-4 pt-4 border-t",style:{borderColor:"var(--border-subtle)"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:"Hora de notificaci√≥n"}),e.jsx("p",{className:"text-xs mt-0.5",style:{color:"var(--text-muted)"},children:"Hora Argentina (UTC-3)"})]}),e.jsx("select",{value:s.notificationHour,onChange:u=>_(parseInt(u.target.value)),disabled:n,className:"px-3 py-2 rounded-lg text-sm font-medium border-none cursor-pointer",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-primary)"},children:Array.from({length:24},(u,f)=>e.jsxs("option",{value:f,children:[f.toString().padStart(2,"0"),":00"]},f))})]})}),e.jsx("p",{className:"text-xs mt-4",style:{color:"var(--text-muted)"},children:"Las notificaciones se env√≠an un d√≠a antes del vencimiento. Asegurate de configurar el d√≠a de vencimiento en cada tarjeta de cr√©dito."})]})]})})}function L({label:s,description:r,enabled:a,onToggle:t,disabled:n}){return e.jsxs("button",{onClick:t,disabled:n,className:"w-full flex items-center justify-between p-2 rounded-lg transition-colors hover:bg-[var(--bg-tertiary)] disabled:opacity-50",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:s}),r&&e.jsx("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:r})]}),e.jsx("div",{className:"w-11 h-6 rounded-full transition-all duration-200 relative flex-shrink-0",style:{backgroundColor:a?"var(--accent-primary)":"var(--bg-tertiary)"},children:e.jsx("div",{className:`absolute top-1 w-4 h-4 rounded-full bg-white shadow transition-all duration-200 ${a?"left-6":"left-1"}`})})]})}function Le({settings:s,onUpdate:r,loading:a}){const[t,n]=o.useState((s==null?void 0:s.card_reminder_enabled)??!0),[l,x]=o.useState((s==null?void 0:s.card_reminder_whatsapp)??!0),[m,p]=o.useState((s==null?void 0:s.card_reminder_telegram)??!0),[h,N]=o.useState((s==null?void 0:s.card_reminder_day)??10),[C,w]=o.useState((s==null?void 0:s.card_reminder_hour)??9),[c,y]=o.useState(!1),[_,k]=o.useState(!1);o.useEffect(()=>{n((s==null?void 0:s.card_reminder_enabled)??!0),x((s==null?void 0:s.card_reminder_whatsapp)??!0),p((s==null?void 0:s.card_reminder_telegram)??!0),N((s==null?void 0:s.card_reminder_day)??10),w((s==null?void 0:s.card_reminder_hour)??9)},[s]);const u=(b,i)=>{b==="enabled"?n(i):b==="whatsapp"?x(i):b==="telegram"&&p(i),k(!0)},f=b=>{const i=b.target.value;if(i===""){N(""),k(!0);return}const v=parseInt(i);!isNaN(v)&&v>=1&&v<=28&&(N(v),k(!0))},S=()=>{(h===""||h<1||h>28)&&N((s==null?void 0:s.card_reminder_day)??10)},E=b=>{const i=parseInt(b.target.value);i>=0&&i<=23&&(w(i),k(!0))},A=async()=>{y(!0);try{await r({card_reminder_enabled:t,card_reminder_whatsapp:l,card_reminder_telegram:m,card_reminder_day:h,card_reminder_hour:C}),k(!1)}finally{y(!1)}};return a?e.jsx("div",{className:"rounded-2xl p-6 flex items-center justify-center",style:{backgroundColor:"var(--bg-secondary)"},children:e.jsx(V,{size:"sm"})}):e.jsxs("div",{className:"rounded-2xl p-6 space-y-6",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ne,{className:"w-5 h-5",style:{color:"var(--accent-primary)"}}),e.jsx("h3",{className:"font-semibold",style:{color:"var(--text-primary)"},children:"Recordatorio de tarjetas"})]}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:"Te recordamos actualizar las fechas de cierre y vencimiento de tus tarjetas cada mes"})]}),e.jsx("button",{onClick:()=>u("enabled",!t),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${t?"bg-teal-500":"bg-gray-600"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${t?"translate-x-6":"translate-x-1"}`})})]}),t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-xl p-4 text-sm",style:{backgroundColor:"var(--bg-tertiary)",border:"1px solid var(--border-medium)"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ue,{className:"w-5 h-5 flex-shrink-0 mt-0.5",style:{color:"var(--accent-primary)"}}),e.jsx("div",{children:e.jsx("p",{style:{color:"var(--text-secondary)"},children:"Las fechas de cierre y vencimiento son necesarias para calcular correctamente tus res√∫menes de tarjeta. Cada mes, te enviaremos un recordatorio para que las actualices."})})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:[e.jsx(ie,{className:"w-4 h-4 inline mr-1"}),"D√≠a del mes"]}),e.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:h,onChange:f,onBlur:S,placeholder:"10",className:"w-full px-3 py-2 rounded-xl text-sm",style:{backgroundColor:"var(--bg-tertiary)",border:"1px solid var(--border-medium)",color:"var(--text-primary)"}}),e.jsx("p",{className:"text-xs mt-1",style:{color:"var(--text-tertiary)"},children:"Entre 1 y 28"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:[e.jsx(ce,{className:"w-4 h-4 inline mr-1"}),"Hora (Argentina)"]}),e.jsx("select",{value:C,onChange:E,className:"w-full px-3 py-2 rounded-xl text-sm",style:{backgroundColor:"var(--bg-tertiary)",border:"1px solid var(--border-medium)",color:"var(--text-primary)"},children:Array.from({length:24},(b,i)=>e.jsxs("option",{value:i,children:[String(i).padStart(2,"0"),":00"]},i))}),e.jsx("p",{className:"text-xs mt-1",style:{color:"var(--text-tertiary)"},children:"Zona horaria de Argentina"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-3",style:{color:"var(--text-primary)"},children:"Recibir recordatorio por:"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:b=>u("whatsapp",b.target.checked),className:"w-4 h-4 rounded accent-teal-500"}),e.jsx("span",{className:"text-sm",style:{color:"var(--text-primary)"},children:"WhatsApp"})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m,onChange:b=>u("telegram",b.target.checked),className:"w-4 h-4 rounded accent-teal-500"}),e.jsx("span",{className:"text-sm",style:{color:"var(--text-primary)"},children:"Telegram"})]})]}),e.jsx("p",{className:"text-xs mt-3",style:{color:"var(--text-tertiary)"},children:"Solo recibir√°s notificaciones en los canales que tengas vinculados"})]}),_&&e.jsx("button",{onClick:A,disabled:c,className:"w-full py-2.5 px-4 rounded-xl font-medium text-white transition-all flex items-center justify-center gap-2",style:{backgroundColor:c?"var(--text-tertiary)":"var(--accent-primary)",opacity:c?.6:1},children:c?e.jsx(V,{size:"xs",color:"white"}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"w-4 h-4"}),"Guardar cambios"]})})]})]})}function qe(){const{showError:s}=U(),[r,a]=o.useState(null),[t,n]=o.useState(!0);o.useEffect(()=>{l()},[]);const l=async()=>{try{n(!0);const m=await re();a(m)}catch(m){console.error("Error loading user settings:",m),s("Error al cargar configuraci√≥n",m.message)}finally{n(!1)}},x=async m=>{try{const p=await se(m);a(p)}catch(p){throw s("Error al guardar configuraci√≥n",p.message),p}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-medium",style:{color:"var(--text-primary)"},children:"Integraciones"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--text-secondary)"},children:"Conect√° servicios externos para gestionar tus finanzas"})]}),e.jsx("div",{className:"rounded-2xl p-5 border",style:{background:"linear-gradient(135deg, rgba(20, 184, 166, 0.1) 0%, rgba(59, 130, 246, 0.1) 100%)",borderColor:"rgba(20, 184, 166, 0.2)"},children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0",style:{backgroundColor:"rgba(20, 184, 166, 0.2)"},children:e.jsx("span",{className:"text-2xl",children:"ü§ñ"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-1",style:{color:"var(--text-primary)"},children:"Bots con Inteligencia Artificial"}),e.jsxs("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:["Nuestros bots de Telegram y WhatsApp entienden ",e.jsx("strong",{children:"lenguaje natural"}),". Escrib√≠ como si chatearas con un amigo: ",e.jsx("em",{children:'"gast√© 500 en el super con mp"'})," y el bot lo entiende autom√°ticamente."]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-3",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs",style:{backgroundColor:"rgba(20, 184, 166, 0.15)",color:"var(--accent-primary)"},children:[e.jsx("span",{children:"‚ú®"})," Espa√±ol argentino"]}),e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs",style:{backgroundColor:"rgba(20, 184, 166, 0.15)",color:"var(--accent-primary)"},children:[e.jsx("span",{children:"üéØ"})," Entiende aliases (mp, gal, bru)"]}),e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs",style:{backgroundColor:"rgba(20, 184, 166, 0.15)",color:"var(--accent-primary)"},children:[e.jsx("span",{children:"‚úÖ"})," Confirmaci√≥n antes de guardar"]})]})]})]})}),e.jsx(We,{}),e.jsx(Le,{settings:r,onUpdate:x,loading:t}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Pe,{}),e.jsx(Ce,{}),e.jsx(ye,{}),e.jsx("div",{className:"rounded-2xl p-6 border border-dashed",style:{backgroundColor:"var(--bg-secondary)",borderColor:"var(--border-color)",opacity:.6},children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl flex items-center justify-center",style:{backgroundColor:"var(--bg-tertiary)"},children:e.jsx("svg",{className:"w-8 h-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{color:"var(--text-muted)"},children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",style:{color:"var(--text-muted)"},children:"M√°s integraciones pr√≥ximamente"}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:"Importaci√≥n de extractos bancarios y m√°s"})]})]})})]})]})}export{qe as default};
