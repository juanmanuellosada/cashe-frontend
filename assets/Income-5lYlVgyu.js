import{o as k,r as o,a5 as G,y as H,z as _,x as T,j as d,E as U,a1 as j,a2 as B,B as r,a3 as b,A as R,D as n,C as P}from"./index-DCmWVZK1.js";import{M as z}from"./MovementsList-nahEf12s.js";import{P as L}from"./PullToRefresh-ZoNsUOoF.js";import"./DateRangePicker-Bg4NFZrW.js";import"./SortDropdown-niL67lQZ.js";function V(){const{showError:g}=k(),[N,i]=o.useState([]),[C,A]=o.useState([]),[E,x]=o.useState({ingresos:[],gastos:[]}),[f,D]=o.useState(!0),[S,u]=o.useState(null),[I,p]=o.useState(!1),[h,w]=o.useState(!1),a=o.useCallback(async(t=!1,e=!0)=>{try{e&&D(!0);const[s,l,c]=await Promise.all([G(t),H(),_()]);i(s.incomes||[]),A(l.accounts||[]),x(c.categorias||{ingresos:[],gastos:[]})}catch(s){console.error("Error fetching data:",s)}finally{e&&D(!1)}},[]);o.useEffect(()=>{a()},[a]),T(n.INCOMES_CHANGED,()=>a(!0,!1));const v=async t=>{try{p(!0),await P(t),u(null),r(n.INCOMES_CHANGED),r(n.ACCOUNTS_CHANGED),await a(!0,!1)}catch(e){console.error("Error updating:",e),g("No se pudo guardar el ingreso",e.message)}finally{p(!1)}},M=async t=>{u(null),i(e=>e.filter(s=>s.rowIndex!==t.rowIndex));try{await R(t),r(n.INCOMES_CHANGED),r(n.ACCOUNTS_CHANGED)}catch(e){console.error("Error deleting:",e),g("No se pudo eliminar el ingreso",e.message),a()}},y=async t=>{const e=new Set(t.map(s=>s.rowIndex));i(s=>s.filter(l=>!e.has(l.rowIndex))),await b(t),r(n.INCOMES_CHANGED),r(n.ACCOUNTS_CHANGED),await a()},O=async(t,e,s)=>{const l=new Set(t.map(c=>c.rowIndex));i(c=>c.map(m=>l.has(m.rowIndex)?{...m,[e]:s}:m)),await B(t,e,s),r(n.INCOMES_CHANGED),r(n.ACCOUNTS_CHANGED),await a()};return d.jsxs(L,{onRefresh:a,disabled:f,children:[d.jsx(z,{title:"Ingresos",movements:N,accounts:C,categories:E.ingresos||[],loading:f,onMovementClick:u,onMovementDelete:M,onBulkDelete:y,onBulkUpdate:O,onAddClick:()=>w(!0),type:"ingreso"}),S&&d.jsx(U,{movement:S,accounts:C,categories:E,onSave:v,onDelete:M,onClose:()=>u(null),onConvertedToRecurring:()=>a(!0,!1),loading:I}),d.jsx(j,{isOpen:h,onClose:()=>{w(!1),a()},defaultType:"income"})]})}export{V as default};
