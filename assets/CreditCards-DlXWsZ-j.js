import{r as c,j as e,ab as ye,ar as _e,aa as ht,n as pt,w as yt,x as gt,$ as ft,y as vt,as as jt,at as ke,au as bt,b as F,o as kt,L as Nt,i as Oe,a as Ge,f as S,ac as Ve,E as wt,a0 as Ct,e as le,K as St,A as z,D as M,av as Dt,I as Ye,aw as Xe,ax as Pt,ay as Mt,az as At,z as Lt,B as Et}from"./index-Bs2UX6zf.js";function Bt({isOpen:j,onClose:H,statement:ce,attachments:v,onSave:ge,onRemove:B,saving:_}){const[A,Z]=c.useState(null),[R,J]=c.useState(null),a=c.useRef(null),w=c.useRef(null),[f,O]=c.useState(0),[ee,W]=c.useState(!1),ie=c.useRef(0);c.useEffect(()=>{j&&(O(0),W(!1))},[j]);const K=r=>{r.target.closest("[data-drag-handle]")&&(ie.current=r.touches[0].clientY,W(!0))},m=r=>{if(!ee)return;const b=r.touches[0].clientY-ie.current;b>0&&O(b)},q=()=>{ee&&(f>100&&!_&&H(),O(0),W(!1))};if(!j||!ce)return null;const G=r=>b=>{var V;const N=(V=b.target.files)==null?void 0:V[0];if(N){if(N.size>5*1024*1024){alert("El archivo es demasiado grande. Maximo 5MB.");return}r(N)}},te=async()=>{!A&&!R||(await ge({statementFile:A,receiptFile:R}),Z(null),J(null),a.current&&(a.current.value=""),w.current&&(w.current.value=""))},C=async r=>{await B(r)},se=v==null?void 0:v.statementUrl,D=v==null?void 0:v.receiptUrl,re=A||R,T=Math.max(.6-f/300,0),U=f>100;return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-start sm:items-center justify-center overflow-y-auto sm:py-6",children:[e.jsx("div",{className:"absolute inset-0 backdrop-blur-sm transition-opacity",style:{backgroundColor:`rgba(0, 0, 0, ${T})`},onClick:H}),e.jsxs("div",{className:"relative w-full max-w-md sm:mx-4 mt-0 rounded-b-2xl sm:rounded-2xl p-4 sm:p-6 animate-slide-down max-h-[90vh] sm:max-h-[calc(100vh-48px)] overflow-y-auto",style:{backgroundColor:"var(--bg-secondary)",transform:`translateY(${f}px)`,transition:ee?"none":"transform 0.3s ease-out",opacity:U?.5:1},onTouchStart:K,onTouchMove:m,onTouchEnd:q,children:[e.jsx("div",{className:"sm:hidden flex justify-center -mt-2 mb-2","data-drag-handle":!0,children:e.jsx("div",{className:"w-10 h-1 rounded-full transition-colors",style:{backgroundColor:U?"var(--accent-red)":"var(--border-medium)"}})}),e.jsxs("div",{className:"flex items-center justify-between mb-3 sm:mb-5","data-drag-handle":!0,children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold",style:{color:"var(--text-primary)"},children:"Adjuntos del Resumen"}),e.jsx("p",{className:"text-xs sm:text-sm capitalize",style:{color:"var(--text-secondary)"},children:ce.monthName})]}),e.jsx("button",{onClick:H,className:"w-7 h-7 sm:w-8 sm:h-8 rounded-lg flex items-center justify-center transition-colors",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-secondary)"},children:e.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("input",{ref:a,type:"file",className:"hidden",onChange:G(Z)}),e.jsx("input",{ref:w,type:"file",className:"hidden",onChange:G(J)}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] sm:text-xs font-medium mb-1 flex items-center gap-1",style:{color:"var(--text-secondary)"},children:[e.jsx("svg",{className:"w-3 h-3",style:{color:"var(--accent-red)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Resumen"]}),se&&!A?e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-2 rounded-lg",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsx("button",{type:"button",onClick:()=>ye(v.statementUrl,v.statementName),className:"flex-1 text-[11px] font-medium truncate text-left hover:underline",style:{color:"var(--accent-primary)"},children:v.statementName}),e.jsx("button",{type:"button",onClick:()=>{var r;return(r=a.current)==null?void 0:r.click()},className:"w-6 h-6 rounded flex items-center justify-center transition-colors hover:bg-white/10",style:{color:"var(--text-muted)"},children:e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})})}),e.jsx("button",{type:"button",onClick:()=>C("statement"),disabled:_,className:"w-6 h-6 rounded flex items-center justify-center transition-colors hover:bg-red-500/20 disabled:opacity-50",style:{color:"var(--accent-red)"},children:e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}):A?e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-2 rounded-lg",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-[11px] font-medium truncate",style:{color:"var(--text-primary)"},children:A.name}),e.jsx("p",{className:"text-[10px]",style:{color:"var(--text-muted)"},children:_e(A.size)})]}),e.jsx("button",{type:"button",onClick:()=>{Z(null),a.current&&(a.current.value="")},className:"w-6 h-6 rounded flex items-center justify-center transition-colors hover:bg-red-500/20",style:{color:"var(--accent-red)"},children:e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}):e.jsxs("button",{type:"button",onClick:()=>{var r;return(r=a.current)==null?void 0:r.click()},className:"w-full flex items-center justify-center gap-1 px-2 py-2.5 rounded-lg border border-dashed transition-colors hover:border-[var(--accent-primary)]",style:{borderColor:"var(--border-subtle)",backgroundColor:"var(--bg-tertiary)",color:"var(--text-muted)"},children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{className:"text-[11px]",children:"PDF"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] sm:text-xs font-medium mb-1 flex items-center gap-1",style:{color:"var(--text-secondary)"},children:[e.jsx("svg",{className:"w-3 h-3",style:{color:"var(--accent-green)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Comprobante"]}),D&&!R?e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-2 rounded-lg",style:{backgroundColor:"var(--bg-tertiary)"},children:[ht(v.receiptName)?e.jsx("img",{src:v.receiptUrl,alt:"Receipt",className:"w-6 h-6 rounded object-cover flex-shrink-0"}):null,e.jsx("button",{type:"button",onClick:()=>ye(v.receiptUrl,v.receiptName),className:"flex-1 text-[11px] font-medium truncate text-left hover:underline",style:{color:"var(--accent-primary)"},children:v.receiptName}),e.jsx("button",{type:"button",onClick:()=>{var r;return(r=w.current)==null?void 0:r.click()},className:"w-6 h-6 rounded flex items-center justify-center transition-colors hover:bg-white/10",style:{color:"var(--text-muted)"},children:e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})})}),e.jsx("button",{type:"button",onClick:()=>C("receipt"),disabled:_,className:"w-6 h-6 rounded flex items-center justify-center transition-colors hover:bg-red-500/20 disabled:opacity-50",style:{color:"var(--accent-red)"},children:e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}):R?e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-2 rounded-lg",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-[11px] font-medium truncate",style:{color:"var(--text-primary)"},children:R.name}),e.jsx("p",{className:"text-[10px]",style:{color:"var(--text-muted)"},children:_e(R.size)})]}),e.jsx("button",{type:"button",onClick:()=>{J(null),w.current&&(w.current.value="")},className:"w-6 h-6 rounded flex items-center justify-center transition-colors hover:bg-red-500/20",style:{color:"var(--accent-red)"},children:e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}):e.jsxs("button",{type:"button",onClick:()=>{var r;return(r=w.current)==null?void 0:r.click()},className:"w-full flex items-center justify-center gap-1 px-2 py-2.5 rounded-lg border border-dashed transition-colors hover:border-[var(--accent-primary)]",style:{borderColor:"var(--border-subtle)",backgroundColor:"var(--bg-tertiary)",color:"var(--text-muted)"},children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{className:"text-[11px]",children:"Imagen"})]})]})]}),e.jsx("p",{className:"text-[10px] mb-2",style:{color:"var(--text-muted)"},children:"MÃ¡x. 5MB por archivo"}),e.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[e.jsx("button",{onClick:H,className:"flex-1 py-2.5 sm:py-3 rounded-xl text-sm font-medium transition-colors hover:opacity-80",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-primary)"},children:"Cerrar"}),re&&e.jsx("button",{onClick:te,disabled:_,className:"flex-1 py-2.5 sm:py-3 rounded-xl text-sm font-medium text-white transition-colors hover:opacity-90 disabled:opacity-50",style:{backgroundColor:"var(--accent-primary)"},children:_?"Guardando...":"Guardar"})]})]})]})}function Ut(){const{showError:j}=pt(),[H,ce]=c.useState([]),[v,ge]=c.useState([]),[B,_]=c.useState([]),[A,Z]=c.useState({ingresos:[],gastos:[]}),[R,J]=c.useState(!0),[a,w]=c.useState(null),[f,O]=c.useState("ARS"),[ee,W]=c.useState(!1),[ie,K]=c.useState(!1),[m,q]=c.useState(null),[G,te]=c.useState(""),[C,se]=c.useState(""),[D,re]=c.useState(""),[T,U]=c.useState(!1),[r,b]=c.useState(null),[N,V]=c.useState({}),[Je,Ne]=c.useState(!1),[Y,we]=c.useState(null),[Ke,de]=c.useState(!1),[P,me]=c.useState({}),[Ce,ue]=c.useState(null),[X,fe]=c.useState(!1),[$,Q]=c.useState(new Set),[ve,Se]=c.useState(!1),[qe,De]=c.useState(!1),[Qe,Pe]=c.useState(null),[je,Me]=c.useState(null);c.useEffect(()=>{I()},[]);const Ze=c.useCallback(()=>{I(!0,!1)},[]);yt([M.EXPENSES_CHANGED,M.ACCOUNTS_CHANGED,M.ALL_DATA_CHANGED],Ze);const I=async(t=!1,s=!0)=>{try{s&&J(!0);const[o,i,n]=await Promise.all([gt(),ft(t),vt()]),x=o.accounts||[],u=i.expenses||[],d=n.categorias||{ingresos:[],gastos:[]},l=x.filter(h=>h.esTarjetaCredito);if(ce(l),_(x),ge(u),Z(d),l.length>0)if(a){const h=l.find(y=>y.id===a.id||y.nombre===a.nombre);w(h||l[0])}else w(l[0])}catch(o){console.error("Error fetching data:",o)}finally{s&&J(!1)}};c.useEffect(()=>{a!=null&&a.id?(jt(a.id).then(V).catch(t=>console.error("Error loading statement attachments:",t)),ke(a.id).then(me).catch(t=>console.error("Error loading statement payments:",t))):(V({}),me({}))},[a==null?void 0:a.id]);const et=c.useMemo(()=>B.filter(t=>!t.esTarjetaCredito&&t.moneda==="Peso"),[B]),tt=c.useMemo(()=>B.filter(t=>!t.esTarjetaCredito&&t.moneda!=="Peso"),[B]),k=c.useMemo(()=>{if(!a)return[];const t=a.diaCierre||1,s=v.filter(d=>d.cuenta===a.nombre);if(s.length===0)return[];const o=s.map(d=>new Date(d.fecha));new Date(Math.min(...o)),new Date(Math.max(...o));const i=d=>{const l=new Date(d),h=l.getDate();let y=l.getFullYear(),p=l.getMonth();return h>=t&&(p+=1,p>11&&(p=0,y+=1)),`${y}-${String(p+1).padStart(2,"0")}`},n={};s.forEach(d=>{const l=i(d.fecha);n[l]||(n[l]=[]),n[l].push(d)});const x=[],u=new Date;return Object.entries(n).forEach(([d,l])=>{const[h,y]=d.split("-").map(Number),p=new Date(h,y-1,Math.min(t,new Date(h,y,0).getDate()));let g=0,he=0;const ae=[],ne=[];l.forEach(L=>{let E=L.montoDolares;typeof E=="string"?E=parseFloat(E.replace(/[^\d,.-]/g,"").replace(",","."))||0:E=parseFloat(E)||0;const be=parseFloat(L.montoPesos)||0,Fe=parseFloat(L.monto)||0,ze=E>0&&be===0,He={...L,isInstallment:!!L.cuota,monedaOriginal:ze?"USD":"ARS",montoPesosNum:be||Fe,montoDolaresNum:E};ze?(he+=E,ne.push(He)):(g+=be||Fe,ae.push(He))});const $e=[...ae,...ne].sort((L,E)=>new Date(L.fecha)-new Date(E.fecha)),pe=l.find(L=>L.categoria&&L.categoria.includes("Impuesto de sellos"));x.push({id:d,year:h,month:y-1,monthName:F(p,"MMMM yyyy",{locale:le}),closeDate:p,totalPesos:g,totalDolares:he,items:$e,itemsPesos:ae,itemsDolares:ne,itemCount:$e.length,hasTax:!!pe,taxAmount:pe&&(pe.montoPesos||pe.monto)||0,isPast:p<u,isCurrent:bt(p,u),isFuture:p>kt(u)})}),x.sort((d,l)=>d.closeDate-l.closeDate)},[a,v]);c.useEffect(()=>{if(je&&k.length>0){const t=k.find(s=>s.id===je);t&&b(t),Me(null)}},[je,k]),c.useEffect(()=>{if(r&&k.length>0){const t=k.find(s=>s.id===r.id);t&&JSON.stringify(t.items)!==JSON.stringify(r.items)&&b(t)}},[k]);const st=async()=>{if(!(!m||!G||!a))try{U(!0);const t=F(m.closeDate,"yyyy-MM-dd");await St({fecha:t,monto:parseFloat(G),cuenta:a.nombre,categoria:"â¬‡ï¸ Impuesto de sellos",nota:`Impuesto de sellos - Resumen ${m.monthName}`}),z(M.EXPENSES_CHANGED),z(M.ACCOUNTS_CHANGED),W(!1),te(""),q(null),await I()}catch(t){console.error("Error adding tax:",t),j("No se pudo agregar el impuesto de sellos",t.message)}finally{U(!1)}},rt=async()=>{var u,d;if(!m||!a)return;const t=m.totalPesos>0,s=m.totalDolares>0,o=P[`${m.id}_ARS`],i=P[`${m.id}_USD`],n=t&&!o,x=s&&!i;if(n&&x){if(!C||!D){j("Seleccionar cuentas","DebÃ©s seleccionar una cuenta para pesos y otra para dÃ³lares");return}}else if(n&&!C){j("Seleccionar cuenta","DebÃ©s seleccionar una cuenta para pagar");return}else if(x&&!D){j("Seleccionar cuenta","DebÃ©s seleccionar una cuenta para pagar");return}try{U(!0);const l=F(new Date,"yyyy-MM-dd"),h=C?B.find(g=>g.nombre===C):null,y=D?B.find(g=>g.nombre===D):null;if(n&&C){const g=await Ye({fecha:l,cuentaSaliente:C,cuentaEntrante:a.nombre,montoSaliente:m.totalPesos,montoEntrante:m.totalPesos,nota:`Pago resumen ${m.monthName} (Pesos)`});await Xe({accountId:a.id,statementPeriod:m.id,currency:"ARS",amount:m.totalPesos,paymentAccountId:h==null?void 0:h.id,transferId:((u=g==null?void 0:g.transfer)==null?void 0:u.id)||null})}if(x&&D){const g=await Ye({fecha:l,cuentaSaliente:D,cuentaEntrante:a.nombre,montoSaliente:m.totalDolares,montoEntrante:m.totalDolares,nota:`Pago resumen ${m.monthName} (DÃ³lares)`});await Xe({accountId:a.id,statementPeriod:m.id,currency:"USD",amount:m.totalDolares,paymentAccountId:y==null?void 0:y.id,transferId:((d=g==null?void 0:g.transfer)==null?void 0:d.id)||null})}z(M.TRANSFERS_CHANGED),z(M.ACCOUNTS_CHANGED);const p=await ke(a.id);me(p),K(!1),se(""),re(""),q(null),await I()}catch(l){console.error("Error paying statement:",l),j("No se pudo registrar el pago del resumen",l.message)}finally{U(!1)}},Ae=async(t,s)=>{if(!a)return;const o=`${t.id}_${s}`,i=P[o];if(i)try{U(!0),await Dt(i.id,i.transferId);const n=await ke(a.id);me(n),await I()}catch(n){console.error("Error canceling payment:",n),j("No se pudo anular el pago",n.message)}finally{U(!1)}},Le=t=>{q(t),te(""),W(!0)},xe=t=>{q(t),se(""),re(""),K(!0)},Ee=t=>{we(t),Ne(!0)},ot=async({statementFile:t,receiptFile:s})=>{if(!(!Y||!a))try{de(!0);const o=Y.id,i=N[o]||null,n=await At({accountId:a.id,period:o,statementFile:t,receiptFile:s,existing:i});V(x=>({...x,[o]:n}))}catch(o){console.error("Error saving statement attachments:",o),j("No se pudieron guardar los adjuntos",o.message)}finally{de(!1)}},at=async t=>{if(!(!Y||!a))try{de(!0);const s=Y.id;await Mt({accountId:a.id,period:s,field:t}),V(o=>{const i={...o};if(i[s]){const n={...i[s]};t==="statement"?(n.statementUrl=null,n.statementName=null):(n.receiptUrl=null,n.receiptName=null),!n.statementUrl&&!n.receiptUrl?delete i[s]:i[s]=n}return i})}catch(s){console.error("Error removing attachment:",s),j("No se pudo eliminar el adjunto",s.message)}finally{de(!1)}},nt=t=>{ue({id:t.id,fecha:t.fecha,monto:t.monto,cuenta:t.cuenta||(a==null?void 0:a.nombre),categoria:t.categoria,nota:t.nota,tipo:"gasto",accountId:t.accountId,categoryId:t.categoryId,cuota:t.cuota,idCompra:t.idCompra||t.installment_purchase_id})},lt=async t=>{try{await Et(t),z(M.EXPENSES_CHANGED),z(M.ACCOUNTS_CHANGED),ue(null),r&&b(s=>{if(!s)return s;const o=i=>i.map(n=>n.id===t.id?{...n,nota:t.nota,categoria:t.categoria,fecha:t.fecha,monto:t.monto}:n);return{...s,items:o(s.items||[]),itemsPesos:o(s.itemsPesos||[]),itemsDolares:o(s.itemsDolares||[])}}),I(!0,!1)}catch(s){console.error("Error updating movement:",s),j("No se pudo actualizar el movimiento",s.message)}},ct=async t=>{try{await Lt(t),z(M.EXPENSES_CHANGED),z(M.ACCOUNTS_CHANGED),ue(null),r&&b(s=>{if(!s)return s;const o=i=>i.filter(n=>n.id!==t.id);return{...s,items:o(s.items||[]),itemsPesos:o(s.itemsPesos||[]),itemsDolares:o(s.itemsDolares||[]),itemCount:(s.itemCount||1)-1}}),I(!0,!1)}catch(s){console.error("Error deleting movement:",s),j("No se pudo eliminar el movimiento",s.message)}},oe=()=>r?k.findIndex(t=>t.id===r.id):-1,it=()=>{const t=oe();t>0&&b(k[t-1])},dt=()=>{const t=oe();t<k.length-1&&b(k[t+1])},Be=()=>oe()>0,Re=()=>oe()<k.length-1,Ue=()=>{fe(!X),Q(new Set)},Ie=t=>{const s=new Set($);s.has(t)?s.delete(t):s.add(t),Q(s)},mt=t=>{const s=new Set(t.map(o=>o.id));Q(s)},ut=()=>r?(r.totalPesos>0&&r.totalDolares>0?f==="ARS"?r.itemsPesos:r.itemsDolares:r.items).filter(o=>$.has(o.id)):[],We=(t,s)=>{const o=t.year,i=t.month,n=Math.min(15,s-1),x=new Date(o,i,n);return F(x,"yyyy-MM-dd")},xt=()=>{if(!r||!a)return;const t=a.diaCierre||1,s=We(r,t);Pe({tipo:"gasto",cuenta:a.nombre,fecha:s}),De(!0)},Te=async t=>{if(!r||!a)return;const s=oe(),o=t==="prev"?s-1:s+1;if(o<0||o>=k.length){j("No se puede mover",`No hay resumen ${t==="prev"?"anterior":"siguiente"}`);return}const i=k[o],n=a.diaCierre||1,x=We(i,n);Se(!0);try{const u=ut();await Pt(u,"fecha",x),Q(new Set),fe(!1),Me(i.id),await I(!0,!1)}catch(u){console.error("Error moving to statement:",u),j("No se pudieron mover los movimientos",u.message)}finally{Se(!1)}};return R?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(Nt,{})}):H.length===0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold",style:{color:"var(--text-primary)"},children:"Tarjetas de CrÃ©dito"}),e.jsxs("div",{className:"rounded-2xl p-8 text-center",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-4 rounded-2xl flex items-center justify-center",style:{backgroundColor:"rgba(20, 184, 166, 0.15)"},children:e.jsx("svg",{className:"w-10 h-10",style:{color:"var(--accent-primary)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",style:{color:"var(--text-primary)"},children:"Sin tarjetas de crÃ©dito"}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-secondary)"},children:'Agrega una cuenta con tipo "Tarjeta de crÃ©dito" para ver los resÃºmenes'})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[e.jsx("h2",{className:"text-lg font-semibold",style:{color:"var(--text-primary)"},children:"Tarjetas de CrÃ©dito"}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"inline-flex rounded-xl p-1",style:{backgroundColor:"var(--bg-tertiary)"},children:[e.jsxs("button",{onClick:()=>O("ARS"),className:"px-3.5 py-1.5 rounded-lg text-xs font-semibold transition-all duration-300 active:scale-95 flex items-center gap-1.5",style:{backgroundColor:f==="ARS"?"var(--accent-primary)":"transparent",color:f==="ARS"?"white":"var(--text-secondary)",boxShadow:f==="ARS"?"0 4px 12px var(--accent-primary-glow)":"none"},children:[e.jsx("img",{src:"/icons/catalog/ARS.svg",alt:"ARS",className:"w-4 h-4 rounded-sm"}),"ARS"]}),e.jsxs("button",{onClick:()=>O("USD"),className:"px-3.5 py-1.5 rounded-lg text-xs font-semibold transition-all duration-300 active:scale-95 flex items-center gap-1.5",style:{backgroundColor:f==="USD"?"var(--accent-green)":"transparent",color:f==="USD"?"white":"var(--text-secondary)",boxShadow:f==="USD"?"0 4px 12px rgba(0, 217, 154, 0.3)":"none"},children:[e.jsx("img",{src:"/icons/catalog/USD.svg",alt:"USD",className:"w-4 h-4 rounded-sm"}),"USD"]})]})})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:H.map(t=>{const s=!!t.icon,o=s&&Oe(t.icon);return e.jsx("button",{onClick:()=>w(t),className:`px-4 py-3 rounded-xl text-sm font-medium whitespace-nowrap transition-all duration-200 ${(a==null?void 0:a.nombre)===t.nombre?"scale-[1.02]":"opacity-70"}`,style:{backgroundColor:(a==null?void 0:a.nombre)===t.nombre?"var(--accent-primary)":"var(--bg-secondary)",color:(a==null?void 0:a.nombre)===t.nombre?"white":"var(--text-primary)"},children:e.jsxs("div",{className:"flex items-center gap-2",children:[s?o?e.jsx("span",{className:"text-base",children:t.icon}):e.jsx("img",{src:Ge(t.icon),alt:t.nombre,className:"w-5 h-5 rounded object-cover"}):e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})}),t.nombre]})},t.nombre)})}),a&&e.jsx("div",{className:"rounded-2xl p-4",style:{backgroundColor:"var(--bg-secondary)"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide mb-1",style:{color:"var(--text-secondary)"},children:"DÃ­a de cierre"}),e.jsx("p",{className:"text-xl font-bold",style:{color:"var(--accent-primary)"},children:a.diaCierre||"No configurado"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide mb-1",style:{color:"var(--text-secondary)"},children:"Balance actual"}),e.jsx("p",{className:"text-xl font-bold",style:{color:"var(--accent-red)"},children:S(Math.abs(a.balanceActual||0),a.moneda==="Peso"?"ARS":"USD")})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-semibold",style:{color:"var(--text-primary)"},children:"ResÃºmenes"}),k.length===0?e.jsxs("div",{className:"text-center py-8",style:{color:"var(--text-secondary)"},children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),e.jsx("p",{className:"text-sm",children:"No hay resÃºmenes con gastos"})]}):k.map((t,s)=>{var y;const o=t.totalPesos>0&&t.totalDolares>0,i=t.totalPesos>0,n=t.totalDolares>0,x=!!P[`${t.id}_ARS`],u=!!P[`${t.id}_USD`],d=(!i||x)&&(!n||u),l=i&&x&&n&&!u||n&&u&&i&&!x,h=!d&&!t.isFuture&&k.slice(0,s).every(p=>{const g=!!P[`${p.id}_ARS`],he=!!P[`${p.id}_USD`],ae=p.totalPesos>0,ne=p.totalDolares>0;return(!ae||g)&&(!ne||he)});return e.jsxs("div",{className:"rounded-2xl overflow-hidden cursor-pointer active:scale-[0.98] transition-transform",style:{backgroundColor:"var(--bg-secondary)"},onClick:()=>b(t),children:[e.jsxs("div",{className:"p-4 flex items-center justify-between",style:{backgroundColor:d?"rgba(34, 197, 94, 0.1)":h?"rgba(20, 184, 166, 0.15)":t.isFuture?"rgba(96, 165, 250, 0.1)":"transparent"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center",style:{backgroundColor:d?"var(--accent-green)":h?"var(--accent-primary)":t.isFuture?"var(--accent-blue)":"var(--bg-tertiary)"},children:d?e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):e.jsx("svg",{className:"w-5 h-5",style:{color:h||t.isFuture?"white":"var(--text-secondary)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold capitalize",style:{color:"var(--text-primary)"},children:[t.monthName,d&&e.jsx("span",{className:"ml-2 px-2 py-0.5 rounded-full text-xs",style:{backgroundColor:"var(--accent-green)",color:"white"},children:"Pagado"}),h&&!d&&e.jsx("span",{className:"ml-2 px-2 py-0.5 rounded-full text-xs",style:{backgroundColor:"var(--accent-primary)",color:"white"},children:"Actual"}),t.isFuture&&!d&&e.jsx("span",{className:"ml-2 px-2 py-0.5 rounded-full text-xs",style:{backgroundColor:"var(--accent-blue)",color:"white"},children:"Futuro"})]}),e.jsxs("div",{className:"flex items-center gap-1 mt-0.5 flex-wrap",children:[e.jsxs("p",{className:"text-xs",style:{color:"var(--text-secondary)"},children:[t.itemCount," movimiento",t.itemCount!==1?"s":""," Â· Cierra ",F(t.closeDate,"d MMM",{locale:le})]}),((y=N[t.id])==null?void 0:y.statementUrl)&&e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] font-medium",style:{backgroundColor:"rgba(239, 68, 68, 0.15)",color:"var(--accent-red)"},children:"PDF"}),l&&e.jsxs(e.Fragment,{children:[x&&e.jsxs("span",{className:"px-1.5 py-0.5 rounded text-[10px] font-medium flex items-center gap-0.5",style:{backgroundColor:"rgba(34, 197, 94, 0.15)",color:"var(--accent-green)"},children:[e.jsx("img",{src:"/icons/catalog/ARS.svg",alt:"",className:"w-3 h-3"}),"âœ“"]}),u&&e.jsxs("span",{className:"px-1.5 py-0.5 rounded text-[10px] font-medium flex items-center gap-0.5",style:{backgroundColor:"rgba(34, 197, 94, 0.15)",color:"var(--accent-green)"},children:[e.jsx("img",{src:"/icons/catalog/USD.svg",alt:"",className:"w-3 h-3"}),"âœ“"]})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"text-right",children:[o?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm font-bold flex items-center justify-end gap-1",style:{color:x?"var(--accent-green)":"var(--accent-red)"},children:[x&&e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})}),S(t.totalPesos,"ARS")]}),e.jsxs("p",{className:"text-sm font-bold flex items-center justify-end gap-1",style:{color:"var(--accent-green)"},children:[u&&e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})}),S(t.totalDolares,"USD")]})]}):e.jsxs("p",{className:"text-lg font-bold flex items-center gap-1",style:{color:d?"var(--accent-green)":t.totalPesos>0||t.totalDolares>0?"var(--accent-red)":"var(--text-secondary)"},children:[d&&e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})}),t.totalPesos>0?S(t.totalPesos,"ARS"):S(t.totalDolares,"USD")]}),t.hasTax&&e.jsx("p",{className:"text-xs",style:{color:"var(--accent-yellow)"},children:"Inc. imp. sellos"})]}),e.jsx("svg",{className:"w-5 h-5",style:{color:"var(--text-secondary)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]}),e.jsxs("div",{className:"px-4 py-3 flex gap-2",style:{borderTop:"1px solid var(--border-subtle)"},onClick:p=>p.stopPropagation(),children:[!t.hasTax&&e.jsxs("button",{onClick:()=>Le(t),className:"flex-1 py-2.5 rounded-xl text-xs font-medium transition-all duration-200 flex items-center justify-center gap-1.5",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--accent-yellow)"},children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Imp. Sellos"]}),e.jsx("button",{onClick:()=>Ee(t),className:"py-2.5 px-3 rounded-xl text-xs font-medium transition-all duration-200 flex items-center justify-center gap-1.5",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--accent-primary)"},title:"Adjuntos",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})}),d?e.jsxs("button",{onClick:()=>xe(t),className:"flex-1 py-2.5 rounded-xl text-xs font-medium transition-all duration-200 flex items-center justify-center gap-1.5",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--accent-green)"},children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Ver Pago"]}):e.jsxs("button",{onClick:()=>xe(t),className:"flex-1 py-2.5 rounded-xl text-xs font-medium text-white transition-all duration-200 flex items-center justify-center gap-1.5",style:{backgroundColor:"var(--accent-green)"},children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"})}),"Pagar Resumen"]})]})]},t.id)})]}),ee&&m&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:()=>W(!1)}),e.jsxs("div",{className:"relative w-full max-w-sm rounded-2xl p-6 animate-scale-in",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",style:{color:"var(--text-primary)"},children:"Agregar Impuesto de Sellos"}),e.jsxs("p",{className:"text-sm mb-4",style:{color:"var(--text-secondary)"},children:["Resumen de ",e.jsx("span",{className:"font-medium capitalize",children:m.monthName})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:"Monto del impuesto"}),e.jsx("input",{type:"number",value:G,onChange:t=>te(t.target.value),placeholder:"0.00",className:"w-full px-4 py-3 rounded-xl text-lg",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-primary)"}})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>W(!1),className:"flex-1 py-3 rounded-xl font-medium transition-colors hover:opacity-80",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-primary)"},children:"Cancelar"}),e.jsx("button",{onClick:st,disabled:T||!G,className:"flex-1 py-3 rounded-xl font-medium text-white transition-colors hover:opacity-90 disabled:opacity-50",style:{backgroundColor:"var(--accent-yellow)"},children:T?"Guardando...":"Agregar"})]})]})]}),ie&&m&&(()=>{const t=m.totalPesos>0,s=m.totalDolares>0,o=!!P[`${m.id}_ARS`],i=!!P[`${m.id}_USD`],n=(!t||o)&&(!s||i),x=t&&!o,u=s&&!i,d=x&&u?C&&D:x?C:u?D:!1;return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:()=>K(!1)}),e.jsxs("div",{className:"relative w-full max-w-sm rounded-2xl p-6 animate-scale-in max-h-[90vh] overflow-y-auto",style:{backgroundColor:"var(--bg-secondary)"},children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",style:{color:"var(--text-primary)"},children:n?"Resumen Pagado":"Pagar Resumen"}),e.jsxs("p",{className:"text-sm mb-4",style:{color:"var(--text-secondary)"},children:["Resumen de ",e.jsx("span",{className:"font-medium capitalize",children:m.monthName})]}),t&&e.jsxs("div",{className:"p-3 rounded-xl mb-3",style:{backgroundColor:o?"rgba(34, 197, 94, 0.1)":"rgba(20, 184, 166, 0.1)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:"/icons/catalog/ARS.svg",alt:"ARS",className:"w-5 h-5 rounded-sm"}),e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:"Pesos"})]}),o?e.jsxs("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium flex items-center gap-1",style:{backgroundColor:"var(--accent-green)",color:"white"},children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})}),"Pagado"]}):e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium",style:{backgroundColor:"rgba(239, 68, 68, 0.2)",color:"var(--accent-red)"},children:"Pendiente"})]}),e.jsx("p",{className:"text-lg font-bold",style:{color:o?"var(--accent-green)":"var(--accent-primary)"},children:S(m.totalPesos,"ARS")}),o&&e.jsx("button",{onClick:()=>Ae(m,"ARS"),disabled:T,className:"mt-2 text-xs font-medium transition-colors hover:opacity-80 disabled:opacity-50",style:{color:"var(--accent-red)"},children:"Anular pago"})]}),s&&e.jsxs("div",{className:"p-3 rounded-xl mb-4",style:{backgroundColor:i?"rgba(34, 197, 94, 0.1)":"rgba(34, 197, 94, 0.05)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:"/icons/catalog/USD.svg",alt:"USD",className:"w-5 h-5 rounded-sm"}),e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:"DÃ³lares"})]}),i?e.jsxs("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium flex items-center gap-1",style:{backgroundColor:"var(--accent-green)",color:"white"},children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})}),"Pagado"]}):e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium",style:{backgroundColor:"rgba(239, 68, 68, 0.2)",color:"var(--accent-red)"},children:"Pendiente"})]}),e.jsx("p",{className:"text-lg font-bold",style:{color:"var(--accent-green)"},children:S(m.totalDolares,"USD")}),i&&e.jsx("button",{onClick:()=>Ae(m,"USD"),disabled:T,className:"mt-2 text-xs font-medium transition-colors hover:opacity-80 disabled:opacity-50",style:{color:"var(--accent-red)"},children:"Anular pago"})]}),x&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("img",{src:"/icons/catalog/ARS.svg",alt:"ARS",className:"w-4 h-4 rounded-sm"}),"Pagar pesos desde"]})}),e.jsx(Ve,{value:C,onChange:l=>se(l.target.value),options:et.map(l=>({value:l.nombre,label:l.nombre,icon:l.icon||null})),placeholder:"Seleccionar cuenta en pesos..."})]}),u&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--text-primary)"},children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("img",{src:"/icons/catalog/USD.svg",alt:"USD",className:"w-4 h-4 rounded-sm"}),"Pagar dÃ³lares desde"]})}),e.jsx(Ve,{value:D,onChange:l=>re(l.target.value),options:tt.map(l=>({value:l.nombre,label:l.nombre,icon:l.icon||null})),placeholder:"Seleccionar cuenta en dÃ³lares..."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>K(!1),className:"flex-1 py-3 rounded-xl font-medium transition-colors hover:opacity-80",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-primary)"},children:n?"Cerrar":"Cancelar"}),!n&&e.jsx("button",{onClick:rt,disabled:T||!d,className:"flex-1 py-3 rounded-xl font-medium text-white transition-colors hover:opacity-90 disabled:opacity-50",style:{backgroundColor:"var(--accent-green)"},children:T?"Procesando...":"Pagar"})]})]})]})})(),r&&e.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col",style:{backgroundColor:"var(--bg-primary)"},children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-3 safe-area-top",style:{backgroundColor:"var(--bg-secondary)",borderBottom:"1px solid var(--border-subtle)"},children:[e.jsx("button",{onClick:()=>{b(null),fe(!1),Q(new Set)},className:"w-10 h-10 rounded-xl flex items-center justify-center transition-colors",style:{backgroundColor:"var(--bg-tertiary)"},children:e.jsx("svg",{className:"w-5 h-5",style:{color:"var(--text-primary)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("button",{onClick:it,disabled:!Be(),className:"w-9 h-9 rounded-xl flex items-center justify-center transition-all disabled:opacity-30",style:{backgroundColor:"var(--bg-tertiary)"},children:e.jsx("svg",{className:"w-5 h-5",style:{color:"var(--text-primary)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("h2",{className:"font-semibold capitalize",style:{color:"var(--text-primary)"},children:r.monthName}),e.jsxs("p",{className:"text-xs",style:{color:"var(--text-secondary)"},children:[a==null?void 0:a.nombre," Â· Cierra ",F(r.closeDate,"d MMM yyyy",{locale:le})]})]}),e.jsx("button",{onClick:dt,disabled:!Re(),className:"w-9 h-9 rounded-xl flex items-center justify-center transition-all disabled:opacity-30",style:{backgroundColor:"var(--bg-tertiary)"},children:e.jsx("svg",{className:"w-5 h-5",style:{color:"var(--text-primary)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),e.jsx("div",{className:"px-3 py-1.5 rounded-xl text-sm font-bold",style:{backgroundColor:"rgba(239, 68, 68, 0.15)",color:"var(--accent-red)"},children:r.totalPesos>0&&r.totalDolares>0?e.jsxs("div",{className:"flex flex-col items-end gap-0.5",children:[e.jsx("span",{children:S(r.totalPesos,"ARS")}),e.jsx("span",{style:{color:"var(--accent-green)"},children:S(r.totalDolares,"USD")})]}):r.totalPesos>0?S(r.totalPesos,"ARS"):S(r.totalDolares,"USD")})]}),N[r.id]&&e.jsxs("div",{className:"px-4 py-3 flex gap-2 flex-wrap",style:{borderBottom:"1px solid var(--border-subtle)"},children:[N[r.id].statementUrl&&e.jsxs("button",{onClick:()=>ye(N[r.id].statementUrl,N[r.id].statementName),className:"flex items-center gap-2 px-3 py-2 rounded-xl text-xs font-medium transition-colors hover:opacity-80",style:{backgroundColor:"rgba(239, 68, 68, 0.15)",color:"var(--accent-red)"},children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Resumen PDF"]}),N[r.id].receiptUrl&&e.jsxs("button",{onClick:()=>ye(N[r.id].receiptUrl,N[r.id].receiptName),className:"flex items-center gap-2 px-3 py-2 rounded-xl text-xs font-medium transition-colors hover:opacity-80",style:{backgroundColor:"rgba(34, 197, 94, 0.15)",color:"var(--accent-green)"},children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Comprobante"]})]}),r.totalPesos>0&&r.totalDolares>0&&e.jsx("div",{className:"px-4 py-3",style:{borderBottom:"1px solid var(--border-subtle)"},children:e.jsx("div",{className:"flex gap-2",children:["ARS","USD"].map(t=>{var s,o;return e.jsxs("button",{onClick:()=>O(t),className:`flex-1 py-2 rounded-xl text-sm font-medium transition-all flex items-center justify-center gap-2 ${f===t?"text-white":""}`,style:{backgroundColor:f===t?"var(--accent-primary)":"var(--bg-tertiary)",color:f===t?"white":"var(--text-secondary)"},children:[e.jsx("img",{src:`/icons/catalog/${t}.svg`,alt:t,className:"w-5 h-5 rounded-sm"}),t==="ARS"?`Pesos (${((s=r.itemsPesos)==null?void 0:s.length)||0})`:`DÃ³lares (${((o=r.itemsDolares)==null?void 0:o.length)||0})`]},t)})})}),X&&e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between gap-2 flex-wrap",style:{backgroundColor:"rgba(20, 184, 166, 0.1)",borderBottom:"1px solid var(--accent-primary)"},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-medium",style:{color:"var(--text-primary)"},children:[$.size," seleccionado",$.size!==1?"s":""]}),e.jsx("button",{onClick:()=>{const s=r.totalPesos>0&&r.totalDolares>0?f==="ARS"?r.itemsPesos:r.itemsDolares:r.items;$.size===s.length?Q(new Set):mt(s)},className:"text-xs px-2 py-1 rounded-lg",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--accent-primary)"},children:(()=>{const s=r.totalPesos>0&&r.totalDolares>0?f==="ARS"?r.itemsPesos:r.itemsDolares:r.items;return $.size===s.length?"Deseleccionar":"Seleccionar todo"})()})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[$.size>0&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>Te("prev"),disabled:ve||!Be(),className:"flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs font-medium disabled:opacity-40",style:{backgroundColor:"rgba(59, 130, 246, 0.15)",color:"var(--accent-blue)"},children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Resumen ant."]}),e.jsxs("button",{onClick:()=>Te("next"),disabled:ve||!Re(),className:"flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs font-medium disabled:opacity-40",style:{backgroundColor:"rgba(168, 85, 247, 0.15)",color:"var(--accent-purple)"},children:["Resumen sig.",e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]}),e.jsx("button",{onClick:Ue,disabled:ve,className:"px-3 py-1.5 rounded-lg text-xs font-medium",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--text-secondary)"},children:"Cancelar"})]})]}),!X&&e.jsx("div",{className:"px-4 py-2",style:{borderBottom:"1px solid var(--border-subtle)"},children:e.jsxs("button",{onClick:Ue,className:"text-xs font-medium flex items-center gap-1.5",style:{color:"var(--accent-primary)"},children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 5h7M4 12h7m-7 7h7m5-14v14m0-14l3 3m-3-3l-3 3m3 11l3-3m-3 3l-3-3"})}),"SelecciÃ³n mÃºltiple"]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-4 space-y-2",children:(()=>{const s=r.totalPesos>0&&r.totalDolares>0?f==="ARS"?r.itemsPesos:r.itemsDolares:r.items;return s==null?void 0:s.map((o,i)=>{var d;const n=o.monedaOriginal||"ARS",x=n==="USD"?o.montoDolaresNum||o.montoDolares||0:o.montoPesosNum||o.montoPesos||o.monto||0,u=$.has(o.id);return e.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-xl transition-all cursor-pointer ${X?"":"active:scale-[0.98]"}`,style:{backgroundColor:u?"rgba(20, 184, 166, 0.15)":"var(--bg-secondary)",border:u?"1px solid var(--accent-primary)":"1px solid transparent"},onClick:()=>X?Ie(o.id):nt(o),children:[X&&e.jsx("button",{onClick:l=>{l.stopPropagation(),Ie(o.id)},className:"w-6 h-6 rounded-lg flex items-center justify-center flex-shrink-0 transition-all",style:{backgroundColor:u?"var(--accent-primary)":"var(--bg-tertiary)",border:u?"none":"2px solid var(--border-subtle)"},children:u&&e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0",style:{backgroundColor:"var(--bg-tertiary)"},children:(()=>{var y,p;const l=(y=A.gastos)==null?void 0:y.find(g=>g.value===o.categoria||g.label===o.categoria),h=l==null?void 0:l.icon;if(h&&Oe(h))return e.jsx("span",{className:"text-lg",children:h});if(h)return e.jsx("img",{src:Ge(h),alt:"",className:"w-6 h-6 rounded object-cover"});{const g=((p=o.categoria)==null?void 0:p.split(" ")[0])||"ðŸ’³";return e.jsx("span",{className:"text-lg",children:g})}})()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-sm font-medium truncate",style:{color:"var(--text-primary)"},children:[((d=o.categoria)==null?void 0:d.replace(/^[^\s]+\s*/,""))||o.categoria||"Sin categorÃ­a",o.isInstallment&&e.jsx("span",{className:"ml-2 px-1.5 py-0.5 rounded text-xs",style:{backgroundColor:"rgba(20, 184, 166, 0.2)",color:"var(--accent-primary)"},children:o.cuota}),n==="USD"&&e.jsx("span",{className:"ml-2 px-1.5 py-0.5 rounded text-xs",style:{backgroundColor:"rgba(34, 197, 94, 0.2)",color:"var(--accent-green)"},children:"USD"})]}),o.nota&&e.jsx("p",{className:"text-xs truncate",style:{color:"var(--text-secondary)"},children:o.nota}),e.jsx("p",{className:"text-xs",style:{color:"var(--text-secondary)"},children:(()=>{if(/^\d{4}-\d{2}-\d{2}$/.test(o.fecha)){const[l,h,y]=o.fecha.split("-").map(Number);return F(new Date(l,h-1,y),"d 'de' MMMM",{locale:le})}return F(new Date(o.fecha),"d 'de' MMMM",{locale:le})})()})]}),e.jsxs("div",{className:"text-right flex-shrink-0 flex items-center gap-2",children:[e.jsx("p",{className:"text-sm font-bold",style:{color:n==="USD"?"var(--accent-green)":"var(--accent-red)"},children:S(x,n)}),!X&&e.jsx("svg",{className:"w-4 h-4",style:{color:"var(--text-secondary)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]},i)})})()}),(()=>{const t=r.totalPesos>0,s=r.totalDolares>0,o=!!P[`${r.id}_ARS`],i=!!P[`${r.id}_USD`],n=(!t||o)&&(!s||i);return e.jsxs("div",{className:"px-4 py-4 safe-area-bottom flex gap-2",style:{backgroundColor:"var(--bg-secondary)",borderTop:"1px solid var(--border-subtle)"},children:[e.jsx("button",{onClick:xt,className:"py-3 px-4 rounded-xl font-medium transition-all duration-200 flex items-center justify-center gap-2",style:{backgroundColor:"var(--accent-red)",color:"white"},children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),!r.hasTax&&e.jsx("button",{onClick:()=>{Le(r),b(null)},className:"py-3 px-4 rounded-xl font-medium transition-all duration-200 flex items-center justify-center gap-2",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--accent-yellow)"},title:"Agregar Impuesto de Sellos",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 14l6-6m-5.5.5h.01m4.99 5h.01M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16l3.5-2 3.5 2 3.5-2 3.5 2z"})})}),e.jsx("button",{onClick:()=>{Ee(r)},className:"py-3 px-4 rounded-xl font-medium transition-all duration-200 flex items-center justify-center gap-2",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--accent-primary)"},title:"Adjuntos",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})}),n?e.jsxs("button",{onClick:()=>{xe(r),b(null)},className:"flex-1 py-3 rounded-xl font-medium transition-all duration-200 flex items-center justify-center gap-2",style:{backgroundColor:"var(--bg-tertiary)",color:"var(--accent-green)"},children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Pagado"]}):e.jsxs("button",{onClick:()=>{xe(r),b(null)},className:"flex-1 py-3 rounded-xl font-medium text-white transition-all duration-200 flex items-center justify-center gap-2",style:{backgroundColor:"var(--accent-green)"},children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"})}),"Pagar"]})]})})()]}),e.jsx(Bt,{isOpen:Je,onClose:()=>{Ne(!1),we(null)},statement:Y,attachments:Y?N[Y.id]:null,onSave:ot,onRemove:at,saving:Ke}),Ce&&e.jsx(wt,{movement:Ce,accounts:B,categories:A,onSave:lt,onDelete:ct,onClose:()=>ue(null),onConvertedToRecurring:()=>I(!0,!1)}),e.jsx(Ct,{isOpen:qe,onClose:()=>{De(!1),Pe(null)},prefillData:Qe})]})}export{Ut as default};
